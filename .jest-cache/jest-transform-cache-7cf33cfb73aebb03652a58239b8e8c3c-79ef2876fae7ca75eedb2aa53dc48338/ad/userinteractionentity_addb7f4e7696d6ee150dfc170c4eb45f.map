{"file":"C:\\Users\\ojoseph\\Documents\\StrellerMinds-Backend\\src\\recommendation\\entities\\user-interaction.entity.ts","mappings":"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","names":[],"sources":["C:\\Users\\ojoseph\\Documents\\StrellerMinds-Backend\\src\\recommendation\\entities\\user-interaction.entity.ts"],"sourcesContent":["import {\r\n  Entity,\r\n  PrimaryGeneratedColumn,\r\n  Column,\r\n  ManyToOne,\r\n  CreateDateColumn,\r\n  Index,\r\n  JoinColumn,\r\n} from 'typeorm';\r\nimport { User } from '../../users/entities/user.entity';\r\nimport { Course } from '../../courses/entities/course.entity';\r\n\r\nexport enum InteractionType {\r\n  VIEW = 'view',\r\n  CLICK = 'click',\r\n  ENROLL = 'enroll',\r\n  COMPLETE = 'complete',\r\n  RATE = 'rate',\r\n  BOOKMARK = 'bookmark',\r\n  SHARE = 'share',\r\n  SEARCH = 'search',\r\n  FILTER = 'filter',\r\n  DOWNLOAD = 'download',\r\n  PAUSE = 'pause',\r\n  RESUME = 'resume',\r\n  SKIP = 'skip',\r\n  REPEAT = 'repeat',\r\n}\r\n\r\nexport enum InteractionContext {\r\n  HOMEPAGE = 'homepage',\r\n  SEARCH_RESULTS = 'search_results',\r\n  COURSE_PAGE = 'course_page',\r\n  RECOMMENDATION = 'recommendation',\r\n  LEARNING_PATH = 'learning_path',\r\n  PROFILE = 'profile',\r\n  DASHBOARD = 'dashboard',\r\n  CATEGORY_PAGE = 'category_page',\r\n  NOTIFICATION = 'notification',\r\n}\r\n\r\n@Entity('user_interactions')\r\n@Index(['userId', 'interactionType', 'createdAt'])\r\n@Index(['courseId', 'interactionType'])\r\n@Index(['sessionId'])\r\n@Index(['createdAt'])\r\nexport class UserInteraction {\r\n  @PrimaryGeneratedColumn('uuid')\r\n  id: string;\r\n\r\n  @Column('uuid')\r\n  @Index()\r\n  userId: string;\r\n\r\n  @ManyToOne(() => User, { onDelete: 'CASCADE' })\r\n  @JoinColumn({ name: 'userId' })\r\n  user: User;\r\n\r\n  @Column('uuid', { nullable: true })\r\n  courseId?: string;\r\n\r\n  @ManyToOne(() => Course, { nullable: true, onDelete: 'CASCADE' })\r\n  @JoinColumn({ name: 'courseId' })\r\n  course?: Course;\r\n\r\n  @Column('uuid', { nullable: true })\r\n  recommendationId?: string;\r\n\r\n  @Column({\r\n    type: 'enum',\r\n    enum: InteractionType,\r\n  })\r\n  interactionType: InteractionType;\r\n\r\n  @Column({\r\n    type: 'enum',\r\n    enum: InteractionContext,\r\n    nullable: true,\r\n  })\r\n  context?: InteractionContext;\r\n\r\n  @Column('varchar', { length: 255, nullable: true })\r\n  sessionId?: string;\r\n\r\n  @Column('decimal', { precision: 5, scale: 4, nullable: true })\r\n  value?: number; // For ratings, progress, etc.\r\n\r\n  @Column('int', { nullable: true })\r\n  duration?: number; // Duration in seconds\r\n\r\n  @Column('jsonb', { nullable: true })\r\n  metadata?: {\r\n    deviceType?: string;\r\n    browserType?: string;\r\n    referrer?: string;\r\n    searchQuery?: string;\r\n    filters?: Record<string, any>;\r\n    position?: number; // Position in list/grid\r\n    pageNumber?: number;\r\n    scrollDepth?: number;\r\n    timeOnPage?: number;\r\n    clickCoordinates?: { x: number; y: number };\r\n    videoProgress?: number;\r\n    quizScore?: number;\r\n    tags?: string[];\r\n  };\r\n\r\n  @Column('inet', { nullable: true })\r\n  ipAddress?: string;\r\n\r\n  @Column('varchar', { length: 500, nullable: true })\r\n  userAgent?: string;\r\n\r\n  @CreateDateColumn()\r\n  createdAt: Date;\r\n\r\n  // Virtual properties\r\n  get isPositiveInteraction(): boolean {\r\n    return [\r\n      InteractionType.ENROLL,\r\n      InteractionType.COMPLETE,\r\n      InteractionType.BOOKMARK,\r\n      InteractionType.SHARE,\r\n      InteractionType.RATE,\r\n    ].includes(this.interactionType);\r\n  }\r\n\r\n  get isEngagementInteraction(): boolean {\r\n    return [\r\n      InteractionType.VIEW,\r\n      InteractionType.CLICK,\r\n      InteractionType.DOWNLOAD,\r\n      InteractionType.REPEAT,\r\n    ].includes(this.interactionType);\r\n  }\r\n\r\n  get weightedValue(): number {\r\n    const weights = {\r\n      [InteractionType.VIEW]: 1,\r\n      [InteractionType.CLICK]: 2,\r\n      [InteractionType.ENROLL]: 5,\r\n      [InteractionType.COMPLETE]: 10,\r\n      [InteractionType.RATE]: 3,\r\n      [InteractionType.BOOKMARK]: 4,\r\n      [InteractionType.SHARE]: 6,\r\n      [InteractionType.SEARCH]: 1,\r\n      [InteractionType.FILTER]: 1,\r\n      [InteractionType.DOWNLOAD]: 3,\r\n      [InteractionType.PAUSE]: -1,\r\n      [InteractionType.RESUME]: 2,\r\n      [InteractionType.SKIP]: -2,\r\n      [InteractionType.REPEAT]: 4,\r\n    };\r\n\r\n    let weight = weights[this.interactionType] || 1;\r\n    \r\n    // Apply value multiplier for ratings\r\n    if (this.interactionType === InteractionType.RATE && this.value) {\r\n      weight *= this.value;\r\n    }\r\n\r\n    return weight;\r\n  }\r\n}\r\n"],"version":3}