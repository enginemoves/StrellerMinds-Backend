a6f068de3c8f440758165cbb1bc926bb
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.AuthService = void 0;
const common_1 = require("@nestjs/common");
let AuthService = class AuthService {
    constructor(strategies) {
        this.strategies = strategies;
    }
    getStrategy(name) {
        const strategy = this.strategies.find((s) => s.name === name);
        if (!strategy) {
            throw new common_1.BadRequestException(`Unsupported auth strategy: ${name}`);
        }
        return strategy;
    }
    async validate(strategyName, credentials) {
        const strategy = this.getStrategy(strategyName);
        return strategy.validate(credentials);
    }
    async login(strategyName, user) {
        const strategy = this.getStrategy(strategyName);
        return strategy.login(user);
    }
    async register(strategyName, credentials) {
        const strategy = this.getStrategy(strategyName);
        if (!strategy.register) {
            throw new common_1.BadRequestException(`Register not supported for ${strategyName}`);
        }
        return strategy.register(credentials);
    }
};
exports.AuthService = AuthService;
exports.AuthService = AuthService = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, common_1.Inject)('AUTH_STRATEGIES')),
    __metadata("design:paramtypes", [Array])
], AuthService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxhdXRoXFxhdXRoLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBS3dCO0FBS2pCLElBQU0sV0FBVyxHQUFqQixNQUFNLFdBQVc7SUFDdEIsWUFFbUIsVUFBMkI7UUFBM0IsZUFBVSxHQUFWLFVBQVUsQ0FBaUI7SUFDM0MsQ0FBQztJQUVJLFdBQVcsQ0FBQyxJQUFZO1FBQzlCLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxDQUFDO1FBQzlELElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNkLE1BQU0sSUFBSSw0QkFBbUIsQ0FBQyw4QkFBOEIsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUN0RSxDQUFDO1FBQ0QsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUVELEtBQUssQ0FBQyxRQUFRLENBQUMsWUFBb0IsRUFBRSxXQUFnQjtRQUNuRCxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2hELE9BQU8sUUFBUSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRUQsS0FBSyxDQUFDLEtBQUssQ0FBQyxZQUFvQixFQUFFLElBQVM7UUFDekMsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNoRCxPQUFPLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDOUIsQ0FBQztJQUVELEtBQUssQ0FBQyxRQUFRLENBQUMsWUFBb0IsRUFBRSxXQUFnQjtRQUNuRCxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2hELElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDdkIsTUFBTSxJQUFJLDRCQUFtQixDQUFDLDhCQUE4QixZQUFZLEVBQUUsQ0FBQyxDQUFDO1FBQzlFLENBQUM7UUFDRCxPQUFPLFFBQVEsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDeEMsQ0FBQztDQUNGLENBQUE7QUEvQlksa0NBQVc7c0JBQVgsV0FBVztJQUR2QixJQUFBLG1CQUFVLEdBQUU7SUFHUixXQUFBLElBQUEsZUFBTSxFQUFDLGlCQUFpQixDQUFDLENBQUE7O0dBRmpCLFdBQVcsQ0ErQnZCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcb2pvc2VwaFxcRG9jdW1lbnRzXFxTdHJlbGxlck1pbmRzLUJhY2tlbmRcXHNyY1xcYXV0aFxcYXV0aC5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgSW5qZWN0YWJsZSxcclxuICBVbmF1dGhvcml6ZWRFeGNlcHRpb24sXHJcbiAgQmFkUmVxdWVzdEV4Y2VwdGlvbixcclxuICBJbmplY3QsXHJcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xyXG5pbXBvcnQgeyBJQXV0aFN0cmF0ZWd5IH0gZnJvbSAnLi9zdHJhdGVnaWVzL2F1dGgtc3RyYXRlZ3kuaW50ZXJmYWNlJztcclxuaW1wb3J0IHsgQXV0aFJlc3BvbnNlRHRvIH0gZnJvbSAnLi9kdG8vYXV0aC1yZXNwb25zZS5kdG8nO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgQXV0aFNlcnZpY2Uge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgQEluamVjdCgnQVVUSF9TVFJBVEVHSUVTJylcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgc3RyYXRlZ2llczogSUF1dGhTdHJhdGVneVtdLFxyXG4gICkge31cclxuXHJcbiAgcHJpdmF0ZSBnZXRTdHJhdGVneShuYW1lOiBzdHJpbmcpOiBJQXV0aFN0cmF0ZWd5IHtcclxuICAgIGNvbnN0IHN0cmF0ZWd5ID0gdGhpcy5zdHJhdGVnaWVzLmZpbmQoKHMpID0+IHMubmFtZSA9PT0gbmFtZSk7XHJcbiAgICBpZiAoIXN0cmF0ZWd5KSB7XHJcbiAgICAgIHRocm93IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKGBVbnN1cHBvcnRlZCBhdXRoIHN0cmF0ZWd5OiAke25hbWV9YCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc3RyYXRlZ3k7XHJcbiAgfVxyXG5cclxuICBhc3luYyB2YWxpZGF0ZShzdHJhdGVneU5hbWU6IHN0cmluZywgY3JlZGVudGlhbHM6IGFueSk6IFByb21pc2U8YW55PiB7XHJcbiAgICBjb25zdCBzdHJhdGVneSA9IHRoaXMuZ2V0U3RyYXRlZ3koc3RyYXRlZ3lOYW1lKTtcclxuICAgIHJldHVybiBzdHJhdGVneS52YWxpZGF0ZShjcmVkZW50aWFscyk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBsb2dpbihzdHJhdGVneU5hbWU6IHN0cmluZywgdXNlcjogYW55KTogUHJvbWlzZTxBdXRoUmVzcG9uc2VEdG8+IHtcclxuICAgIGNvbnN0IHN0cmF0ZWd5ID0gdGhpcy5nZXRTdHJhdGVneShzdHJhdGVneU5hbWUpO1xyXG4gICAgcmV0dXJuIHN0cmF0ZWd5LmxvZ2luKHVzZXIpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcmVnaXN0ZXIoc3RyYXRlZ3lOYW1lOiBzdHJpbmcsIGNyZWRlbnRpYWxzOiBhbnkpOiBQcm9taXNlPEF1dGhSZXNwb25zZUR0bz4ge1xyXG4gICAgY29uc3Qgc3RyYXRlZ3kgPSB0aGlzLmdldFN0cmF0ZWd5KHN0cmF0ZWd5TmFtZSk7XHJcbiAgICBpZiAoIXN0cmF0ZWd5LnJlZ2lzdGVyKSB7XHJcbiAgICAgIHRocm93IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKGBSZWdpc3RlciBub3Qgc3VwcG9ydGVkIGZvciAke3N0cmF0ZWd5TmFtZX1gKTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdHJhdGVneS5yZWdpc3RlcihjcmVkZW50aWFscyk7XHJcbiAgfVxyXG59XHJcbiJdLCJ2ZXJzaW9uIjozfQ==