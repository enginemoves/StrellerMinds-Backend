8f4fbe2cf3b45542ff3961ab1ae09ef7
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", { value: true });
exports.UserProfilesController = void 0;
const common_1 = require("@nestjs/common");
const user_profiles_service_1 = require("./user-profiles.service");
const create_user_profile_dto_1 = require("./dto/create-user-profile.dto");
const update_user_profile_dto_1 = require("./dto/update-user-profile.dto");
const jwt_auth_guard_1 = require("../auth/guards/jwt-auth.guard");
const roles_guard_1 = require("../auth/guards/roles.guard");
const roles_decorator_1 = require("../auth/decorators/roles.decorator");
const swagger_1 = require("@nestjs/swagger");
const language_detector_util_1 = require("src/common/util/language-detector.util");
let UserProfilesController = class UserProfilesController {
    constructor(userProfilesService) {
        this.userProfilesService = userProfilesService;
    }
    create(req, createUserProfileDto) {
        return this.userProfilesService.create(req.user.id, createUserProfileDto);
    }
    findAll() {
        return this.userProfilesService.findAll();
    }
    findOne(id, req) {
        return this.userProfilesService.findOne(id);
    }
    findByUserId(userId, req) {
        return this.userProfilesService.findByUserId(userId, req.user.id);
    }
    update(id, req, updateUserProfileDto) {
        return this.userProfilesService.update(id, req.user.id, updateUserProfileDto);
    }
    patch(id, req, updateUserProfileDto) {
        return this.userProfilesService.patch(id, req.user.id, updateUserProfileDto);
    }
    remove(id, req) {
        return this.userProfilesService.remove(id, req.user.id);
    }
    adminRemove(id, req) {
        // Admin can delete any profile
        return this.userProfilesService.remove(id, req.user.id);
    }
    async detectLanguage(req, acceptLanguage) {
        const detectedLang = (0, language_detector_util_1.detectLanguageFromHeader)(acceptLanguage) || 'en';
        // Save to user's profile
        await this.userProfilesService.setPreferredLanguage(req.user.id, detectedLang);
        return { detectedLanguage: detectedLang };
    }
};
exports.UserProfilesController = UserProfilesController;
__decorate([
    (0, common_1.Post)(),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiOperation)({ summary: 'Create a new user profile' }),
    (0, swagger_1.ApiResponse)({
        status: 201,
        description: 'The profile has been successfully created.',
    }),
    (0, swagger_1.ApiResponse)({ status: 400, description: 'Bad Request.' }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Forbidden.' }),
    __param(0, (0, common_1.Request)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, typeof (_b = typeof create_user_profile_dto_1.CreateUserProfileDto !== "undefined" && create_user_profile_dto_1.CreateUserProfileDto) === "function" ? _b : Object]),
    __metadata("design:returntype", void 0)
], UserProfilesController.prototype, "create", null);
__decorate([
    (0, common_1.Get)(),
    (0, swagger_1.ApiOperation)({ summary: 'Get all public profiles' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Return all public profiles.' }),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], UserProfilesController.prototype, "findAll", null);
__decorate([
    (0, common_1.Get)(':id'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiOperation)({ summary: 'Get a profile by id' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Return the profile.' }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Profile not found.' }),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, common_1.Request)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object]),
    __metadata("design:returntype", void 0)
], UserProfilesController.prototype, "findOne", null);
__decorate([
    (0, common_1.Get)('user/:userId'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiOperation)({ summary: 'Get a profile by user id' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Return the profile.' }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Profile not found.' }),
    __param(0, (0, common_1.Param)('userId')),
    __param(1, (0, common_1.Request)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object]),
    __metadata("design:returntype", void 0)
], UserProfilesController.prototype, "findByUserId", null);
__decorate([
    (0, common_1.Put)(':id'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiOperation)({ summary: 'Update a profile' }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'The profile has been successfully updated.',
    }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Forbidden.' }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Profile not found.' }),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, common_1.Request)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object, typeof (_c = typeof update_user_profile_dto_1.UpdateUserProfileDto !== "undefined" && update_user_profile_dto_1.UpdateUserProfileDto) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], UserProfilesController.prototype, "update", null);
__decorate([
    (0, common_1.Patch)(':id'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiOperation)({ summary: 'Partially update a profile' }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'The profile has been successfully updated.',
    }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Forbidden.' }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Profile not found.' }),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, common_1.Request)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object, typeof (_d = typeof update_user_profile_dto_1.UpdateUserProfileDto !== "undefined" && update_user_profile_dto_1.UpdateUserProfileDto) === "function" ? _d : Object]),
    __metadata("design:returntype", void 0)
], UserProfilesController.prototype, "patch", null);
__decorate([
    (0, common_1.Delete)(':id'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, common_1.HttpCode)(common_1.HttpStatus.NO_CONTENT),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiOperation)({ summary: 'Delete a profile' }),
    (0, swagger_1.ApiResponse)({
        status: 204,
        description: 'The profile has been successfully deleted.',
    }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Forbidden.' }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Profile not found.' }),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, common_1.Request)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object]),
    __metadata("design:returntype", void 0)
], UserProfilesController.prototype, "remove", null);
__decorate([
    (0, common_1.Delete)(':id/admin'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    (0, roles_decorator_1.Roles)('admin'),
    (0, common_1.HttpCode)(common_1.HttpStatus.NO_CONTENT),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiOperation)({ summary: 'Admin delete a profile' }),
    (0, swagger_1.ApiResponse)({
        status: 204,
        description: 'The profile has been successfully deleted.',
    }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Forbidden.' }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Profile not found.' }),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, common_1.Request)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object]),
    __metadata("design:returntype", void 0)
], UserProfilesController.prototype, "adminRemove", null);
__decorate([
    (0, common_1.Get)('detect-language'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, swagger_1.ApiOperation)({ summary: 'Detect and store preferred language' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Detected language returned and saved.' }),
    (0, swagger_1.ApiBearerAuth)(),
    __param(0, (0, common_1.Request)()),
    __param(1, (0, common_1.Headers)('accept-language')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String]),
    __metadata("design:returntype", Promise)
], UserProfilesController.prototype, "detectLanguage", null);
exports.UserProfilesController = UserProfilesController = __decorate([
    (0, swagger_1.ApiTags)('user-profiles'),
    (0, common_1.Controller)('user-profiles'),
    __metadata("design:paramtypes", [typeof (_a = typeof user_profiles_service_1.UserProfilesService !== "undefined" && user_profiles_service_1.UserProfilesService) === "function" ? _a : Object])
], UserProfilesController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFx1c2VyLXByb2ZpbGVzXFx1c2VyLXByb2ZpbGVzLmNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQWN3QjtBQUN4QixtRUFBOEQ7QUFDOUQsMkVBQXFFO0FBQ3JFLDJFQUFxRTtBQUNyRSxrRUFBNkQ7QUFDN0QsNERBQXdEO0FBQ3hELHdFQUEyRDtBQUMzRCw2Q0FLeUI7QUFDekIsbUZBQWtGO0FBSTNFLElBQU0sc0JBQXNCLEdBQTVCLE1BQU0sc0JBQXNCO0lBQ2pDLFlBQTZCLG1CQUF3QztRQUF4Qyx3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXFCO0lBQUcsQ0FBQztJQVl6RSxNQUFNLENBQVksR0FBRyxFQUFVLG9CQUEwQztRQUN2RSxPQUFPLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztJQUM1RSxDQUFDO0lBS0QsT0FBTztRQUNMLE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQzVDLENBQUM7SUFRRCxPQUFPLENBQWMsRUFBVSxFQUFhLEdBQUc7UUFDN0MsT0FBTyxJQUFJLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFRRCxZQUFZLENBQWtCLE1BQWMsRUFBYSxHQUFHO1FBQzFELE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNwRSxDQUFDO0lBWUQsTUFBTSxDQUNTLEVBQVUsRUFDWixHQUFHLEVBQ04sb0JBQTBDO1FBRWxELE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FDcEMsRUFBRSxFQUNGLEdBQUcsQ0FBQyxJQUFJLENBQUMs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QyxlQUFlLENBQUM7eURBRXdCLDJDQUFtQixvQkFBbkIsMkNBQW1CO0dBRDFELHNCQUFzQixDQXFJbEMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFx1c2VyLXByb2ZpbGVzXFx1c2VyLXByb2ZpbGVzLmNvbnRyb2xsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDb250cm9sbGVyLFxyXG4gIEdldCxcclxuICBQb3N0LFxyXG4gIEJvZHksXHJcbiAgUGF0Y2gsXHJcbiAgUHV0LFxyXG4gIFBhcmFtLFxyXG4gIERlbGV0ZSxcclxuICBVc2VHdWFyZHMsXHJcbiAgUmVxdWVzdCxcclxuICBIdHRwQ29kZSxcclxuICBIdHRwU3RhdHVzLFxyXG4gIEhlYWRlcnMsXHJcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xyXG5pbXBvcnQgeyBVc2VyUHJvZmlsZXNTZXJ2aWNlIH0gZnJvbSAnLi91c2VyLXByb2ZpbGVzLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBDcmVhdGVVc2VyUHJvZmlsZUR0byB9IGZyb20gJy4vZHRvL2NyZWF0ZS11c2VyLXByb2ZpbGUuZHRvJztcclxuaW1wb3J0IHsgVXBkYXRlVXNlclByb2ZpbGVEdG8gfSBmcm9tICcuL2R0by91cGRhdGUtdXNlci1wcm9maWxlLmR0byc7XHJcbmltcG9ydCB7IEp3dEF1dGhHdWFyZCB9IGZyb20gJy4uL2F1dGgvZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcclxuaW1wb3J0IHsgUm9sZXNHdWFyZCB9IGZyb20gJy4uL2F1dGgvZ3VhcmRzL3JvbGVzLmd1YXJkJztcclxuaW1wb3J0IHsgUm9sZXMgfSBmcm9tICcuLi9hdXRoL2RlY29yYXRvcnMvcm9sZXMuZGVjb3JhdG9yJztcclxuaW1wb3J0IHtcclxuICBBcGlUYWdzLFxyXG4gIEFwaU9wZXJhdGlvbixcclxuICBBcGlSZXNwb25zZSxcclxuICBBcGlCZWFyZXJBdXRoLFxyXG59IGZyb20gJ0BuZXN0anMvc3dhZ2dlcic7XHJcbmltcG9ydCB7IGRldGVjdExhbmd1YWdlRnJvbUhlYWRlciB9IGZyb20gJ3NyYy9jb21tb24vdXRpbC9sYW5ndWFnZS1kZXRlY3Rvci51dGlsJztcclxuXHJcbkBBcGlUYWdzKCd1c2VyLXByb2ZpbGVzJylcclxuQENvbnRyb2xsZXIoJ3VzZXItcHJvZmlsZXMnKVxyXG5leHBvcnQgY2xhc3MgVXNlclByb2ZpbGVzQ29udHJvbGxlciB7XHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSB1c2VyUHJvZmlsZXNTZXJ2aWNlOiBVc2VyUHJvZmlsZXNTZXJ2aWNlKSB7fVxyXG5cclxuICBAUG9zdCgpXHJcbiAgQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQpXHJcbiAgQEFwaUJlYXJlckF1dGgoKVxyXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnQ3JlYXRlIGEgbmV3IHVzZXIgcHJvZmlsZScgfSlcclxuICBAQXBpUmVzcG9uc2Uoe1xyXG4gICAgc3RhdHVzOiAyMDEsXHJcbiAgICBkZXNjcmlwdGlvbjogJ1RoZSBwcm9maWxlIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBjcmVhdGVkLicsXHJcbiAgfSlcclxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMCwgZGVzY3JpcHRpb246ICdCYWQgUmVxdWVzdC4nIH0pXHJcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDMsIGRlc2NyaXB0aW9uOiAnRm9yYmlkZGVuLicgfSlcclxuICBjcmVhdGUoQFJlcXVlc3QoKSByZXEsIEBCb2R5KCkgY3JlYXRlVXNlclByb2ZpbGVEdG86IENyZWF0ZVVzZXJQcm9maWxlRHRvKSB7XHJcbiAgICByZXR1cm4gdGhpcy51c2VyUHJvZmlsZXNTZXJ2aWNlLmNyZWF0ZShyZXEudXNlci5pZCwgY3JlYXRlVXNlclByb2ZpbGVEdG8pO1xyXG4gIH1cclxuXHJcbiAgQEdldCgpXHJcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdHZXQgYWxsIHB1YmxpYyBwcm9maWxlcycgfSlcclxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDIwMCwgZGVzY3JpcHRpb246ICdSZXR1cm4gYWxsIHB1YmxpYyBwcm9maWxlcy4nIH0pXHJcbiAgZmluZEFsbCgpIHtcclxuICAgIHJldHVybiB0aGlzLnVzZXJQcm9maWxlc1NlcnZpY2UuZmluZEFsbCgpO1xyXG4gIH1cclxuXHJcbiAgQEdldCgnOmlkJylcclxuICBAVXNlR3VhcmRzKEp3dEF1dGhHdWFyZClcclxuICBAQXBpQmVhcmVyQXV0aCgpXHJcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdHZXQgYSBwcm9maWxlIGJ5IGlkJyB9KVxyXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogMjAwLCBkZXNjcmlwdGlvbjogJ1JldHVybiB0aGUgcHJvZmlsZS4nIH0pXHJcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDQsIGRlc2NyaXB0aW9uOiAnUHJvZmlsZSBub3QgZm91bmQuJyB9KVxyXG4gIGZpbmRPbmUoQFBhcmFtKCdpZCcpIGlkOiBzdHJpbmcsIEBSZXF1ZXN0KCkgcmVxKSB7XHJcbiAgICByZXR1cm4gdGhpcy51c2VyUHJvZmlsZXNTZXJ2aWNlLmZpbmRPbmUoaWQpO1xyXG4gIH1cclxuXHJcbiAgQEdldCgndXNlci86dXNlcklkJylcclxuICBAVXNlR3VhcmRzKEp3dEF1dGhHdWFyZClcclxuICBAQXBpQmVhcmVyQXV0aCgpXHJcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdHZXQgYSBwcm9maWxlIGJ5IHVzZXIgaWQnIH0pXHJcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiAyMDAsIGRlc2NyaXB0aW9uOiAnUmV0dXJuIHRoZSBwcm9maWxlLicgfSlcclxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwNCwgZGVzY3JpcHRpb246ICdQcm9maWxlIG5vdCBmb3VuZC4nIH0pXHJcbiAgZmluZEJ5VXNlcklkKEBQYXJhbSgndXNlcklkJykgdXNlcklkOiBzdHJpbmcsIEBSZXF1ZXN0KCkgcmVxKSB7XHJcbiAgICByZXR1cm4gdGhpcy51c2VyUHJvZmlsZXNTZXJ2aWNlLmZpbmRCeVVzZXJJZCh1c2VySWQsIHJlcS51c2VyLmlkKTtcclxuICB9XHJcblxyXG4gIEBQdXQoJzppZCcpXHJcbiAgQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQpXHJcbiAgQEFwaUJlYXJlckF1dGgoKVxyXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnVXBkYXRlIGEgcHJvZmlsZScgfSlcclxuICBAQXBpUmVzcG9uc2Uoe1xyXG4gICAgc3RhdHVzOiAyMDAsXHJcbiAgICBkZXNjcmlwdGlvbjogJ1RoZSBwcm9maWxlIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSB1cGRhdGVkLicsXHJcbiAgfSlcclxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMywgZGVzY3JpcHRpb246ICdGb3JiaWRkZW4uJyB9KVxyXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDA0LCBkZXNjcmlwdGlvbjogJ1Byb2ZpbGUgbm90IGZvdW5kLicgfSlcclxuICB1cGRhdGUoXHJcbiAgICBAUGFyYW0oJ2lkJykgaWQ6IHN0cmluZyxcclxuICAgIEBSZXF1ZXN0KCkgcmVxLFxyXG4gICAgQEJvZHkoKSB1cGRhdGVVc2VyUHJvZmlsZUR0bzogVXBkYXRlVXNlclByb2ZpbGVEdG8sXHJcbiAgKSB7XHJcbiAgICByZXR1cm4gdGhpcy51c2VyUHJvZmlsZXNTZXJ2aWNlLnVwZGF0ZShcclxuICAgICAgaWQsXHJcbiAgICAgIHJlcS51c2VyLmlkLFxyXG4gICAgICB1cGRhdGVVc2VyUHJvZmlsZUR0byxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBAUGF0Y2goJzppZCcpXHJcbiAgQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQpXHJcbiAgQEFwaUJlYXJlckF1dGgoKVxyXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnUGFydGlhbGx5IHVwZGF0ZSBhIHByb2ZpbGUnIH0pXHJcbiAgQEFwaVJlc3BvbnNlKHtcclxuICAgIHN0YXR1czogMjAwLFxyXG4gICAgZGVzY3JpcHRpb246ICdUaGUgcHJvZmlsZSBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgdXBkYXRlZC4nLFxyXG4gIH0pXHJcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDMsIGRlc2NyaXB0aW9uOiAnRm9yYmlkZGVuLicgfSlcclxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwNCwgZGVzY3JpcHRpb246ICdQcm9maWxlIG5vdCBmb3VuZC4nIH0pXHJcbiAgcGF0Y2goXHJcbiAgICBAUGFyYW0oJ2lkJykgaWQ6IHN0cmluZyxcclxuICAgIEBSZXF1ZXN0KCkgcmVxLFxyXG4gICAgQEJvZHkoKSB1cGRhdGVVc2VyUHJvZmlsZUR0bzogVXBkYXRlVXNlclByb2ZpbGVEdG8sXHJcbiAgKSB7XHJcbiAgICByZXR1cm4gdGhpcy51c2VyUHJvZmlsZXNTZXJ2aWNlLnBhdGNoKFxyXG4gICAgICBpZCxcclxuICAgICAgcmVxLnVzZXIuaWQsXHJcbiAgICAgIHVwZGF0ZVVzZXJQcm9maWxlRHRvLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIEBEZWxldGUoJzppZCcpXHJcbiAgQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQpXHJcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuTk9fQ09OVEVOVClcclxuICBAQXBpQmVhcmVyQXV0aCgpXHJcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdEZWxldGUgYSBwcm9maWxlJyB9KVxyXG4gIEBBcGlSZXNwb25zZSh7XHJcbiAgICBzdGF0dXM6IDIwNCxcclxuICAgIGRlc2NyaXB0aW9uOiAnVGhlIHByb2ZpbGUgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGRlbGV0ZWQuJyxcclxuICB9KVxyXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDAzLCBkZXNjcmlwdGlvbjogJ0ZvcmJpZGRlbi4nIH0pXHJcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDQsIGRlc2NyaXB0aW9uOiAnUHJvZmlsZSBub3QgZm91bmQuJyB9KVxyXG4gIHJlbW92ZShAUGFyYW0oJ2lkJykgaWQ6IHN0cmluZywgQFJlcXVlc3QoKSByZXEpIHtcclxuICAgIHJldHVybiB0aGlzLnVzZXJQcm9maWxlc1NlcnZpY2UucmVtb3ZlKGlkLCByZXEudXNlci5pZCk7XHJcbiAgfVxyXG5cclxuICBARGVsZXRlKCc6aWQvYWRtaW4nKVxyXG4gIEBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkLCBSb2xlc0d1YXJkKVxyXG4gIEBSb2xlcygnYWRtaW4nKVxyXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLk5PX0NPTlRFTlQpXHJcbiAgQEFwaUJlYXJlckF1dGgoKVxyXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnQWRtaW4gZGVsZXRlIGEgcHJvZmlsZScgfSlcclxuICBAQXBpUmVzcG9uc2Uoe1xyXG4gICAgc3RhdHVzOiAyMDQsXHJcbiAgICBkZXNjcmlwdGlvbjogJ1RoZSBwcm9maWxlIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBkZWxldGVkLicsXHJcbiAgfSlcclxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMywgZGVzY3JpcHRpb246ICdGb3JiaWRkZW4uJyB9KVxyXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDA0LCBkZXNjcmlwdGlvbjogJ1Byb2ZpbGUgbm90IGZvdW5kLicgfSlcclxuICBhZG1pblJlbW92ZShAUGFyYW0oJ2lkJykgaWQ6IHN0cmluZywgQFJlcXVlc3QoKSByZXEpIHtcclxuICAgIC8vIEFkbWluIGNhbiBkZWxldGUgYW55IHByb2ZpbGVcclxuICAgIHJldHVybiB0aGlzLnVzZXJQcm9maWxlc1NlcnZpY2UucmVtb3ZlKGlkLCByZXEudXNlci5pZCk7XHJcbiAgfVxyXG5cclxuICBAR2V0KCdkZXRlY3QtbGFuZ3VhZ2UnKVxyXG5AVXNlR3VhcmRzKEp3dEF1dGhHdWFyZClcclxuQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdEZXRlY3QgYW5kIHN0b3JlIHByZWZlcnJlZCBsYW5ndWFnZScgfSlcclxuQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiAyMDAsIGRlc2NyaXB0aW9uOiAnRGV0ZWN0ZWQgbGFuZ3VhZ2UgcmV0dXJuZWQgYW5kIHNhdmVkLicgfSlcclxuQEFwaUJlYXJlckF1dGgoKVxyXG5hc3luYyBkZXRlY3RMYW5ndWFnZShAUmVxdWVzdCgpIHJlcSwgQEhlYWRlcnMoJ2FjY2VwdC1sYW5ndWFnZScpIGFjY2VwdExhbmd1YWdlOiBzdHJpbmcpIHtcclxuICBjb25zdCBkZXRlY3RlZExhbmcgPSBkZXRlY3RMYW5ndWFnZUZyb21IZWFkZXIoYWNjZXB0TGFuZ3VhZ2UpIHx8ICdlbic7XHJcblxyXG4gIC8vIFNhdmUgdG8gdXNlcidzIHByb2ZpbGVcclxuICBhd2FpdCB0aGlzLnVzZXJQcm9maWxlc1NlcnZpY2Uuc2V0UHJlZmVycmVkTGFuZ3VhZ2UocmVxLnVzZXIuaWQsIGRldGVjdGVkTGFuZyk7XHJcblxyXG4gIHJldHVybiB7IGRldGVjdGVkTGFuZ3VhZ2U6IGRldGVjdGVkTGFuZyB9O1xyXG59XHJcbn1cclxuIl0sInZlcnNpb24iOjN9