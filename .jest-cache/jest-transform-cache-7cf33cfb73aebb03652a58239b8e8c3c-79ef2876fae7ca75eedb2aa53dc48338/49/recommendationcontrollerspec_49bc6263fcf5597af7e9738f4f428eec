3a54fa9bf9fb6f56ddbfe78d0c02d7e4
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const recommendation_controller_1 = require("../controllers/recommendation.controller");
const recommendation_engine_service_1 = require("../services/recommendation-engine.service");
const recommendation_analytics_service_1 = require("../services/recommendation-analytics.service");
const recommendation_entity_1 = require("../entities/recommendation.entity");
describe('RecommendationController', () => {
    let controller;
    let recommendationService;
    let analyticsService;
    const mockUser = {
        id: 'user-1',
        email: 'test@example.com',
        firstName: 'Test',
        lastName: 'User',
    };
    const mockRecommendation = {
        id: 'rec-1',
        userId: 'user-1',
        courseId: 'course-1',
        recommendationType: recommendation_entity_1.RecommendationType.CONTENT_BASED,
        reason: recommendation_entity_1.RecommendationReason.SKILL_BASED,
        confidenceScore: 0.85,
        relevanceScore: 0.80,
        priority: 4,
        explanation: 'Recommended based on your skills',
        status: recommendation_entity_1.RecommendationStatus.ACTIVE,
        metadata: { algorithmUsed: 'content_similarity' },
        course: {
            id: 'course-1',
            title: 'Advanced React',
            description: 'Learn advanced React concepts',
            difficulty: 'intermediate',
            duration: 120,
            rating: 4.5,
        },
        createdAt: new Date(),
        updatedAt: new Date(),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            controllers: [recommendation_controller_1.RecommendationController],
            providers: [
                {
                    provide: recommendation_engine_service_1.RecommendationEngineService,
                    useValue: {
                        generateRecommendations: jest.fn(),
                        getRecommendations: jest.fn(),
                        recordInteraction: jest.fn(),
                        provideFeedback: jest.fn(),
                    },
                },
                {
                    provide: recommendation_analytics_service_1.RecommendationAnalyticsService,
                    useValue: {
                        getUserAnalytics: jest.fn(),
                    },
                },
            ],
        }).compile();
        controller = module.get(recommendation_controller_1.RecommendationController);
        recommendationService = module.get(recommendation_engine_service_1.RecommendationEngineService);
        analyticsService = module.get(recommendation_analytics_service_1.RecommendationAnalyticsService);
    });
    it('should be defined', () => {
        expect(controller).toBeDefined();
    });
    describe('getRecommendations', () => {
        it('should return recommendations with pagination', async () => {
            // Arrange
            const query = {
                limit: 10,
                offset: 0,
                sortBy: 'createdAt',
                sortOrder: 'DESC',
            };
            const serviceResult = {
                recommendations: [mockRecommendation],
                total: 1,
            };
            jest.spyOn(recommendationService, 'getRecommendations').mockResolvedValue(serviceResult);
            // Act
            const result = await controller.getRecommendations(mockUser, query);
            // Assert
            expect(result).toBeDefined();
            expect(result.recommendations).toHaveLength(1);
            expect(result.total).toBe(1);
            expect(result.pagination.page).toBe(1);
            expect(result.pagination.totalPages).toBe(1);
            expect(recommendationService.getRecommendations).toHaveBeenCalledWith(mockUser.id, query);
        });
        it('should handle service errors gracefully', async () => {
            // Arrange
            const query = {
                limit: 10,
                offset: 0,
                sortBy: 'createdAt',
                sortOrder: 'DESC',
            };
            jest.spyOn(recommendationService, 'getRecommendations').mockRejectedValue(new Error('Service error'));
            // Act & Assert
            await expect(controller.getRecommendations(mockUser, query)).rejects.toThrow(common_1.HttpException);
        });
    });
    describe('generateRecommendations', () => {
        it('should generate new recommendations successfully', async () => {
            // Arrange
            const request = {
                limit: 5,
                minConfidence: 0.1,
                sessionId: 'session-1',
                deviceType: 'desktop',
            };
            jest.spyOn(recommendationService, 'generateRecommendations').mockResolvedValue([mockRecommendation]);
            // Act
            const result = await controller.generateRecommendations(mockUser, request);
            // Assert
            expect(result).toBeDefined();
            expect(result.recommendations).toHaveLength(1);
            expect(result.generationTime).toBeDefined();
            expect(recommendationService.generateRecommendations).toHaveBeenCalledWith({
                userId: mockUser.id,
                type: request.type,
                limit: 5,
                minConfidence: 0.1,
                context: {
                    userId: mockUser.id,
                    sessionId: 'session-1',
                    deviceType: 'desktop',
                    context: request.context,
                },
                excludeCourseIds: request.excludeCourseIds,
                includeReasons: request.includeReasons,
            });
        });
        it('should use default values when not provided', async () => {
            // Arrange
            const request = {};
            jest.spyOn(recommendationService, 'generateRecommendations').mockResolvedValue([]);
            // Act
            await controller.generateRecommendations(mockUser, request);
            // Assert
            expect(recommendationService.generateRecommendations).toHaveBeenCalledWith(expect.objectContaining({
                limit: 10,
                minConfidence: 0.1,
            }));
        });
    });
    describe('getRecommendation', () => {
        it('should return specific recommendation and record view', async () => {
            // Arrange
            const recommendationId = 'rec-1';
            const serviceResult = {
                recommendations: [mockRecommendation],
                total: 1,
            };
            jest.spyOn(recommendationService, 'getRecommendations').mockResolvedValue(serviceResult);
            jest.spyOn(recommendationService, 'recordInteraction').mockResolvedValue();
            // Act
            const result = await controller.getRecommendation(mockUser, recommendationId);
            // Assert
            expect(result).toBeDefined();
            expect(result.id).toBe(recommendationId);
            expect(recommendationService.recordInteraction).toHaveBeenCalledWith(recommendationId, 'view');
        });
        it('should throw 404 when recommendation not found', async () => {
            // Arrange
            const recommendationId = 'nonexistent-rec';
            const serviceResult = {
                recommendations: [],
                total: 0,
            };
            jest.spyOn(recommendationService, 'getRecommendations').mockResolvedValue(serviceResult);
            // Act & Assert
            await expect(controller.getRecommendation(mockUser, recommendationId)).rejects.toThrow(new common_1.HttpException('Recommendation not found', common_1.HttpStatus.NOT_FOUND));
        });
    });
    describe('recordInteraction', () => {
        it('should record interaction successfully', async () => {
            // Arrange
            const recommendationId = 'rec-1';
            const body = {
                interactionType: 'click',
                metadata: { source: 'homepage' },
            };
            jest.spyOn(recommendationService, 'recordInteraction').mockResolvedValue();
            // Act
            const result = await controller.recordInteraction(mockUser, recommendationId, body);
            // Assert
            expect(result).toEqual({
                success: true,
                message: 'Interaction recorded successfully',
            });
            expect(recommendationService.recordInteraction).toHaveBeenCalledWith(recommendationId, 'click', body.metadata);
        });
        it('should handle service errors', async () => {
            // Arrange
            const recommendationId = 'rec-1';
            const body = { interactionType: 'click' };
            jest.spyOn(recommendationService, 'recordInteraction').mockRejectedValue(new Error('Service error'));
            // Act & Assert
            await expect(controller.recordInteraction(mockUser, recommendationId, body)).rejects.toThrow(common_1.HttpException);
        });
    });
    describe('provideFeedback', () => {
        it('should record feedback successfully', async () => {
            // Arrange
            const recommendationId = 'rec-1';
            const feedback = {
                score: 4,
                feedbackType: 'explicit',
                comment: 'Great recommendation!',
            };
            jest.spyOn(recommendationService, 'provideFeedback').mockResolvedValue();
            // Act
            const result = await controller.provideFeedback(mockUser, recommendationId, feedback);
            // Assert
            expect(result).toEqual({
                success: true,
                message: 'Feedback recorded successfully',
            });
            expect(recommendationService.provideFeedback).toHaveBeenCalledWith(recommendationId, feedback.score, feedback.feedbackType, feedback.comment);
        });
    });
    describe('dismissRecommendation', () => {
        it('should dismiss recommendation successfully', async () => {
            // Arrange
            const recommendationId = 'rec-1';
            jest.spyOn(recommendationService, 'recordInteraction').mockResolvedValue();
            // Act
            const result = await controller.dismissRecommendation(mockUser, recommendationId);
            // Assert
            expect(result).toEqual({
                success: true,
                message: 'Recommendation dismissed successfully',
            });
            expect(recommendationService.recordInteraction).toHaveBeenCalledWith(recommendationId, 'dismiss');
        });
    });
    describe('getAnalyticsSummary', () => {
        it('should return user analytics summary', async () => {
            // Arrange
            const days = 30;
            const analyticsData = {
                totalRecommendationsReceived: 50,
                totalInteractions: 25,
                averageFeedbackScore: 4.2,
                topRecommendationReasons: ['SKILL_BASED', 'SIMILAR_CONTENT'],
                engagementTrend: [
                    { date: '2023-01-01', interactions: 5 },
                    { date: '2023-01-02', interactions: 3 },
                ],
            };
            jest.spyOn(analyticsService, 'getUserAnalytics').mockResolvedValue(analyticsData);
            // Act
            const result = await controller.getAnalyticsSummary(mockUser, days);
            // Assert
            expect(result).toEqual(analyticsData);
            expect(analyticsService.getUserAnalytics).toHaveBeenCalledWith(mockUser.id, days);
        });
        it('should use default days when not provided', async () => {
            // Arrange
            const analyticsData = {
                totalRecommendationsReceived: 0,
                totalInteractions: 0,
                averageFeedbackScore: 0,
                topRecommendationReasons: [],
                engagementTrend: [],
            };
            jest.spyOn(analyticsService, 'getUserAnalytics').mockResolvedValue(analyticsData);
            // Act
            await controller.getAnalyticsSummary(mockUser);
            // Assert
            expect(analyticsService.getUserAnalytics).toHaveBeenCalledWith(mockUser.id, 30);
        });
    });
    describe('getSimilarCourseRecommendations', () => {
        it('should return similar course recommendations', async () => {
            // Arrange
            const courseId = 'course-1';
            const limit = 5;
            jest.spyOn(recommendationService, 'generateRecommendations').mockResolvedValue([mockRecommendation]);
            // Act
            const result = await controller.getSimilarCourseRecommendations(mockUser, courseId, limit);
            // Assert
            expect(result).toBeDefined();
            expect(result.recommendations).toHaveLength(1);
            expect(result.baseCourse.id).toBe(courseId);
            expect(recommendationService.generateRecommendations).toHaveBeenCalledWith({
                userId: mockUser.id,
                limit,
                minConfidence: 0.3,
                context: {
                    userId: mockUser.id,
                    currentCourse: courseId,
                },
            });
        });
    });
    describe('provideBulkFeedback', () => {
        it('should process bulk feedback successfully', async () => {
            // Arrange
            const feedbackList = [
                {
                    recommendationId: 'rec-1',
                    feedback: { score: 4, feedbackType: 'explicit' },
                },
                {
                    recommendationId: 'rec-2',
                    feedback: { score: 5, feedbackType: 'explicit' },
                },
            ];
            jest.spyOn(recommendationService, 'provideFeedback').mockResolvedValue();
            // Act
            const result = await controller.provideBulkFeedback(mockUser, feedbackList);
            // Assert
            expect(result).toEqual({
                success: true,
                processed: 2,
                failed: 0,
            });
            expect(recommendationService.provideFeedback).toHaveBeenCalledTimes(2);
        });
        it('should handle partial failures in bulk feedback', async () => {
            // Arrange
            const feedbackList = [
                {
                    recommendationId: 'rec-1',
                    feedback: { score: 4, feedbackType: 'explicit' },
                },
                {
                    recommendationId: 'rec-2',
                    feedback: { score: 5, feedbackType: 'explicit' },
                },
            ];
            jest.spyOn(recommendationService, 'provideFeedback')
                .mockResolvedValueOnce()
                .mockRejectedValueOnce(new Error('Service error'));
            // Act
            const result = await controller.provideBulkFeedback(mockUser, feedbackList);
            // Assert
            expect(result).toEqual({
                success: false,
                processed: 1,
                failed: 1,
            });
        });
    });
    describe('getTrendingTopics', () => {
        it('should return trending topics and skills', async () => {
            // Act
            const result = await controller.getTrendingTopics();
            // Assert
            expect(result).toBeDefined();
            expect(result.trendingSkills).toBeDefined();
            expect(result.trendingTopics).toBeDefined();
            expect(Array.isArray(result.trendingSkills)).toBe(true);
            expect(Array.isArray(result.trendingTopics)).toBe(true);
        });
    });
    describe('mapToResponseDto', () => {
        it('should map recommendation entity to response DTO correctly', () => {
            // Act
            const result = controller.mapToResponseDto(mockRecommendation);
            // Assert
            expect(result).toBeDefined();
            expect(result.id).toBe(mockRecommendation.id);
            expect(result.courseId).toBe(mockRecommendation.courseId);
            expect(result.recommendationType).toBe(mockRecommendation.recommendationType);
            expect(result.course).toBeDefined();
            expect(result.course.id).toBe(mockRecommendation.course.id);
        });
        it('should handle recommendation without course', () => {
            // Arrange
            const recWithoutCourse = { ...mockRecommendation, course: null };
            // Act
            const result = controller.mapToResponseDto(recWithoutCourse);
            // Assert
            expect(result).toBeDefined();
            expect(result.course).toBeUndefined();
        });
    });
    describe('error handling', () => {
        it('should handle unexpected errors gracefully', async () => {
            // Arrange
            const query = {
                limit: 10,
                offset: 0,
                sortBy: 'createdAt',
                sortOrder: 'DESC',
            };
            jest.spyOn(recommendationService, 'getRecommendations').mockRejectedValue(new Error('Unexpected error'));
            // Act & Assert
            await expect(controller.getRecommendations(mockUser, query)).rejects.toThrow(new common_1.HttpException('Failed to get recommendations', common_1.HttpStatus.INTERNAL_SERVER_ERROR));
        });
        it('should preserve HttpExceptions from service layer', async () => {
            // Arrange
            const recommendationId = 'rec-1';
            const serviceResult = {
                recommendations: [],
                total: 0,
            };
            jest.spyOn(recommendationService, 'getRecommendations').mockResolvedValue(serviceResult);
            // Act & Assert
            await expect(controller.getRecommendation(mockUser, recommendationId)).rejects.toThrow(common_1.HttpException);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxyZWNvbW1lbmRhdGlvblxcX190ZXN0c19fXFxyZWNvbW1lbmRhdGlvbi5jb250cm9sbGVyLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFDdEQsMkNBQTJEO0FBQzNELHdGQUFvRjtBQUNwRiw2RkFBd0Y7QUFDeEYsbUdBQThGO0FBRTlGLDZFQUFtSTtBQUVuSSxRQUFRLENBQUMsMEJBQTBCLEVBQUUsR0FBRyxFQUFFO0lBQ3hDLElBQUksVUFBb0MsQ0FBQztJQUN6QyxJQUFJLHFCQUFrRCxDQUFDO0lBQ3ZELElBQUksZ0JBQWdELENBQUM7SUFFckQsTUFBTSxRQUFRLEdBQVM7UUFDckIsRUFBRSxFQUFFLFFBQVE7UUFDWixLQUFLLEVBQUUsa0JBQWtCO1FBQ3pCLFNBQVMsRUFBRSxNQUFNO1FBQ2pCLFFBQVEsRUFBRSxNQUFNO0tBQ1QsQ0FBQztJQUVWLE1BQU0sa0JBQWtCLEdBQW1CO1FBQ3pDLEVBQUUsRUFBRSxPQUFPO1FBQ1gsTUFBTSxFQUFFLFFBQVE7UUFDaEIsUUFBUSxFQUFFLFVBQVU7UUFDcEIsa0JBQWtCLEVBQUUsMENBQWtCLENBQUMsYUFBYTtRQUNwRCxNQUFNLEVBQUUsNENBQW9CLENBQUMsV0FBVztRQUN4QyxlQUFlLEVBQUUsSUFBSTtRQUNyQixjQUFjLEVBQUUsSUFBSTtRQUNwQixRQUFRLEVBQUUsQ0FBQztRQUNYLFdBQVcsRUFBRSxrQ0FBa0M7UUFDL0MsTUFBTSxFQUFFLDRDQUFvQixDQUFDLE1BQU07UUFDbkMsUUFBUSxFQUFFLEVBQUUsYUFBYSxFQUFFLG9CQUFvQixFQUFFO1FBQ2pELE1BQU0sRUFBRTtZQUNOLEVBQUUsRUFBRSxVQUFVO1lBQ2QsS0FBSyxFQUFFLGdCQUFnQjtZQUN2QixXQUFXLEVBQUUsK0JBQStCO1lBQzVDLFVBQVUsRUFBRSxjQUFjO1lBQzFCLFFBQVEsRUFBRSxHQUFHO1lBQ2IsTUFBTSxFQUFFLEdBQUc7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Q0FBQyxPQUFPLENBQUMsc0JBQWEsQ0FBQyxDQUFDO1FBQ3hHLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXG9qb3NlcGhcXERvY3VtZW50c1xcU3RyZWxsZXJNaW5kcy1CYWNrZW5kXFxzcmNcXHJlY29tbWVuZGF0aW9uXFxfX3Rlc3RzX19cXHJlY29tbWVuZGF0aW9uLmNvbnRyb2xsZXIuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcclxuaW1wb3J0IHsgSHR0cEV4Y2VwdGlvbiwgSHR0cFN0YXR1cyB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcclxuaW1wb3J0IHsgUmVjb21tZW5kYXRpb25Db250cm9sbGVyIH0gZnJvbSAnLi4vY29udHJvbGxlcnMvcmVjb21tZW5kYXRpb24uY29udHJvbGxlcic7XHJcbmltcG9ydCB7IFJlY29tbWVuZGF0aW9uRW5naW5lU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3JlY29tbWVuZGF0aW9uLWVuZ2luZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgUmVjb21tZW5kYXRpb25BbmFseXRpY3NTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvcmVjb21tZW5kYXRpb24tYW5hbHl0aWNzLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBVc2VyIH0gZnJvbSAnLi4vLi4vdXNlcnMvZW50aXRpZXMvdXNlci5lbnRpdHknO1xyXG5pbXBvcnQgeyBSZWNvbW1lbmRhdGlvbiwgUmVjb21tZW5kYXRpb25UeXBlLCBSZWNvbW1lbmRhdGlvblJlYXNvbiwgUmVjb21tZW5kYXRpb25TdGF0dXMgfSBmcm9tICcuLi9lbnRpdGllcy9yZWNvbW1lbmRhdGlvbi5lbnRpdHknO1xyXG5cclxuZGVzY3JpYmUoJ1JlY29tbWVuZGF0aW9uQ29udHJvbGxlcicsICgpID0+IHtcclxuICBsZXQgY29udHJvbGxlcjogUmVjb21tZW5kYXRpb25Db250cm9sbGVyO1xyXG4gIGxldCByZWNvbW1lbmRhdGlvblNlcnZpY2U6IFJlY29tbWVuZGF0aW9uRW5naW5lU2VydmljZTtcclxuICBsZXQgYW5hbHl0aWNzU2VydmljZTogUmVjb21tZW5kYXRpb25BbmFseXRpY3NTZXJ2aWNlO1xyXG5cclxuICBjb25zdCBtb2NrVXNlcjogVXNlciA9IHtcclxuICAgIGlkOiAndXNlci0xJyxcclxuICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXHJcbiAgICBmaXJzdE5hbWU6ICdUZXN0JyxcclxuICAgIGxhc3ROYW1lOiAnVXNlcicsXHJcbiAgfSBhcyBVc2VyO1xyXG5cclxuICBjb25zdCBtb2NrUmVjb21tZW5kYXRpb246IFJlY29tbWVuZGF0aW9uID0ge1xyXG4gICAgaWQ6ICdyZWMtMScsXHJcbiAgICB1c2VySWQ6ICd1c2VyLTEnLFxyXG4gICAgY291cnNlSWQ6ICdjb3Vyc2UtMScsXHJcbiAgICByZWNvbW1lbmRhdGlvblR5cGU6IFJlY29tbWVuZGF0aW9uVHlwZS5DT05URU5UX0JBU0VELFxyXG4gICAgcmVhc29uOiBSZWNvbW1lbmRhdGlvblJlYXNvbi5TS0lMTF9CQVNFRCxcclxuICAgIGNvbmZpZGVuY2VTY29yZTogMC44NSxcclxuICAgIHJlbGV2YW5jZVNjb3JlOiAwLjgwLFxyXG4gICAgcHJpb3JpdHk6IDQsXHJcbiAgICBleHBsYW5hdGlvbjogJ1JlY29tbWVuZGVkIGJhc2VkIG9uIHlvdXIgc2tpbGxzJyxcclxuICAgIHN0YXR1czogUmVjb21tZW5kYXRpb25TdGF0dXMuQUNUSVZFLFxyXG4gICAgbWV0YWRhdGE6IHsgYWxnb3JpdGhtVXNlZDogJ2NvbnRlbnRfc2ltaWxhcml0eScgfSxcclxuICAgIGNvdXJzZToge1xyXG4gICAgICBpZDogJ2NvdXJzZS0xJyxcclxuICAgICAgdGl0bGU6ICdBZHZhbmNlZCBSZWFjdCcsXHJcbiAgICAgIGRlc2NyaXB0aW9uOiAnTGVhcm4gYWR2YW5jZWQgUmVhY3QgY29uY2VwdHMnLFxyXG4gICAgICBkaWZmaWN1bHR5OiAnaW50ZXJtZWRpYXRlJyxcclxuICAgICAgZHVyYXRpb246IDEyMCxcclxuICAgICAgcmF0aW5nOiA0LjUsXHJcbiAgICB9LFxyXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gIH0gYXMgUmVjb21tZW5kYXRpb247XHJcblxyXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcclxuICAgICAgY29udHJvbGxlcnM6IFtSZWNvbW1lbmRhdGlvbkNvbnRyb2xsZXJdLFxyXG4gICAgICBwcm92aWRlcnM6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBwcm92aWRlOiBSZWNvbW1lbmRhdGlvbkVuZ2luZVNlcnZpY2UsXHJcbiAgICAgICAgICB1c2VWYWx1ZToge1xyXG4gICAgICAgICAgICBnZW5lcmF0ZVJlY29tbWVuZGF0aW9uczogamVzdC5mbigpLFxyXG4gICAgICAgICAgICBnZXRSZWNvbW1lbmRhdGlvbnM6IGplc3QuZm4oKSxcclxuICAgICAgICAgICAgcmVjb3JkSW50ZXJhY3Rpb246IGplc3QuZm4oKSxcclxuICAgICAgICAgICAgcHJvdmlkZUZlZWRiYWNrOiBqZXN0LmZuKCksXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgcHJvdmlkZTogUmVjb21tZW5kYXRpb25BbmFseXRpY3NTZXJ2aWNlLFxyXG4gICAgICAgICAgdXNlVmFsdWU6IHtcclxuICAgICAgICAgICAgZ2V0VXNlckFuYWx5dGljczogamVzdC5mbigpLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICBdLFxyXG4gICAgfSkuY29tcGlsZSgpO1xyXG5cclxuICAgIGNvbnRyb2xsZXIgPSBtb2R1bGUuZ2V0PFJlY29tbWVuZGF0aW9uQ29udHJvbGxlcj4oUmVjb21tZW5kYXRpb25Db250cm9sbGVyKTtcclxuICAgIHJlY29tbWVuZGF0aW9uU2VydmljZSA9IG1vZHVsZS5nZXQ8UmVjb21tZW5kYXRpb25FbmdpbmVTZXJ2aWNlPihSZWNvbW1lbmRhdGlvbkVuZ2luZVNlcnZpY2UpO1xyXG4gICAgYW5hbHl0aWNzU2VydmljZSA9IG1vZHVsZS5nZXQ8UmVjb21tZW5kYXRpb25BbmFseXRpY3NTZXJ2aWNlPihSZWNvbW1lbmRhdGlvbkFuYWx5dGljc1NlcnZpY2UpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIGJlIGRlZmluZWQnLCAoKSA9PiB7XHJcbiAgICBleHBlY3QoY29udHJvbGxlcikudG9CZURlZmluZWQoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldFJlY29tbWVuZGF0aW9ucycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHJlY29tbWVuZGF0aW9ucyB3aXRoIHBhZ2luYXRpb24nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgcXVlcnkgPSB7XHJcbiAgICAgICAgbGltaXQ6IDEwLFxyXG4gICAgICAgIG9mZnNldDogMCxcclxuICAgICAgICBzb3J0Qnk6ICdjcmVhdGVkQXQnLFxyXG4gICAgICAgIHNvcnRPcmRlcjogJ0RFU0MnIGFzICdERVNDJyxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IHNlcnZpY2VSZXN1bHQgPSB7XHJcbiAgICAgICAgcmVjb21tZW5kYXRpb25zOiBbbW9ja1JlY29tbWVuZGF0aW9uXSxcclxuICAgICAgICB0b3RhbDogMSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGplc3Quc3B5T24ocmVjb21tZW5kYXRpb25TZXJ2aWNlLCAnZ2V0UmVjb21tZW5kYXRpb25zJykubW9ja1Jlc29sdmVkVmFsdWUoc2VydmljZVJlc3VsdCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRSZWNvbW1lbmRhdGlvbnMobW9ja1VzZXIsIHF1ZXJ5KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnJlY29tbWVuZGF0aW9ucykudG9IYXZlTGVuZ3RoKDEpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsKS50b0JlKDEpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnBhZ2luYXRpb24ucGFnZSkudG9CZSgxKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5wYWdpbmF0aW9uLnRvdGFsUGFnZXMpLnRvQmUoMSk7XHJcbiAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvblNlcnZpY2UuZ2V0UmVjb21tZW5kYXRpb25zKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrVXNlci5pZCwgcXVlcnkpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBxdWVyeSA9IHtcclxuICAgICAgICBsaW1pdDogMTAsXHJcbiAgICAgICAgb2Zmc2V0OiAwLFxyXG4gICAgICAgIHNvcnRCeTogJ2NyZWF0ZWRBdCcsXHJcbiAgICAgICAgc29ydE9yZGVyOiAnREVTQycgYXMgJ0RFU0MnLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgamVzdC5zcHlPbihyZWNvbW1lbmRhdGlvblNlcnZpY2UsICdnZXRSZWNvbW1lbmRhdGlvbnMnKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1NlcnZpY2UgZXJyb3InKSk7XHJcblxyXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcclxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZ2V0UmVjb21tZW5kYXRpb25zKG1vY2tVc2VyLCBxdWVyeSkpLnJlamVjdHMudG9UaHJvdyhIdHRwRXhjZXB0aW9uKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIG5ldyByZWNvbW1lbmRhdGlvbnMgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSB7XHJcbiAgICAgICAgbGltaXQ6IDUsXHJcbiAgICAgICAgbWluQ29uZmlkZW5jZTogMC4xLFxyXG4gICAgICAgIHNlc3Npb25JZDogJ3Nlc3Npb24tMScsXHJcbiAgICAgICAgZGV2aWNlVHlwZTogJ2Rlc2t0b3AnLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgamVzdC5zcHlPbihyZWNvbW1lbmRhdGlvblNlcnZpY2UsICdnZW5lcmF0ZVJlY29tbWVuZGF0aW9ucycpLm1vY2tSZXNvbHZlZFZhbHVlKFttb2NrUmVjb21tZW5kYXRpb25dKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdlbmVyYXRlUmVjb21tZW5kYXRpb25zKG1vY2tVc2VyLCByZXF1ZXN0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnJlY29tbWVuZGF0aW9ucykudG9IYXZlTGVuZ3RoKDEpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmdlbmVyYXRpb25UaW1lKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QocmVjb21tZW5kYXRpb25TZXJ2aWNlLmdlbmVyYXRlUmVjb21tZW5kYXRpb25zKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgdXNlcklkOiBtb2NrVXNlci5pZCxcclxuICAgICAgICB0eXBlOiByZXF1ZXN0LnR5cGUsXHJcbiAgICAgICAgbGltaXQ6IDUsXHJcbiAgICAgICAgbWluQ29uZmlkZW5jZTogMC4xLFxyXG4gICAgICAgIGNvbnRleHQ6IHtcclxuICAgICAgICAgIHVzZXJJZDogbW9ja1VzZXIuaWQsXHJcbiAgICAgICAgICBzZXNzaW9uSWQ6ICdzZXNzaW9uLTEnLFxyXG4gICAgICAgICAgZGV2aWNlVHlwZTogJ2Rlc2t0b3AnLFxyXG4gICAgICAgICAgY29udGV4dDogcmVxdWVzdC5jb250ZXh0LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXhjbHVkZUNvdXJzZUlkczogcmVxdWVzdC5leGNsdWRlQ291cnNlSWRzLFxyXG4gICAgICAgIGluY2x1ZGVSZWFzb25zOiByZXF1ZXN0LmluY2x1ZGVSZWFzb25zLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdXNlIGRlZmF1bHQgdmFsdWVzIHdoZW4gbm90IHByb3ZpZGVkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSB7fTtcclxuXHJcbiAgICAgIGplc3Quc3B5T24ocmVjb21tZW5kYXRpb25TZXJ2aWNlLCAnZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMnKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgY29udHJvbGxlci5nZW5lcmF0ZVJlY29tbWVuZGF0aW9ucyhtb2NrVXNlciwgcmVxdWVzdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uU2VydmljZS5nZW5lcmF0ZVJlY29tbWVuZGF0aW9ucykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgbGltaXQ6IDEwLFxyXG4gICAgICAgICAgbWluQ29uZmlkZW5jZTogMC4xLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldFJlY29tbWVuZGF0aW9uJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gc3BlY2lmaWMgcmVjb21tZW5kYXRpb24gYW5kIHJlY29yZCB2aWV3JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uSWQgPSAncmVjLTEnO1xyXG4gICAgICBjb25zdCBzZXJ2aWNlUmVzdWx0ID0ge1xyXG4gICAgICAgIHJlY29tbWVuZGF0aW9uczogW21vY2tSZWNvbW1lbmRhdGlvbl0sXHJcbiAgICAgICAgdG90YWw6IDEsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBqZXN0LnNweU9uKHJlY29tbWVuZGF0aW9uU2VydmljZSwgJ2dldFJlY29tbWVuZGF0aW9ucycpLm1vY2tSZXNvbHZlZFZhbHVlKHNlcnZpY2VSZXN1bHQpO1xyXG4gICAgICBqZXN0LnNweU9uKHJlY29tbWVuZGF0aW9uU2VydmljZSwgJ3JlY29yZEludGVyYWN0aW9uJykubW9ja1Jlc29sdmVkVmFsdWUoKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFJlY29tbWVuZGF0aW9uKG1vY2tVc2VyLCByZWNvbW1lbmRhdGlvbklkKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmlkKS50b0JlKHJlY29tbWVuZGF0aW9uSWQpO1xyXG4gICAgICBleHBlY3QocmVjb21tZW5kYXRpb25TZXJ2aWNlLnJlY29yZEludGVyYWN0aW9uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChyZWNvbW1lbmRhdGlvbklkLCAndmlldycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyA0MDQgd2hlbiByZWNvbW1lbmRhdGlvbiBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgcmVjb21tZW5kYXRpb25JZCA9ICdub25leGlzdGVudC1yZWMnO1xyXG4gICAgICBjb25zdCBzZXJ2aWNlUmVzdWx0ID0ge1xyXG4gICAgICAgIHJlY29tbWVuZGF0aW9uczogW10sXHJcbiAgICAgICAgdG90YWw6IDAsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBqZXN0LnNweU9uKHJlY29tbWVuZGF0aW9uU2VydmljZSwgJ2dldFJlY29tbWVuZGF0aW9ucycpLm1vY2tSZXNvbHZlZFZhbHVlKHNlcnZpY2VSZXN1bHQpO1xyXG5cclxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XHJcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmdldFJlY29tbWVuZGF0aW9uKG1vY2tVc2VyLCByZWNvbW1lbmRhdGlvbklkKSkucmVqZWN0cy50b1Rocm93KFxyXG4gICAgICAgIG5ldyBIdHRwRXhjZXB0aW9uKCdSZWNvbW1lbmRhdGlvbiBub3QgZm91bmQnLCBIdHRwU3RhdHVzLk5PVF9GT1VORClcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgncmVjb3JkSW50ZXJhY3Rpb24nLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJlY29yZCBpbnRlcmFjdGlvbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgcmVjb21tZW5kYXRpb25JZCA9ICdyZWMtMSc7XHJcbiAgICAgIGNvbnN0IGJvZHkgPSB7XHJcbiAgICAgICAgaW50ZXJhY3Rpb25UeXBlOiAnY2xpY2snIGFzICdjbGljaycsXHJcbiAgICAgICAgbWV0YWRhdGE6IHsgc291cmNlOiAnaG9tZXBhZ2UnIH0sXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBqZXN0LnNweU9uKHJlY29tbWVuZGF0aW9uU2VydmljZSwgJ3JlY29yZEludGVyYWN0aW9uJykubW9ja1Jlc29sdmVkVmFsdWUoKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnJlY29yZEludGVyYWN0aW9uKG1vY2tVc2VyLCByZWNvbW1lbmRhdGlvbklkLCBib2R5KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdJbnRlcmFjdGlvbiByZWNvcmRlZCBzdWNjZXNzZnVsbHknLFxyXG4gICAgICB9KTtcclxuICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uU2VydmljZS5yZWNvcmRJbnRlcmFjdGlvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgcmVjb21tZW5kYXRpb25JZCxcclxuICAgICAgICAnY2xpY2snLFxyXG4gICAgICAgIGJvZHkubWV0YWRhdGFcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlcnZpY2UgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uSWQgPSAncmVjLTEnO1xyXG4gICAgICBjb25zdCBib2R5ID0geyBpbnRlcmFjdGlvblR5cGU6ICdjbGljaycgYXMgJ2NsaWNrJyB9O1xyXG5cclxuICAgICAgamVzdC5zcHlPbihyZWNvbW1lbmRhdGlvblNlcnZpY2UsICdyZWNvcmRJbnRlcmFjdGlvbicpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignU2VydmljZSBlcnJvcicpKTtcclxuXHJcbiAgICAgIC8vIEFjdCAmIEFzc2VydFxyXG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5yZWNvcmRJbnRlcmFjdGlvbihtb2NrVXNlciwgcmVjb21tZW5kYXRpb25JZCwgYm9keSkpLnJlamVjdHMudG9UaHJvdyhIdHRwRXhjZXB0aW9uKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgncHJvdmlkZUZlZWRiYWNrJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZWNvcmQgZmVlZGJhY2sgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uSWQgPSAncmVjLTEnO1xyXG4gICAgICBjb25zdCBmZWVkYmFjayA9IHtcclxuICAgICAgICBzY29yZTogNCxcclxuICAgICAgICBmZWVkYmFja1R5cGU6ICdleHBsaWNpdCcgYXMgJ2V4cGxpY2l0JyxcclxuICAgICAgICBjb21tZW50OiAnR3JlYXQgcmVjb21tZW5kYXRpb24hJyxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGplc3Quc3B5T24ocmVjb21tZW5kYXRpb25TZXJ2aWNlLCAncHJvdmlkZUZlZWRiYWNrJykubW9ja1Jlc29sdmVkVmFsdWUoKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnByb3ZpZGVGZWVkYmFjayhtb2NrVXNlciwgcmVjb21tZW5kYXRpb25JZCwgZmVlZGJhY2spO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgbWVzc2FnZTogJ0ZlZWRiYWNrIHJlY29yZGVkIHN1Y2Nlc3NmdWxseScsXHJcbiAgICAgIH0pO1xyXG4gICAgICBleHBlY3QocmVjb21tZW5kYXRpb25TZXJ2aWNlLnByb3ZpZGVGZWVkYmFjaykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgcmVjb21tZW5kYXRpb25JZCxcclxuICAgICAgICBmZWVkYmFjay5zY29yZSxcclxuICAgICAgICBmZWVkYmFjay5mZWVkYmFja1R5cGUsXHJcbiAgICAgICAgZmVlZGJhY2suY29tbWVudFxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdkaXNtaXNzUmVjb21tZW5kYXRpb24nLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGRpc21pc3MgcmVjb21tZW5kYXRpb24gc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uSWQgPSAncmVjLTEnO1xyXG5cclxuICAgICAgamVzdC5zcHlPbihyZWNvbW1lbmRhdGlvblNlcnZpY2UsICdyZWNvcmRJbnRlcmFjdGlvbicpLm1vY2tSZXNvbHZlZFZhbHVlKCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5kaXNtaXNzUmVjb21tZW5kYXRpb24obW9ja1VzZXIsIHJlY29tbWVuZGF0aW9uSWQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgbWVzc2FnZTogJ1JlY29tbWVuZGF0aW9uIGRpc21pc3NlZCBzdWNjZXNzZnVsbHknLFxyXG4gICAgICB9KTtcclxuICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uU2VydmljZS5yZWNvcmRJbnRlcmFjdGlvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgocmVjb21tZW5kYXRpb25JZCwgJ2Rpc21pc3MnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0QW5hbHl0aWNzU3VtbWFyeScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHVzZXIgYW5hbHl0aWNzIHN1bW1hcnknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZGF5cyA9IDMwO1xyXG4gICAgICBjb25zdCBhbmFseXRpY3NEYXRhID0ge1xyXG4gICAgICAgIHRvdGFsUmVjb21tZW5kYXRpb25zUmVjZWl2ZWQ6IDUwLFxyXG4gICAgICAgIHRvdGFsSW50ZXJhY3Rpb25zOiAyNSxcclxuICAgICAgICBhdmVyYWdlRmVlZGJhY2tTY29yZTogNC4yLFxyXG4gICAgICAgIHRvcFJlY29tbWVuZGF0aW9uUmVhc29uczogWydTS0lMTF9CQVNFRCcsICdTSU1JTEFSX0NPTlRFTlQnXSxcclxuICAgICAgICBlbmdhZ2VtZW50VHJlbmQ6IFtcclxuICAgICAgICAgIHsgZGF0ZTogJzIwMjMtMDEtMDEnLCBpbnRlcmFjdGlvbnM6IDUgfSxcclxuICAgICAgICAgIHsgZGF0ZTogJzIwMjMtMDEtMDInLCBpbnRlcmFjdGlvbnM6IDMgfSxcclxuICAgICAgICBdLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgamVzdC5zcHlPbihhbmFseXRpY3NTZXJ2aWNlLCAnZ2V0VXNlckFuYWx5dGljcycpLm1vY2tSZXNvbHZlZFZhbHVlKGFuYWx5dGljc0RhdGEpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0QW5hbHl0aWNzU3VtbWFyeShtb2NrVXNlciwgZGF5cyk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChhbmFseXRpY3NEYXRhKTtcclxuICAgICAgZXhwZWN0KGFuYWx5dGljc1NlcnZpY2UuZ2V0VXNlckFuYWx5dGljcykudG9IYXZlQmVlbkNhbGxlZFdpdGgobW9ja1VzZXIuaWQsIGRheXMpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB1c2UgZGVmYXVsdCBkYXlzIHdoZW4gbm90IHByb3ZpZGVkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGFuYWx5dGljc0RhdGEgPSB7XHJcbiAgICAgICAgdG90YWxSZWNvbW1lbmRhdGlvbnNSZWNlaXZlZDogMCxcclxuICAgICAgICB0b3RhbEludGVyYWN0aW9uczogMCxcclxuICAgICAgICBhdmVyYWdlRmVlZGJhY2tTY29yZTogMCxcclxuICAgICAgICB0b3BSZWNvbW1lbmRhdGlvblJlYXNvbnM6IFtdLFxyXG4gICAgICAgIGVuZ2FnZW1lbnRUcmVuZDogW10sXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBqZXN0LnNweU9uKGFuYWx5dGljc1NlcnZpY2UsICdnZXRVc2VyQW5hbHl0aWNzJykubW9ja1Jlc29sdmVkVmFsdWUoYW5hbHl0aWNzRGF0YSk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgY29udHJvbGxlci5nZXRBbmFseXRpY3NTdW1tYXJ5KG1vY2tVc2VyKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QoYW5hbHl0aWNzU2VydmljZS5nZXRVc2VyQW5hbHl0aWNzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrVXNlci5pZCwgMzApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRTaW1pbGFyQ291cnNlUmVjb21tZW5kYXRpb25zJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gc2ltaWxhciBjb3Vyc2UgcmVjb21tZW5kYXRpb25zJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGNvdXJzZUlkID0gJ2NvdXJzZS0xJztcclxuICAgICAgY29uc3QgbGltaXQgPSA1O1xyXG5cclxuICAgICAgamVzdC5zcHlPbihyZWNvbW1lbmRhdGlvblNlcnZpY2UsICdnZW5lcmF0ZVJlY29tbWVuZGF0aW9ucycpLm1vY2tSZXNvbHZlZFZhbHVlKFttb2NrUmVjb21tZW5kYXRpb25dKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFNpbWlsYXJDb3Vyc2VSZWNvbW1lbmRhdGlvbnMobW9ja1VzZXIsIGNvdXJzZUlkLCBsaW1pdCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5yZWNvbW1lbmRhdGlvbnMpLnRvSGF2ZUxlbmd0aCgxKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5iYXNlQ291cnNlLmlkKS50b0JlKGNvdXJzZUlkKTtcclxuICAgICAgZXhwZWN0KHJlY29tbWVuZGF0aW9uU2VydmljZS5nZW5lcmF0ZVJlY29tbWVuZGF0aW9ucykudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIHVzZXJJZDogbW9ja1VzZXIuaWQsXHJcbiAgICAgICAgbGltaXQsXHJcbiAgICAgICAgbWluQ29uZmlkZW5jZTogMC4zLFxyXG4gICAgICAgIGNvbnRleHQ6IHtcclxuICAgICAgICAgIHVzZXJJZDogbW9ja1VzZXIuaWQsXHJcbiAgICAgICAgICBjdXJyZW50Q291cnNlOiBjb3Vyc2VJZCxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgncHJvdmlkZUJ1bGtGZWVkYmFjaycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcHJvY2VzcyBidWxrIGZlZWRiYWNrIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBmZWVkYmFja0xpc3QgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgcmVjb21tZW5kYXRpb25JZDogJ3JlYy0xJyxcclxuICAgICAgICAgIGZlZWRiYWNrOiB7IHNjb3JlOiA0LCBmZWVkYmFja1R5cGU6ICdleHBsaWNpdCcgYXMgJ2V4cGxpY2l0JyB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgcmVjb21tZW5kYXRpb25JZDogJ3JlYy0yJyxcclxuICAgICAgICAgIGZlZWRiYWNrOiB7IHNjb3JlOiA1LCBmZWVkYmFja1R5cGU6ICdleHBsaWNpdCcgYXMgJ2V4cGxpY2l0JyB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF07XHJcblxyXG4gICAgICBqZXN0LnNweU9uKHJlY29tbWVuZGF0aW9uU2VydmljZSwgJ3Byb3ZpZGVGZWVkYmFjaycpLm1vY2tSZXNvbHZlZFZhbHVlKCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5wcm92aWRlQnVsa0ZlZWRiYWNrKG1vY2tVc2VyLCBmZWVkYmFja0xpc3QpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgcHJvY2Vzc2VkOiAyLFxyXG4gICAgICAgIGZhaWxlZDogMCxcclxuICAgICAgfSk7XHJcbiAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvblNlcnZpY2UucHJvdmlkZUZlZWRiYWNrKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBwYXJ0aWFsIGZhaWx1cmVzIGluIGJ1bGsgZmVlZGJhY2snLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZmVlZGJhY2tMaXN0ID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIHJlY29tbWVuZGF0aW9uSWQ6ICdyZWMtMScsXHJcbiAgICAgICAgICBmZWVkYmFjazogeyBzY29yZTogNCwgZmVlZGJhY2tUeXBlOiAnZXhwbGljaXQnIGFzICdleHBsaWNpdCcgfSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHJlY29tbWVuZGF0aW9uSWQ6ICdyZWMtMicsXHJcbiAgICAgICAgICBmZWVkYmFjazogeyBzY29yZTogNSwgZmVlZGJhY2tUeXBlOiAnZXhwbGljaXQnIGFzICdleHBsaWNpdCcgfSxcclxuICAgICAgICB9LFxyXG4gICAgICBdO1xyXG5cclxuICAgICAgamVzdC5zcHlPbihyZWNvbW1lbmRhdGlvblNlcnZpY2UsICdwcm92aWRlRmVlZGJhY2snKVxyXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoKVxyXG4gICAgICAgIC5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UobmV3IEVycm9yKCdTZXJ2aWNlIGVycm9yJykpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIucHJvdmlkZUJ1bGtGZWVkYmFjayhtb2NrVXNlciwgZmVlZGJhY2tMaXN0KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBwcm9jZXNzZWQ6IDEsXHJcbiAgICAgICAgZmFpbGVkOiAxLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0VHJlbmRpbmdUb3BpY3MnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiB0cmVuZGluZyB0b3BpY3MgYW5kIHNraWxscycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0VHJlbmRpbmdUb3BpY3MoKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnRyZW5kaW5nU2tpbGxzKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnRyZW5kaW5nVG9waWNzKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXN1bHQudHJlbmRpbmdTa2lsbHMpKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXN1bHQudHJlbmRpbmdUb3BpY3MpKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdtYXBUb1Jlc3BvbnNlRHRvJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBtYXAgcmVjb21tZW5kYXRpb24gZW50aXR5IHRvIHJlc3BvbnNlIERUTyBjb3JyZWN0bHknLCAoKSA9PiB7XHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSAoY29udHJvbGxlciBhcyBhbnkpLm1hcFRvUmVzcG9uc2VEdG8obW9ja1JlY29tbWVuZGF0aW9uKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmlkKS50b0JlKG1vY2tSZWNvbW1lbmRhdGlvbi5pZCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuY291cnNlSWQpLnRvQmUobW9ja1JlY29tbWVuZGF0aW9uLmNvdXJzZUlkKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5yZWNvbW1lbmRhdGlvblR5cGUpLnRvQmUobW9ja1JlY29tbWVuZGF0aW9uLnJlY29tbWVuZGF0aW9uVHlwZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuY291cnNlKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmNvdXJzZS5pZCkudG9CZShtb2NrUmVjb21tZW5kYXRpb24uY291cnNlLmlkKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHJlY29tbWVuZGF0aW9uIHdpdGhvdXQgY291cnNlJywgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHJlY1dpdGhvdXRDb3Vyc2UgPSB7IC4uLm1vY2tSZWNvbW1lbmRhdGlvbiwgY291cnNlOiBudWxsIH07XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzdWx0ID0gKGNvbnRyb2xsZXIgYXMgYW55KS5tYXBUb1Jlc3BvbnNlRHRvKHJlY1dpdGhvdXRDb3Vyc2UpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuY291cnNlKS50b0JlVW5kZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2Vycm9yIGhhbmRsaW5nJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdW5leHBlY3RlZCBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBxdWVyeSA9IHtcclxuICAgICAgICBsaW1pdDogMTAsXHJcbiAgICAgICAgb2Zmc2V0OiAwLFxyXG4gICAgICAgIHNvcnRCeTogJ2NyZWF0ZWRBdCcsXHJcbiAgICAgICAgc29ydE9yZGVyOiAnREVTQycgYXMgJ0RFU0MnLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgamVzdC5zcHlPbihyZWNvbW1lbmRhdGlvblNlcnZpY2UsICdnZXRSZWNvbW1lbmRhdGlvbnMnKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1VuZXhwZWN0ZWQgZXJyb3InKSk7XHJcblxyXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcclxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZ2V0UmVjb21tZW5kYXRpb25zKG1vY2tVc2VyLCBxdWVyeSkpLnJlamVjdHMudG9UaHJvdyhcclxuICAgICAgICBuZXcgSHR0cEV4Y2VwdGlvbignRmFpbGVkIHRvIGdldCByZWNvbW1lbmRhdGlvbnMnLCBIdHRwU3RhdHVzLklOVEVSTkFMX1NFUlZFUl9FUlJPUilcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcHJlc2VydmUgSHR0cEV4Y2VwdGlvbnMgZnJvbSBzZXJ2aWNlIGxheWVyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uSWQgPSAncmVjLTEnO1xyXG4gICAgICBjb25zdCBzZXJ2aWNlUmVzdWx0ID0ge1xyXG4gICAgICAgIHJlY29tbWVuZGF0aW9uczogW10sXHJcbiAgICAgICAgdG90YWw6IDAsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBqZXN0LnNweU9uKHJlY29tbWVuZGF0aW9uU2VydmljZSwgJ2dldFJlY29tbWVuZGF0aW9ucycpLm1vY2tSZXNvbHZlZFZhbHVlKHNlcnZpY2VSZXN1bHQpO1xyXG5cclxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XHJcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmdldFJlY29tbWVuZGF0aW9uKG1vY2tVc2VyLCByZWNvbW1lbmRhdGlvbklkKSkucmVqZWN0cy50b1Rocm93KEh0dHBFeGNlcHRpb24pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=