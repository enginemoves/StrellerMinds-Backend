9427634214f78f572d1fd657362c165d
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const config_1 = require("@nestjs/config");
const logger_service_1 = require("./logger.service");
describe('LoggerService', () => {
    let service;
    let configService;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                logger_service_1.LoggerService,
                {
                    provide: config_1.ConfigService,
                    useValue: {
                        get: jest.fn((key, defaultValue) => {
                            const config = {
                                LOG_LEVEL: 'info',
                                LOG_FORMAT: 'json',
                                LOG_FILE_ENABLED: true,
                                LOG_CONSOLE_ENABLED: true,
                                NODE_ENV: 'test',
                                APP_NAME: 'test-app',
                                APP_VERSION: '1.0.0',
                            };
                            return config[key] || defaultValue;
                        }),
                    },
                },
            ],
        }).compile();
        service = module.get(logger_service_1.LoggerService);
        configService = module.get(config_1.ConfigService);
    });
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    it('should set context', () => {
        service.setContext('TestContext');
        expect(service['context']).toBe('TestContext');
    });
    it('should log debug message', () => {
        const logSpy = jest.spyOn(service['logger'], 'log');
        service.debug('Test debug message', { correlationId: 'test-123' });
        expect(logSpy).toHaveBeenCalledWith('debug', 'Test debug message', expect.objectContaining({
            correlationId: 'test-123',
            context: 'Application',
            environment: 'test',
            service: 'test-app',
        }));
    });
    it('should log error with context', () => {
        const logSpy = jest.spyOn(service['logger'], 'log');
        const error = new Error('Test error');
        service.logError(error, {
            correlationId: 'test-123',
            userId: 'user-456',
        });
        expect(logSpy).toHaveBeenCalledWith('error', 'Test error', expect.objectContaining({
            correlationId: 'test-123',
            userId: 'user-456',
            type: 'error',
            errorType: 'Error',
            stack: expect.any(String),
        }));
    });
    it('should create child logger with additional context', () => {
        const childLogger = service.child({ userId: 'user-123' });
        expect(childLogger).toBeInstanceOf(logger_service_1.LoggerService);
    });
    it('should sanitize database queries', () => {
        const query = "SELECT * FROM users WHERE password='secret123' AND token='abc123'";
        const sanitized = service['sanitizeQuery'](query);
        expect(sanitized).toContain("password='***'");
        expect(sanitized).toContain("token='***'");
        expect(sanitized).not.toContain('secret123');
        expect(sanitized).not.toContain('abc123');
    });
    it('should log performance with appropriate level', () => {
        const logSpy = jest.spyOn(service['logger'], 'log');
        // Fast request
        service.logPerformance('Fast request', {
            correlationId: 'test-123',
            duration: 100,
        });
        expect(logSpy).toHaveBeenCalledWith('info', 'Fast request', expect.objectContaining({
            duration: 100,
            type: 'performance',
        }));
        // Slow request
        service.logPerformance('Slow request', {
            correlationId: 'test-456',
            duration: 6000,
        });
        expect(logSpy).toHaveBeenCalledWith('warn', 'Slow request', expect.objectContaining({
            duration: 6000,
            type: 'performance',
        }));
    });
    it('should log business events', () => {
        const logSpy = jest.spyOn(service['logger'], 'log');
        service.logBusinessEvent('User registered', {
            correlationId: 'test-123',
            userId: 'user-456',
        });
        expect(logSpy).toHaveBeenCalledWith('info', 'User registered', expect.objectContaining({
            type: 'business_event',
            correlationId: 'test-123',
            userId: 'user-456',
        }));
    });
    it('should log security events with high severity', () => {
        const logSpy = jest.spyOn(service['logger'], 'log');
        service.logSecurityEvent('Failed login attempt', {
            correlationId: 'test-123',
            ip: '192.168.1.1',
        });
        expect(logSpy).toHaveBeenCalledWith('warn', 'Failed login attempt', expect.objectContaining({
            type: 'security_event',
            severity: 'high',
            correlationId: 'test-123',
            ip: '192.168.1.1',
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxjb21tb25cXGxvZ2dpbmdcXGxvZ2dlci5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFDdEQsMkNBQStDO0FBQy9DLHFEQUFpRDtBQUVqRCxRQUFRLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtJQUM3QixJQUFJLE9BQXNCLENBQUM7SUFDM0IsSUFBSSxhQUE0QixDQUFDO0lBRWpDLFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixNQUFNLE1BQU0sR0FBa0IsTUFBTSxjQUFJLENBQUMsbUJBQW1CLENBQUM7WUFDM0QsU0FBUyxFQUFFO2dCQUNULDhCQUFhO2dCQUNiO29CQUNFLE9BQU8sRUFBRSxzQkFBYTtvQkFDdEIsUUFBUSxFQUFFO3dCQUNSLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBVyxFQUFFLFlBQWtCLEVBQUUsRUFBRTs0QkFDL0MsTUFBTSxNQUFNLEdBQUc7Z0NBQ2IsU0FBUyxFQUFFLE1BQU07Z0NBQ2pCLFVBQVUsRUFBRSxNQUFNO2dDQUNsQixnQkFBZ0IsRUFBRSxJQUFJO2dDQUN0QixtQkFBbUIsRUFBRSxJQUFJO2dDQUN6QixRQUFRLEVBQUUsTUFBTTtnQ0FDaEIsUUFBUSxFQUFFLFVBQVU7Z0NBQ3BCLFdBQVcsRUFBRSxPQUFPOzZCQUNyQixDQUFDOzRCQUNGLE9BQU8sTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLFlBQVksQ0FBQzt3QkFDckMsQ0FBQyxDQUFDO3FCQUNIO2lCQUNGO2FBQ0Y7U0FDRixDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFYixPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBZ0IsOEJBQWEsQ0FBQyxDQUFDO1FBQ25ELGFBQWEsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFnQixzQkFBYSxDQUFDLENBQUM7SUFDM0QsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENB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QUMsZ0JBQWdCLENBQUM7WUFDdEIsSUFBSSxFQUFFLGdCQUFnQjtZQUN0QixhQUFhLEVBQUUsVUFBVTtZQUN6QixNQUFNLEVBQUUsVUFBVTtTQUNuQixDQUFDLENBQ0gsQ0FBQztJQUNKLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLCtDQUErQyxFQUFFLEdBQUcsRUFBRTtRQUN2RCxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUVwRCxPQUFPLENBQUMsZ0JBQWdCLENBQUMsc0JBQXNCLEVBQUU7WUFDL0MsYUFBYSxFQUFFLFVBQVU7WUFDekIsRUFBRSxFQUFFLGFBQWE7U0FDbEIsQ0FBQyxDQUFDO1FBRUgsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUNqQyxNQUFNLEVBQ04sc0JBQXNCLEVBQ3RCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztZQUN0QixJQUFJLEVBQUUsZ0JBQWdCO1lBQ3RCLFFBQVEsRUFBRSxNQUFNO1lBQ2hCLGFBQWEsRUFBRSxVQUFVO1lBQ3pCLEVBQUUsRUFBRSxhQUFhO1NBQ2xCLENBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXG9qb3NlcGhcXERvY3VtZW50c1xcU3RyZWxsZXJNaW5kcy1CYWNrZW5kXFxzcmNcXGNvbW1vblxcbG9nZ2luZ1xcbG9nZ2VyLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcclxuaW1wb3J0IHsgQ29uZmlnU2VydmljZSB9IGZyb20gJ0BuZXN0anMvY29uZmlnJztcclxuaW1wb3J0IHsgTG9nZ2VyU2VydmljZSB9IGZyb20gJy4vbG9nZ2VyLnNlcnZpY2UnO1xyXG5cclxuZGVzY3JpYmUoJ0xvZ2dlclNlcnZpY2UnLCAoKSA9PiB7XHJcbiAgbGV0IHNlcnZpY2U6IExvZ2dlclNlcnZpY2U7XHJcbiAgbGV0IGNvbmZpZ1NlcnZpY2U6IENvbmZpZ1NlcnZpY2U7XHJcblxyXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcclxuICAgICAgcHJvdmlkZXJzOiBbXHJcbiAgICAgICAgTG9nZ2VyU2VydmljZSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBwcm92aWRlOiBDb25maWdTZXJ2aWNlLFxyXG4gICAgICAgICAgdXNlVmFsdWU6IHtcclxuICAgICAgICAgICAgZ2V0OiBqZXN0LmZuKChrZXk6IHN0cmluZywgZGVmYXVsdFZhbHVlPzogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgY29uZmlnID0ge1xyXG4gICAgICAgICAgICAgICAgTE9HX0xFVkVMOiAnaW5mbycsXHJcbiAgICAgICAgICAgICAgICBMT0dfRk9STUFUOiAnanNvbicsXHJcbiAgICAgICAgICAgICAgICBMT0dfRklMRV9FTkFCTEVEOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgTE9HX0NPTlNPTEVfRU5BQkxFRDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIE5PREVfRU5WOiAndGVzdCcsXHJcbiAgICAgICAgICAgICAgICBBUFBfTkFNRTogJ3Rlc3QtYXBwJyxcclxuICAgICAgICAgICAgICAgIEFQUF9WRVJTSU9OOiAnMS4wLjAnLFxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZ1trZXldIHx8IGRlZmF1bHRWYWx1ZTtcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF0sXHJcbiAgICB9KS5jb21waWxlKCk7XHJcblxyXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8TG9nZ2VyU2VydmljZT4oTG9nZ2VyU2VydmljZSk7XHJcbiAgICBjb25maWdTZXJ2aWNlID0gbW9kdWxlLmdldDxDb25maWdTZXJ2aWNlPihDb25maWdTZXJ2aWNlKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3Nob3VsZCBiZSBkZWZpbmVkJywgKCkgPT4ge1xyXG4gICAgZXhwZWN0KHNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzaG91bGQgc2V0IGNvbnRleHQnLCAoKSA9PiB7XHJcbiAgICBzZXJ2aWNlLnNldENvbnRleHQoJ1Rlc3RDb250ZXh0Jyk7XHJcbiAgICBleHBlY3Qoc2VydmljZVsnY29udGV4dCddKS50b0JlKCdUZXN0Q29udGV4dCcpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIGxvZyBkZWJ1ZyBtZXNzYWdlJywgKCkgPT4ge1xyXG4gICAgY29uc3QgbG9nU3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlWydsb2dnZXInXSwgJ2xvZycpO1xyXG4gICAgc2VydmljZS5kZWJ1ZygnVGVzdCBkZWJ1ZyBtZXNzYWdlJywgeyBjb3JyZWxhdGlvbklkOiAndGVzdC0xMjMnIH0pO1xyXG4gICAgXHJcbiAgICBleHBlY3QobG9nU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgJ2RlYnVnJyxcclxuICAgICAgJ1Rlc3QgZGVidWcgbWVzc2FnZScsXHJcbiAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICBjb3JyZWxhdGlvbklkOiAndGVzdC0xMjMnLFxyXG4gICAgICAgIGNvbnRleHQ6ICdBcHBsaWNhdGlvbicsXHJcbiAgICAgICAgZW52aXJvbm1lbnQ6ICd0ZXN0JyxcclxuICAgICAgICBzZXJ2aWNlOiAndGVzdC1hcHAnLFxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3Nob3VsZCBsb2cgZXJyb3Igd2l0aCBjb250ZXh0JywgKCkgPT4ge1xyXG4gICAgY29uc3QgbG9nU3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlWydsb2dnZXInXSwgJ2xvZycpO1xyXG4gICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ1Rlc3QgZXJyb3InKTtcclxuICAgIFxyXG4gICAgc2VydmljZS5sb2dFcnJvcihlcnJvciwge1xyXG4gICAgICBjb3JyZWxhdGlvbklkOiAndGVzdC0xMjMnLFxyXG4gICAgICB1c2VySWQ6ICd1c2VyLTQ1NicsXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgZXhwZWN0KGxvZ1NweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICdlcnJvcicsXHJcbiAgICAgICdUZXN0IGVycm9yJyxcclxuICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgIGNvcnJlbGF0aW9uSWQ6ICd0ZXN0LTEyMycsXHJcbiAgICAgICAgdXNlcklkOiAndXNlci00NTYnLFxyXG4gICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgZXJyb3JUeXBlOiAnRXJyb3InLFxyXG4gICAgICAgIHN0YWNrOiBleHBlY3QuYW55KFN0cmluZyksXHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIGNyZWF0ZSBjaGlsZCBsb2dnZXIgd2l0aCBhZGRpdGlvbmFsIGNvbnRleHQnLCAoKSA9PiB7XHJcbiAgICBjb25zdCBjaGlsZExvZ2dlciA9IHNlcnZpY2UuY2hpbGQoeyB1c2VySWQ6ICd1c2VyLTEyMycgfSk7XHJcbiAgICBleHBlY3QoY2hpbGRMb2dnZXIpLnRvQmVJbnN0YW5jZU9mKExvZ2dlclNlcnZpY2UpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIHNhbml0aXplIGRhdGFiYXNlIHF1ZXJpZXMnLCAoKSA9PiB7XHJcbiAgICBjb25zdCBxdWVyeSA9IFwiU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSBwYXNzd29yZD0nc2VjcmV0MTIzJyBBTkQgdG9rZW49J2FiYzEyMydcIjtcclxuICAgIGNvbnN0IHNhbml0aXplZCA9IHNlcnZpY2VbJ3Nhbml0aXplUXVlcnknXShxdWVyeSk7XHJcbiAgICBcclxuICAgIGV4cGVjdChzYW5pdGl6ZWQpLnRvQ29udGFpbihcInBhc3N3b3JkPScqKionXCIpO1xyXG4gICAgZXhwZWN0KHNhbml0aXplZCkudG9Db250YWluKFwidG9rZW49JyoqKidcIik7XHJcbiAgICBleHBlY3Qoc2FuaXRpemVkKS5ub3QudG9Db250YWluKCdzZWNyZXQxMjMnKTtcclxuICAgIGV4cGVjdChzYW5pdGl6ZWQpLm5vdC50b0NvbnRhaW4oJ2FiYzEyMycpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIGxvZyBwZXJmb3JtYW5jZSB3aXRoIGFwcHJvcHJpYXRlIGxldmVsJywgKCkgPT4ge1xyXG4gICAgY29uc3QgbG9nU3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlWydsb2dnZXInXSwgJ2xvZycpO1xyXG4gICAgXHJcbiAgICAvLyBGYXN0IHJlcXVlc3RcclxuICAgIHNlcnZpY2UubG9nUGVyZm9ybWFuY2UoJ0Zhc3QgcmVxdWVzdCcsIHtcclxuICAgICAgY29ycmVsYXRpb25JZDogJ3Rlc3QtMTIzJyxcclxuICAgICAgZHVyYXRpb246IDEwMCxcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBleHBlY3QobG9nU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgJ2luZm8nLFxyXG4gICAgICAnRmFzdCByZXF1ZXN0JyxcclxuICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgIGR1cmF0aW9uOiAxMDAsXHJcbiAgICAgICAgdHlwZTogJ3BlcmZvcm1hbmNlJyxcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgLy8gU2xvdyByZXF1ZXN0XHJcbiAgICBzZXJ2aWNlLmxvZ1BlcmZvcm1hbmNlKCdTbG93IHJlcXVlc3QnLCB7XHJcbiAgICAgIGNvcnJlbGF0aW9uSWQ6ICd0ZXN0LTQ1NicsXHJcbiAgICAgIGR1cmF0aW9uOiA2MDAwLFxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGV4cGVjdChsb2dTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAnd2FybicsXHJcbiAgICAgICdTbG93IHJlcXVlc3QnLFxyXG4gICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgZHVyYXRpb246IDYwMDAsXHJcbiAgICAgICAgdHlwZTogJ3BlcmZvcm1hbmNlJyxcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzaG91bGQgbG9nIGJ1c2luZXNzIGV2ZW50cycsICgpID0+IHtcclxuICAgIGNvbnN0IGxvZ1NweSA9IGplc3Quc3B5T24oc2VydmljZVsnbG9nZ2VyJ10sICdsb2cnKTtcclxuICAgIFxyXG4gICAgc2VydmljZS5sb2dCdXNpbmVzc0V2ZW50KCdVc2VyIHJlZ2lzdGVyZWQnLCB7XHJcbiAgICAgIGNvcnJlbGF0aW9uSWQ6ICd0ZXN0LTEyMycsXHJcbiAgICAgIHVzZXJJZDogJ3VzZXItNDU2JyxcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBleHBlY3QobG9nU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgJ2luZm8nLFxyXG4gICAgICAnVXNlciByZWdpc3RlcmVkJyxcclxuICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgIHR5cGU6ICdidXNpbmVzc19ldmVudCcsXHJcbiAgICAgICAgY29ycmVsYXRpb25JZDogJ3Rlc3QtMTIzJyxcclxuICAgICAgICB1c2VySWQ6ICd1c2VyLTQ1NicsXHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIGxvZyBzZWN1cml0eSBldmVudHMgd2l0aCBoaWdoIHNldmVyaXR5JywgKCkgPT4ge1xyXG4gICAgY29uc3QgbG9nU3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlWydsb2dnZXInXSwgJ2xvZycpO1xyXG4gICAgXHJcbiAgICBzZXJ2aWNlLmxvZ1NlY3VyaXR5RXZlbnQoJ0ZhaWxlZCBsb2dpbiBhdHRlbXB0Jywge1xyXG4gICAgICBjb3JyZWxhdGlvbklkOiAndGVzdC0xMjMnLFxyXG4gICAgICBpcDogJzE5Mi4xNjguMS4xJyxcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBleHBlY3QobG9nU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgJ3dhcm4nLFxyXG4gICAgICAnRmFpbGVkIGxvZ2luIGF0dGVtcHQnLFxyXG4gICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgdHlwZTogJ3NlY3VyaXR5X2V2ZW50JyxcclxuICAgICAgICBzZXZlcml0eTogJ2hpZ2gnLFxyXG4gICAgICAgIGNvcnJlbGF0aW9uSWQ6ICd0ZXN0LTEyMycsXHJcbiAgICAgICAgaXA6ICcxOTIuMTY4LjEuMScsXHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9