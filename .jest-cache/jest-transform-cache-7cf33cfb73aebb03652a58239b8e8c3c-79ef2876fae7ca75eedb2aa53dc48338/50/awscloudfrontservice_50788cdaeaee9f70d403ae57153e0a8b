498e08f7b897aca52ded1eb98c5cf967
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var AwsCloudFrontService_1;
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AwsCloudFrontService = void 0;
const common_1 = require("@nestjs/common");
const config_1 = require("@nestjs/config");
const client_s3_1 = require("@aws-sdk/client-s3");
const client_cloudfront_1 = require("@aws-sdk/client-cloudfront");
const s3_request_presigner_1 = require("@aws-sdk/s3-request-presigner");
const crypto = __importStar(require("crypto"));
let AwsCloudFrontService = AwsCloudFrontService_1 = class AwsCloudFrontService {
    constructor(configService) {
        this.configService = configService;
        this.logger = new common_1.Logger(AwsCloudFrontService_1.name);
        this.config = {
            distributionId: this.configService.get('AWS_CLOUDFRONT_DISTRIBUTION_ID'),
            distributionDomain: this.configService.get('AWS_CLOUDFRONT_DOMAIN'),
            s3Bucket: this.configService.get('AWS_S3_BUCKET'),
            s3Region: this.configService.get('AWS_S3_REGION', 'us-east-1'),
            accessKeyId: this.configService.get('AWS_ACCESS_KEY_ID'),
            secretAccessKey: this.configService.get('AWS_SECRET_ACCESS_KEY'),
            signedUrlExpiry: this.configService.get('AWS_SIGNED_URL_EXPIRY', 3600),
            privateKeyId: this.configService.get('AWS_CLOUDFRONT_PRIVATE_KEY_ID'),
            privateKey: this.configService.get('AWS_CLOUDFRONT_PRIVATE_KEY'),
        };
        this.s3Client = new client_s3_1.S3Client({
            region: this.config.s3Region,
            credentials: {
                accessKeyId: this.config.accessKeyId,
                secretAccessKey: this.config.secretAccessKey,
            },
        });
        this.cloudFrontClient = new client_cloudfront_1.CloudFrontClient({
            region: this.config.s3Region,
            credentials: {
                accessKeyId: this.config.accessKeyId,
                secretAccessKey: this.config.secretAccessKey,
            },
        });
    }
    async uploadVideo(buffer, key, contentType = 'video/mp4', metadata) {
        try {
            this.logger.debug(`Uploading video to S3: ${key}`);
            const command = new client_s3_1.PutObjectCommand({
                Bucket: this.config.s3Bucket,
                Key: key,
                Body: buffer,
                ContentType: contentType,
                Metadata: metadata,
                ServerSideEncryption: 'AES256',
                CacheControl: 'max-age=31536000', // 1 year
            });
            const result = await this.s3Client.send(command);
            const s3Url = `https://${this.config.s3Bucket}.s3.${this.config.s3Region}.amazonaws.com/${key}`;
            const cdnUrl = `https://${this.config.distributionDomain}/${key}`;
            this.logger.debug(`Video uploaded successfully: ${key}`);
            return {
                key,
                url: s3Url,
                cdnUrl,
                etag: result.ETag?.replace(/"/g, '') || '',
                size: buffer.length,
            };
        }
        catch (error) {
            this.logger.error(`Failed to upload video: ${key}`, error.stack);
            throw error;
        }
    }
    async uploadVideoStream(stream, key, contentType = 'video/mp4', contentLength, metadata) {
        try {
            this.logger.debug(`Uploading video stream to S3: ${key}`);
            const command = new client_s3_1.PutObjectCommand({
                Bucket: this.config.s3Bucket,
                Key: key,
                Body: stream,
                ContentType: contentType,
                ContentLength: contentLength,
                Metadata: metadata,
                ServerSideEncryption: 'AES256',
                CacheControl: 'max-age=31536000',
            });
            const result = await this.s3Client.send(command);
            const s3Url = `https://${this.config.s3Bucket}.s3.${this.config.s3Region}.amazonaws.com/${key}`;
            const cdnUrl = `https://${this.config.distributionDomain}/${key}`;
            this.logger.debug(`Video stream uploaded successfully: ${key}`);
            return {
                key,
                url: s3Url,
                cdnUrl,
                etag: result.ETag?.replace(/"/g, '') || '',
                size: contentLength || 0,
            };
        }
        catch (error) {
            this.logger.error(`Failed to upload video stream: ${key}`, error.stack);
            throw error;
        }
    }
    async deleteVideo(key) {
        try {
            this.logger.debug(`Deleting video from S3: ${key}`);
            const command = new client_s3_1.DeleteObjectCommand({
                Bucket: this.config.s3Bucket,
                Key: key,
            });
            await this.s3Client.send(command);
            // Invalidate CloudFront cache
            await this.invalidateCache([key]);
            this.logger.debug(`Video deleted successfully: ${key}`);
        }
        catch (error) {
            this.logger.error(`Failed to delete video: ${key}`, error.stack);
            throw error;
        }
    }
    async getVideoMetadata(key) {
        try {
            const command = new client_s3_1.HeadObjectCommand({
                Bucket: this.config.s3Bucket,
                Key: key,
            });
            const result = await this.s3Client.send(command);
            return {
                contentLength: result.ContentLength || 0,
                contentType: result.ContentType || '',
                lastModified: result.LastModified || new Date(),
                etag: result.ETag?.replace(/"/g, '') || '',
                metadata: result.Metadata || {},
            };
        }
        catch (error) {
            this.logger.error(`Failed to get video metadata: ${key}`, error.stack);
            throw error;
        }
    }
    async generateSignedUrl(key, options = {}) {
        try {
            const expiresIn = options.expiresIn || this.config.signedUrlExpiry;
            if (this.config.privateKey && this.config.privateKeyId) {
                // Use CloudFront signed URLs for better security
                return this.generateCloudFrontSignedUrl(key, expiresIn, options);
            }
            else {
                // Fallback to S3 signed URLs
                return this.generateS3SignedUrl(key, expiresIn);
            }
        }
        catch (error) {
            this.logger.error(`Failed to generate signed URL: ${key}`, error.stack);
            throw error;
        }
    }
    async generateS3SignedUrl(key, expiresIn) {
        const command = new client_s3_1.GetObjectCommand({
            Bucket: this.config.s3Bucket,
            Key: key,
        });
        return (0, s3_request_presigner_1.getSignedUrl)(this.s3Client, command, { expiresIn });
    }
    generateCloudFrontSignedUrl(key, expiresIn, options) {
        const url = `https://${this.config.distributionDomain}/${key}`;
        const expiration = Math.floor(Date.now() / 1000) + expiresIn;
        // Create policy
        const policy = options.policy || {
            Statement: [
                {
                    Resource: url,
                    Condition: {
                        DateLessThan: {
                            'AWS:EpochTime': expiration,
                        },
                        ...(options.ipAddress && {
                            IpAddress: {
                                'AWS:SourceIp': options.ipAddress,
                            },
                        }),
                    },
                },
            ],
        };
        const policyString = JSON.stringify(policy);
        const policyBase64 = Buffer.from(policyString).toString('base64');
        // Create signature
        const signature = crypto
            .createSign('RSA-SHA1')
            .update(policyString)
            .sign(this.config.privateKey, 'base64');
        // URL-safe base64 encoding
        const urlSafePolicy = policyBase64.replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
        const urlSafeSignature = signature.replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
        return `${url}?Policy=${urlSafePolicy}&Signature=${urlSafeSignature}&Key-Pair-Id=${this.config.privateKeyId}`;
    }
    async invalidateCache(paths) {
        try {
            if (!this.config.distributionId) {
                this.logger.warn('CloudFront distribution ID not configured, skipping cache invalidation');
                return;
            }
            this.logger.debug(`Invalidating CloudFront cache for paths: ${paths.join(', ')}`);
            const command = new client_cloudfront_1.CreateInvalidationCommand({
                DistributionId: this.config.distributionId,
                InvalidationBatch: {
                    Paths: {
                        Quantity: paths.length,
                        Items: paths.map(path => `/${path}`),
                    },
                    CallerReference: `invalidation-${Date.now()}`,
                },
            });
            const result = await this.cloudFrontClient.send(command);
            this.logger.debug(`Cache invalidation created: ${result.Invalidation?.Id}`);
        }
        catch (error) {
            this.logger.error('Failed to invalidate CloudFront cache', error.stack);
            throw error;
        }
    }
    async getDistributionInfo() {
        try {
            if (!this.config.distributionId) {
                throw new Error('CloudFront distribution ID not configured');
            }
            const command = new client_cloudfront_1.GetDistributionCommand({
                Id: this.config.distributionId,
            });
            const result = await this.cloudFrontClient.send(command);
            return result.Distribution;
        }
        catch (error) {
            this.logger.error('Failed to get distribution info', error.stack);
            throw error;
        }
    }
    generateVideoKey(videoId, quality, format = 'mp4') {
        const timestamp = Date.now();
        const qualityPrefix = quality ? `${quality}/` : '';
        return `videos/${videoId}/${qualityPrefix}${timestamp}.${format}`;
    }
    generateThumbnailKey(videoId, index = 0) {
        return `videos/${videoId}/thumbnails/thumb_${index.toString().padStart(3, '0')}.jpg`;
    }
    generateManifestKey(videoId, type) {
        const extension = type === 'hls' ? 'm3u8' : 'mpd';
        return `videos/${videoId}/manifests/playlist.${extension}`;
    }
    isConfigured() {
        return !!(this.config.distributionDomain &&
            this.config.s3Bucket &&
            this.config.accessKeyId &&
            this.config.secretAccessKey);
    }
};
exports.AwsCloudFrontService = AwsCloudFrontService;
exports.AwsCloudFrontService = AwsCloudFrontService = AwsCloudFrontService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigService !== "undefined" && config_1.ConfigService) === "function" ? _a : Object])
], AwsCloudFrontService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFx2aWRlby1zdHJlYW1pbmdcXHNlcnZpY2VzXFxhd3MtY2xvdWRmcm9udC5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQW9EO0FBQ3BELDJDQUErQztBQUMvQyxrREFNNEI7QUFDNUIsa0VBSW9DO0FBQ3BDLHdFQUE2RDtBQUM3RCwrQ0FBaUM7QUE4QjFCLElBQU0sb0JBQW9CLDRCQUExQixNQUFNLG9CQUFvQjtJQU0vQixZQUE2QixhQUE0QjtRQUE1QixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUx4QyxXQUFNLEdBQUcsSUFBSSxlQUFNLENBQUMsc0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUM7UUFNOUQsSUFBSSxDQUFDLE1BQU0sR0FBRztZQUNaLGNBQWMsRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBUyxnQ0FBZ0MsQ0FBQztZQUNoRixrQkFBa0IsRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBUyx1QkFBdUIsQ0FBQztZQUMzRSxRQUFRLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQVMsZUFBZSxDQUFDO1lBQ3pELFFBQVEsRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBUyxlQUFlLEVBQUUsV0FBVyxDQUFDO1lBQ3RFLFdBQVcsRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBUyxtQkFBbUIsQ0FBQztZQUNoRSxlQUFlLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQVMsdUJBQXVCLENBQUM7WUFDeEUsZUFBZSxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFTLHVCQUF1QixFQUFFLElBQUksQ0FBQztZQUM5RSxZQUFZLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQVMsK0JBQStC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LFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDN0IsTUFBTSxhQUFhLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLE9BQU8sR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDbkQsT0FBTyxVQUFVLE9BQU8sSUFBSSxhQUFhLEdBQUcsU0FBUyxJQUFJLE1BQU0sRUFBRSxDQUFDO0lBQ3BFLENBQUM7SUFFRCxvQkFBb0IsQ0FBQyxPQUFlLEVBQUUsUUFBZ0IsQ0FBQztRQUNyRCxPQUFPLFVBQVUsT0FBTyxxQkFBcUIsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQztJQUN2RixDQUFDO0lBRUQsbUJBQW1CLENBQUMsT0FBZSxFQUFFLElBQW9CO1FBQ3ZELE1BQU0sU0FBUyxHQUFHLElBQUksS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1FBQ2xELE9BQU8sVUFBVSxPQUFPLHVCQUF1QixTQUFTLEVBQUUsQ0FBQztJQUM3RCxDQUFDO0lBRUQsWUFBWTtRQUNWLE9BQU8sQ0FBQyxDQUFDLENBQ1AsSUFBSSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0I7WUFDOUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRO1lBQ3BCLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVztZQUN2QixJQUFJLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FDNUIsQ0FBQztJQUNKLENBQUM7Q0FDRixDQUFBO0FBclRZLG9EQUFvQjsrQkFBcEIsb0JBQW9CO0lBRGhDLElBQUEsbUJBQVUsR0FBRTt5REFPaUMsc0JBQWEsb0JBQWIsc0JBQWE7R0FOOUMsb0JBQW9CLENBcVRoQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXG9qb3NlcGhcXERvY3VtZW50c1xcU3RyZWxsZXJNaW5kcy1CYWNrZW5kXFxzcmNcXHZpZGVvLXN0cmVhbWluZ1xcc2VydmljZXNcXGF3cy1jbG91ZGZyb250LnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgTG9nZ2VyIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xyXG5pbXBvcnQgeyBDb25maWdTZXJ2aWNlIH0gZnJvbSAnQG5lc3Rqcy9jb25maWcnO1xyXG5pbXBvcnQge1xyXG4gIFMzQ2xpZW50LFxyXG4gIFB1dE9iamVjdENvbW1hbmQsXHJcbiAgR2V0T2JqZWN0Q29tbWFuZCxcclxuICBEZWxldGVPYmplY3RDb21tYW5kLFxyXG4gIEhlYWRPYmplY3RDb21tYW5kLFxyXG59IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1zMyc7XHJcbmltcG9ydCB7XHJcbiAgQ2xvdWRGcm9udENsaWVudCxcclxuICBDcmVhdGVJbnZhbGlkYXRpb25Db21tYW5kLFxyXG4gIEdldERpc3RyaWJ1dGlvbkNvbW1hbmQsXHJcbn0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWNsb3VkZnJvbnQnO1xyXG5pbXBvcnQgeyBnZXRTaWduZWRVcmwgfSBmcm9tICdAYXdzLXNkay9zMy1yZXF1ZXN0LXByZXNpZ25lcic7XHJcbmltcG9ydCAqIGFzIGNyeXB0byBmcm9tICdjcnlwdG8nO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBDbG91ZEZyb250Q29uZmlnIHtcclxuICBkaXN0cmlidXRpb25JZDogc3RyaW5nO1xyXG4gIGRpc3RyaWJ1dGlvbkRvbWFpbjogc3RyaW5nO1xyXG4gIHMzQnVja2V0OiBzdHJpbmc7XHJcbiAgczNSZWdpb246IHN0cmluZztcclxuICBhY2Nlc3NLZXlJZDogc3RyaW5nO1xyXG4gIHNlY3JldEFjY2Vzc0tleTogc3RyaW5nO1xyXG4gIHNpZ25lZFVybEV4cGlyeTogbnVtYmVyO1xyXG4gIHByaXZhdGVLZXlJZDogc3RyaW5nO1xyXG4gIHByaXZhdGVLZXk6IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBVcGxvYWRSZXN1bHQge1xyXG4gIGtleTogc3RyaW5nO1xyXG4gIHVybDogc3RyaW5nO1xyXG4gIGNkblVybDogc3RyaW5nO1xyXG4gIGV0YWc6IHN0cmluZztcclxuICBzaXplOiBudW1iZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgU2lnbmVkVXJsT3B0aW9ucyB7XHJcbiAgZXhwaXJlc0luPzogbnVtYmVyO1xyXG4gIGlwQWRkcmVzcz86IHN0cmluZztcclxuICB1c2VyQWdlbnQ/OiBzdHJpbmc7XHJcbiAgcG9saWN5PzogYW55O1xyXG59XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBBd3NDbG91ZEZyb250U2VydmljZSB7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKEF3c0Nsb3VkRnJvbnRTZXJ2aWNlLm5hbWUpO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgczNDbGllbnQ6IFMzQ2xpZW50O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgY2xvdWRGcm9udENsaWVudDogQ2xvdWRGcm9udENsaWVudDtcclxuICBwcml2YXRlIHJlYWRvbmx5IGNvbmZpZzogQ2xvdWRGcm9udENvbmZpZztcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBjb25maWdTZXJ2aWNlOiBDb25maWdTZXJ2aWNlKSB7XHJcbiAgICB0aGlzLmNvbmZpZyA9IHtcclxuICAgICAgZGlzdHJpYnV0aW9uSWQ6IHRoaXMuY29uZmlnU2VydmljZS5nZXQ8c3RyaW5nPignQVdTX0NMT1VERlJPTlRfRElTVFJJQlVUSU9OX0lEJyksXHJcbiAgICAgIGRpc3RyaWJ1dGlvbkRvbWFpbjogdGhpcy5jb25maWdTZXJ2aWNlLmdldDxzdHJpbmc+KCdBV1NfQ0xPVURGUk9OVF9ET01BSU4nKSxcclxuICAgICAgczNCdWNrZXQ6IHRoaXMuY29uZmlnU2VydmljZS5nZXQ8c3RyaW5nPignQVdTX1MzX0JVQ0tFVCcpLFxyXG4gICAgICBzM1JlZ2lvbjogdGhpcy5jb25maWdTZXJ2aWNlLmdldDxzdHJpbmc+KCdBV1NfUzNfUkVHSU9OJywgJ3VzLWVhc3QtMScpLFxyXG4gICAgICBhY2Nlc3NLZXlJZDogdGhpcy5jb25maWdTZXJ2aWNlLmdldDxzdHJpbmc+KCdBV1NfQUNDRVNTX0tFWV9JRCcpLFxyXG4gICAgICBzZWNyZXRBY2Nlc3NLZXk6IHRoaXMuY29uZmlnU2VydmljZS5nZXQ8c3RyaW5nPignQVdTX1NFQ1JFVF9BQ0NFU1NfS0VZJyksXHJcbiAgICAgIHNpZ25lZFVybEV4cGlyeTogdGhpcy5jb25maWdTZXJ2aWNlLmdldDxudW1iZXI+KCdBV1NfU0lHTkVEX1VSTF9FWFBJUlknLCAzNjAwKSxcclxuICAgICAgcHJpdmF0ZUtleUlkOiB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0PHN0cmluZz4oJ0FXU19DTE9VREZST05UX1BSSVZBVEVfS0VZX0lEJyksXHJcbiAgICAgIHByaXZhdGVLZXk6IHRoaXMuY29uZmlnU2VydmljZS5nZXQ8c3RyaW5nPignQVdTX0NMT1VERlJPTlRfUFJJVkFURV9LRVknKSxcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5zM0NsaWVudCA9IG5ldyBTM0NsaWVudCh7XHJcbiAgICAgIHJlZ2lvbjogdGhpcy5jb25maWcuczNSZWdpb24sXHJcbiAgICAgIGNyZWRlbnRpYWxzOiB7XHJcbiAgICAgICAgYWNjZXNzS2V5SWQ6IHRoaXMuY29uZmlnLmFjY2Vzc0tleUlkLFxyXG4gICAgICAgIHNlY3JldEFjY2Vzc0tleTogdGhpcy5jb25maWcuc2VjcmV0QWNjZXNzS2V5LFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5jbG91ZEZyb250Q2xpZW50ID0gbmV3IENsb3VkRnJvbnRDbGllbnQoe1xyXG4gICAgICByZWdpb246IHRoaXMuY29uZmlnLnMzUmVnaW9uLFxyXG4gICAgICBjcmVkZW50aWFsczoge1xyXG4gICAgICAgIGFjY2Vzc0tleUlkOiB0aGlzLmNvbmZpZy5hY2Nlc3NLZXlJZCxcclxuICAgICAgICBzZWNyZXRBY2Nlc3NLZXk6IHRoaXMuY29uZmlnLnNlY3JldEFjY2Vzc0tleSxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgdXBsb2FkVmlkZW8oXHJcbiAgICBidWZmZXI6IEJ1ZmZlcixcclxuICAgIGtleTogc3RyaW5nLFxyXG4gICAgY29udGVudFR5cGU6IHN0cmluZyA9ICd2aWRlby9tcDQnLFxyXG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+LFxyXG4gICk6IFByb21pc2U8VXBsb2FkUmVzdWx0PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgVXBsb2FkaW5nIHZpZGVvIHRvIFMzOiAke2tleX1gKTtcclxuXHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgUHV0T2JqZWN0Q29tbWFuZCh7XHJcbiAgICAgICAgQnVja2V0OiB0aGlzLmNvbmZpZy5zM0J1Y2tldCxcclxuICAgICAgICBLZXk6IGtleSxcclxuICAgICAgICBCb2R5OiBidWZmZXIsXHJcbiAgICAgICAgQ29udGVudFR5cGU6IGNvbnRlbnRUeXBlLFxyXG4gICAgICAgIE1ldGFkYXRhOiBtZXRhZGF0YSxcclxuICAgICAgICBTZXJ2ZXJTaWRlRW5jcnlwdGlvbjogJ0FFUzI1NicsXHJcbiAgICAgICAgQ2FjaGVDb250cm9sOiAnbWF4LWFnZT0zMTUzNjAwMCcsIC8vIDEgeWVhclxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuczNDbGllbnQuc2VuZChjb21tYW5kKTtcclxuICAgICAgY29uc3QgczNVcmwgPSBgaHR0cHM6Ly8ke3RoaXMuY29uZmlnLnMzQnVja2V0fS5zMy4ke3RoaXMuY29uZmlnLnMzUmVnaW9ufS5hbWF6b25hd3MuY29tLyR7a2V5fWA7XHJcbiAgICAgIGNvbnN0IGNkblVybCA9IGBodHRwczovLyR7dGhpcy5jb25maWcuZGlzdHJpYnV0aW9uRG9tYWlufS8ke2tleX1gO1xyXG5cclxuICAgICAgdGhpcy5sb2dnZXIuZGVidWcoYFZpZGVvIHVwbG9hZGVkIHN1Y2Nlc3NmdWxseTogJHtrZXl9YCk7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGtleSxcclxuICAgICAgICB1cmw6IHMzVXJsLFxyXG4gICAgICAgIGNkblVybCxcclxuICAgICAgICBldGFnOiByZXN1bHQuRVRhZz8ucmVwbGFjZSgvXCIvZywgJycpIHx8ICcnLFxyXG4gICAgICAgIHNpemU6IGJ1ZmZlci5sZW5ndGgsXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRmFpbGVkIHRvIHVwbG9hZCB2aWRlbzogJHtrZXl9YCwgZXJyb3Iuc3RhY2spO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIHVwbG9hZFZpZGVvU3RyZWFtKFxyXG4gICAgc3RyZWFtOiBOb2RlSlMuUmVhZGFibGVTdHJlYW0sXHJcbiAgICBrZXk6IHN0cmluZyxcclxuICAgIGNvbnRlbnRUeXBlOiBzdHJpbmcgPSAndmlkZW8vbXA0JyxcclxuICAgIGNvbnRlbnRMZW5ndGg/OiBudW1iZXIsXHJcbiAgICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIHN0cmluZz4sXHJcbiAgKTogUHJvbWlzZTxVcGxvYWRSZXN1bHQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBVcGxvYWRpbmcgdmlkZW8gc3RyZWFtIHRvIFMzOiAke2tleX1gKTtcclxuXHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgUHV0T2JqZWN0Q29tbWFuZCh7XHJcbiAgICAgICAgQnVja2V0OiB0aGlzLmNvbmZpZy5zM0J1Y2tldCxcclxuICAgICAgICBLZXk6IGtleSxcclxuICAgICAgICBCb2R5OiBzdHJlYW0sXHJcbiAgICAgICAgQ29udGVudFR5cGU6IGNvbnRlbnRUeXBlLFxyXG4gICAgICAgIENvbnRlbnRMZW5ndGg6IGNvbnRlbnRMZW5ndGgsXHJcbiAgICAgICAgTWV0YWRhdGE6IG1ldGFkYXRhLFxyXG4gICAgICAgIFNlcnZlclNpZGVFbmNyeXB0aW9uOiAnQUVTMjU2JyxcclxuICAgICAgICBDYWNoZUNvbnRyb2w6ICdtYXgtYWdlPTMxNTM2MDAwJyxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnMzQ2xpZW50LnNlbmQoY29tbWFuZCk7XHJcbiAgICAgIGNvbnN0IHMzVXJsID0gYGh0dHBzOi8vJHt0aGlzLmNvbmZpZy5zM0J1Y2tldH0uczMuJHt0aGlzLmNvbmZpZy5zM1JlZ2lvbn0uYW1hem9uYXdzLmNvbS8ke2tleX1gO1xyXG4gICAgICBjb25zdCBjZG5VcmwgPSBgaHR0cHM6Ly8ke3RoaXMuY29uZmlnLmRpc3RyaWJ1dGlvbkRvbWFpbn0vJHtrZXl9YDtcclxuXHJcbiAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBWaWRlbyBzdHJlYW0gdXBsb2FkZWQgc3VjY2Vzc2Z1bGx5OiAke2tleX1gKTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAga2V5LFxyXG4gICAgICAgIHVybDogczNVcmwsXHJcbiAgICAgICAgY2RuVXJsLFxyXG4gICAgICAgIGV0YWc6IHJlc3VsdC5FVGFnPy5yZXBsYWNlKC9cIi9nLCAnJykgfHwgJycsXHJcbiAgICAgICAgc2l6ZTogY29udGVudExlbmd0aCB8fCAwLFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEZhaWxlZCB0byB1cGxvYWQgdmlkZW8gc3RyZWFtOiAke2tleX1gLCBlcnJvci5zdGFjayk7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZGVsZXRlVmlkZW8oa2V5OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBEZWxldGluZyB2aWRlbyBmcm9tIFMzOiAke2tleX1gKTtcclxuXHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgRGVsZXRlT2JqZWN0Q29tbWFuZCh7XHJcbiAgICAgICAgQnVja2V0OiB0aGlzLmNvbmZpZy5zM0J1Y2tldCxcclxuICAgICAgICBLZXk6IGtleSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBhd2FpdCB0aGlzLnMzQ2xpZW50LnNlbmQoY29tbWFuZCk7XHJcblxyXG4gICAgICAvLyBJbnZhbGlkYXRlIENsb3VkRnJvbnQgY2FjaGVcclxuICAgICAgYXdhaXQgdGhpcy5pbnZhbGlkYXRlQ2FjaGUoW2tleV0pO1xyXG5cclxuICAgICAgdGhpcy5sb2dnZXIuZGVidWcoYFZpZGVvIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5OiAke2tleX1gKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBGYWlsZWQgdG8gZGVsZXRlIHZpZGVvOiAke2tleX1gLCBlcnJvci5zdGFjayk7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0VmlkZW9NZXRhZGF0YShrZXk6IHN0cmluZyk6IFByb21pc2U8e1xyXG4gICAgY29udGVudExlbmd0aDogbnVtYmVyO1xyXG4gICAgY29udGVudFR5cGU6IHN0cmluZztcclxuICAgIGxhc3RNb2RpZmllZDogRGF0ZTtcclxuICAgIGV0YWc6IHN0cmluZztcclxuICAgIG1ldGFkYXRhOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xyXG4gIH0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgSGVhZE9iamVjdENvbW1hbmQoe1xyXG4gICAgICAgIEJ1Y2tldDogdGhpcy5jb25maWcuczNCdWNrZXQsXHJcbiAgICAgICAgS2V5OiBrZXksXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5zM0NsaWVudC5zZW5kKGNvbW1hbmQpO1xyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBjb250ZW50TGVuZ3RoOiByZXN1bHQuQ29udGVudExlbmd0aCB8fCAwLFxyXG4gICAgICAgIGNvbnRlbnRUeXBlOiByZXN1bHQuQ29udGVudFR5cGUgfHwgJycsXHJcbiAgICAgICAgbGFzdE1vZGlmaWVkOiByZXN1bHQuTGFzdE1vZGlmaWVkIHx8IG5ldyBEYXRlKCksXHJcbiAgICAgICAgZXRhZzogcmVzdWx0LkVUYWc/LnJlcGxhY2UoL1wiL2csICcnKSB8fCAnJyxcclxuICAgICAgICBtZXRhZGF0YTogcmVzdWx0Lk1ldGFkYXRhIHx8IHt9LFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEZhaWxlZCB0byBnZXQgdmlkZW8gbWV0YWRhdGE6ICR7a2V5fWAsIGVycm9yLnN0YWNrKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZW5lcmF0ZVNpZ25lZFVybChcclxuICAgIGtleTogc3RyaW5nLFxyXG4gICAgb3B0aW9uczogU2lnbmVkVXJsT3B0aW9ucyA9IHt9LFxyXG4gICk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBleHBpcmVzSW4gPSBvcHRpb25zLmV4cGlyZXNJbiB8fCB0aGlzLmNvbmZpZy5zaWduZWRVcmxFeHBpcnk7XHJcblxyXG4gICAgICBpZiAodGhpcy5jb25maWcucHJpdmF0ZUtleSAmJiB0aGlzLmNvbmZpZy5wcml2YXRlS2V5SWQpIHtcclxuICAgICAgICAvLyBVc2UgQ2xvdWRGcm9udCBzaWduZWQgVVJMcyBmb3IgYmV0dGVyIHNlY3VyaXR5XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVDbG91ZEZyb250U2lnbmVkVXJsKGtleSwgZXhwaXJlc0luLCBvcHRpb25zKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGYWxsYmFjayB0byBTMyBzaWduZWQgVVJMc1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlUzNTaWduZWRVcmwoa2V5LCBleHBpcmVzSW4pO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRmFpbGVkIHRvIGdlbmVyYXRlIHNpZ25lZCBVUkw6ICR7a2V5fWAsIGVycm9yLnN0YWNrKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlUzNTaWduZWRVcmwoa2V5OiBzdHJpbmcsIGV4cGlyZXNJbjogbnVtYmVyKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgR2V0T2JqZWN0Q29tbWFuZCh7XHJcbiAgICAgIEJ1Y2tldDogdGhpcy5jb25maWcuczNCdWNrZXQsXHJcbiAgICAgIEtleToga2V5LFxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGdldFNpZ25lZFVybCh0aGlzLnMzQ2xpZW50LCBjb21tYW5kLCB7IGV4cGlyZXNJbiB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2VuZXJhdGVDbG91ZEZyb250U2lnbmVkVXJsKFxyXG4gICAga2V5OiBzdHJpbmcsXHJcbiAgICBleHBpcmVzSW46IG51bWJlcixcclxuICAgIG9wdGlvbnM6IFNpZ25lZFVybE9wdGlvbnMsXHJcbiAgKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IHVybCA9IGBodHRwczovLyR7dGhpcy5jb25maWcuZGlzdHJpYnV0aW9uRG9tYWlufS8ke2tleX1gO1xyXG4gICAgY29uc3QgZXhwaXJhdGlvbiA9IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApICsgZXhwaXJlc0luO1xyXG5cclxuICAgIC8vIENyZWF0ZSBwb2xpY3lcclxuICAgIGNvbnN0IHBvbGljeSA9IG9wdGlvbnMucG9saWN5IHx8IHtcclxuICAgICAgU3RhdGVtZW50OiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgUmVzb3VyY2U6IHVybCxcclxuICAgICAgICAgIENvbmRpdGlvbjoge1xyXG4gICAgICAgICAgICBEYXRlTGVzc1RoYW46IHtcclxuICAgICAgICAgICAgICAnQVdTOkVwb2NoVGltZSc6IGV4cGlyYXRpb24sXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIC4uLihvcHRpb25zLmlwQWRkcmVzcyAmJiB7XHJcbiAgICAgICAgICAgICAgSXBBZGRyZXNzOiB7XHJcbiAgICAgICAgICAgICAgICAnQVdTOlNvdXJjZUlwJzogb3B0aW9ucy5pcEFkZHJlc3MsXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF0sXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHBvbGljeVN0cmluZyA9IEpTT04uc3RyaW5naWZ5KHBvbGljeSk7XHJcbiAgICBjb25zdCBwb2xpY3lCYXNlNjQgPSBCdWZmZXIuZnJvbShwb2xpY3lTdHJpbmcpLnRvU3RyaW5nKCdiYXNlNjQnKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgc2lnbmF0dXJlXHJcbiAgICBjb25zdCBzaWduYXR1cmUgPSBjcnlwdG9cclxuICAgICAgLmNyZWF0ZVNpZ24oJ1JTQS1TSEExJylcclxuICAgICAgLnVwZGF0ZShwb2xpY3lTdHJpbmcpXHJcbiAgICAgIC5zaWduKHRoaXMuY29uZmlnLnByaXZhdGVLZXksICdiYXNlNjQnKTtcclxuXHJcbiAgICAvLyBVUkwtc2FmZSBiYXNlNjQgZW5jb2RpbmdcclxuICAgIGNvbnN0IHVybFNhZmVQb2xpY3kgPSBwb2xpY3lCYXNlNjQucmVwbGFjZSgvXFwrL2csICctJykucmVwbGFjZSgvXFwvL2csICdfJykucmVwbGFjZSgvPS9nLCAnJyk7XHJcbiAgICBjb25zdCB1cmxTYWZlU2lnbmF0dXJlID0gc2lnbmF0dXJlLnJlcGxhY2UoL1xcKy9nLCAnLScpLnJlcGxhY2UoL1xcLy9nLCAnXycpLnJlcGxhY2UoLz0vZywgJycpO1xyXG5cclxuICAgIHJldHVybiBgJHt1cmx9P1BvbGljeT0ke3VybFNhZmVQb2xpY3l9JlNpZ25hdHVyZT0ke3VybFNhZmVTaWduYXR1cmV9JktleS1QYWlyLUlkPSR7dGhpcy5jb25maWcucHJpdmF0ZUtleUlkfWA7XHJcbiAgfVxyXG5cclxuICBhc3luYyBpbnZhbGlkYXRlQ2FjaGUocGF0aHM6IHN0cmluZ1tdKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAoIXRoaXMuY29uZmlnLmRpc3RyaWJ1dGlvbklkKSB7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybignQ2xvdWRGcm9udCBkaXN0cmlidXRpb24gSUQgbm90IGNvbmZpZ3VyZWQsIHNraXBwaW5nIGNhY2hlIGludmFsaWRhdGlvbicpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5sb2dnZXIuZGVidWcoYEludmFsaWRhdGluZyBDbG91ZEZyb250IGNhY2hlIGZvciBwYXRoczogJHtwYXRocy5qb2luKCcsICcpfWApO1xyXG5cclxuICAgICAgY29uc3QgY29tbWFuZCA9IG5ldyBDcmVhdGVJbnZhbGlkYXRpb25Db21tYW5kKHtcclxuICAgICAgICBEaXN0cmlidXRpb25JZDogdGhpcy5jb25maWcuZGlzdHJpYnV0aW9uSWQsXHJcbiAgICAgICAgSW52YWxpZGF0aW9uQmF0Y2g6IHtcclxuICAgICAgICAgIFBhdGhzOiB7XHJcbiAgICAgICAgICAgIFF1YW50aXR5OiBwYXRocy5sZW5ndGgsXHJcbiAgICAgICAgICAgIEl0ZW1zOiBwYXRocy5tYXAocGF0aCA9PiBgLyR7cGF0aH1gKSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBDYWxsZXJSZWZlcmVuY2U6IGBpbnZhbGlkYXRpb24tJHtEYXRlLm5vdygpfWAsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNsb3VkRnJvbnRDbGllbnQuc2VuZChjb21tYW5kKTtcclxuXHJcbiAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBDYWNoZSBpbnZhbGlkYXRpb24gY3JlYXRlZDogJHtyZXN1bHQuSW52YWxpZGF0aW9uPy5JZH1gKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gaW52YWxpZGF0ZSBDbG91ZEZyb250IGNhY2hlJywgZXJyb3Iuc3RhY2spO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGdldERpc3RyaWJ1dGlvbkluZm8oKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICghdGhpcy5jb25maWcuZGlzdHJpYnV0aW9uSWQpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nsb3VkRnJvbnQgZGlzdHJpYnV0aW9uIElEIG5vdCBjb25maWd1cmVkJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgR2V0RGlzdHJpYnV0aW9uQ29tbWFuZCh7XHJcbiAgICAgICAgSWQ6IHRoaXMuY29uZmlnLmRpc3RyaWJ1dGlvbklkLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY2xvdWRGcm9udENsaWVudC5zZW5kKGNvbW1hbmQpO1xyXG4gICAgICByZXR1cm4gcmVzdWx0LkRpc3RyaWJ1dGlvbjtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZ2V0IGRpc3RyaWJ1dGlvbiBpbmZvJywgZXJyb3Iuc3RhY2spO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdlbmVyYXRlVmlkZW9LZXkoXHJcbiAgICB2aWRlb0lkOiBzdHJpbmcsXHJcbiAgICBxdWFsaXR5Pzogc3RyaW5nLFxyXG4gICAgZm9ybWF0OiBzdHJpbmcgPSAnbXA0JyxcclxuICApOiBzdHJpbmcge1xyXG4gICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcclxuICAgIGNvbnN0IHF1YWxpdHlQcmVmaXggPSBxdWFsaXR5ID8gYCR7cXVhbGl0eX0vYCA6ICcnO1xyXG4gICAgcmV0dXJuIGB2aWRlb3MvJHt2aWRlb0lkfS8ke3F1YWxpdHlQcmVmaXh9JHt0aW1lc3RhbXB9LiR7Zm9ybWF0fWA7XHJcbiAgfVxyXG5cclxuICBnZW5lcmF0ZVRodW1ibmFpbEtleSh2aWRlb0lkOiBzdHJpbmcsIGluZGV4OiBudW1iZXIgPSAwKTogc3RyaW5nIHtcclxuICAgIHJldHVybiBgdmlkZW9zLyR7dmlkZW9JZH0vdGh1bWJuYWlscy90aHVtYl8ke2luZGV4LnRvU3RyaW5nKCkucGFkU3RhcnQoMywgJzAnKX0uanBnYDtcclxuICB9XHJcblxyXG4gIGdlbmVyYXRlTWFuaWZlc3RLZXkodmlkZW9JZDogc3RyaW5nLCB0eXBlOiAnaGxzJyB8ICdkYXNoJyk6IHN0cmluZyB7XHJcbiAgICBjb25zdCBleHRlbnNpb24gPSB0eXBlID09PSAnaGxzJyA/ICdtM3U4JyA6ICdtcGQnO1xyXG4gICAgcmV0dXJuIGB2aWRlb3MvJHt2aWRlb0lkfS9tYW5pZmVzdHMvcGxheWxpc3QuJHtleHRlbnNpb259YDtcclxuICB9XHJcblxyXG4gIGlzQ29uZmlndXJlZCgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiAhIShcclxuICAgICAgdGhpcy5jb25maWcuZGlzdHJpYnV0aW9uRG9tYWluICYmXHJcbiAgICAgIHRoaXMuY29uZmlnLnMzQnVja2V0ICYmXHJcbiAgICAgIHRoaXMuY29uZmlnLmFjY2Vzc0tleUlkICYmXHJcbiAgICAgIHRoaXMuY29uZmlnLnNlY3JldEFjY2Vzc0tleVxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuIl0sInZlcnNpb24iOjN9