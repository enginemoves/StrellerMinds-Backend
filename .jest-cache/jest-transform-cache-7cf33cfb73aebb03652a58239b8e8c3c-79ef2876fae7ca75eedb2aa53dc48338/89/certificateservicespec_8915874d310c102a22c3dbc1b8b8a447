d794dc2e38fb8c99747bcca423870648
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const certificate_service_1 = require("./certificate.service");
const typeorm_1 = require("@nestjs/typeorm");
const certificate_entity_1 = require("./entity/certificate.entity");
const common_1 = require("@nestjs/common");
describe('CertificatesService', () => {
    let service;
    let repo;
    const mockCertificate = {
        id: '1',
        certificateNumber: 'CERT123',
        issueDate: new Date(),
        pdfUrl: 'http://example.com/cert.pdf',
        user: Promise.resolve({ id: 'user1' }),
        course: Promise.resolve({ id: 'course1' }),
    };
    const mockRepo = {
        create: jest.fn().mockReturnValue(mockCertificate),
        save: jest.fn().mockResolvedValue(mockCertificate),
        find: jest.fn().mockResolvedValue([mockCertificate]),
        findOne: jest.fn().mockResolvedValue(mockCertificate),
        update: jest.fn().mockResolvedValue(undefined),
        delete: jest.fn().mockResolvedValue({ affected: 1 }),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                certificate_service_1.CertificatesService,
                {
                    provide: (0, typeorm_1.getRepositoryToken)(certificate_entity_1.Certificate),
                    useValue: mockRepo,
                },
            ],
        }).compile();
        service = module.get(certificate_service_1.CertificatesService);
        repo = module.get((0, typeorm_1.getRepositoryToken)(certificate_entity_1.Certificate));
    });
    it('should create a certificate', async () => {
        const dto = { certificateNumber: 'CERT123', issueDate: new Date(), userId: 'user1', courseId: 'course1' };
        const result = await service.create(dto);
        expect(result).toEqual(mockCertificate);
        expect(repo.create).toHaveBeenCalledWith(dto);
        expect(repo.save).toHaveBeenCalledWith(mockCertificate);
    });
    it('should return all certificates', async () => {
        const result = await service.findAll();
        expect(result).toEqual([mockCertificate]);
    });
    it('should return one certificate by ID', async () => {
        const result = await service.findOne('1');
        expect(result).toEqual(mockCertificate);
    });
    it('should throw NotFoundException if certificate not found', async () => {
        jest.spyOn(repo, 'findOne').mockResolvedValue(null);
        await expect(service.findOne('999')).rejects.toThrow(common_1.NotFoundException);
    });
    it('should update a certificate', async () => {
        const updated = await service.update('1', { pdfUrl: 'new-url.pdf' });
        expect(repo.update).toHaveBeenCalledWith('1', { pdfUrl: 'new-url.pdf' });
        expect(updated).toEqual(mockCertificate);
    });
    it('should delete a certificate', async () => {
        const result = await service.remove('1');
        expect(result).toBeUndefined();
        expect(repo.delete).toHaveBeenCalledWith('1');
    });
    it('should throw NotFoundException on delete if not found', async () => {
        jest.spyOn(repo, 'delete').mockResolvedValue({ affected: 0 });
        await expect(service.remove('999')).rejects.toThrow(common_1.NotFoundException);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxjZXJ0aWZpY2F0ZVxcY2VydGlmaWNhdGUuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELCtEQUE0RDtBQUM1RCw2Q0FBcUQ7QUFDckQsb0VBQTBEO0FBRTFELDJDQUFtRDtBQUVuRCxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO0lBQ25DLElBQUksT0FBNEIsQ0FBQztJQUNqQyxJQUFJLElBQTZCLENBQUM7SUFFbEMsTUFBTSxlQUFlLEdBQUc7UUFDdEIsRUFBRSxFQUFFLEdBQUc7UUFDUCxpQkFBaUIsRUFBRSxTQUFTO1FBQzVCLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRTtRQUNyQixNQUFNLEVBQUUsNkJBQTZCO1FBQ3JDLElBQUksRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSxDQUFDO1FBQ3RDLE1BQU0sRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxDQUFDO0tBQzVCLENBQUM7SUFFakIsTUFBTSxRQUFRLEdBQUc7UUFDZixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxlQUFlLENBQUM7UUFDbEQsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxlQUFlLENBQUM7UUFDbEQsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQ3BELE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsZUFBZSxDQUFDO1FBQ3JELE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDO1FBQzlDLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLENBQUM7S0FDckQsQ0FBQztJQUVGLFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixNQUFNLE1BQU0sR0FBa0IsTUFBTSxjQUFJLENBQUMsbUJBQW1CLENBQUM7WUFDM0QsU0FBUyxFQUFFO2dCQUNULHlDQUFtQjtnQkFDbkI7b0JBQ0UsT0FBTyxFQUFFLElBQUEsNEJBQWtCLEVBQUMsZ0NBQVcsQ0FBQztvQkFDeEMsUUFBUSxFQUFFLFFBQVE7aUJBQ25CO2FBQ0Y7U0FDRixDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFYixPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBc0IseUNBQW1CLENBQUMsQ0FBQztRQUMvRCxJQUFJLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBMEIsSUFBQSw0QkFBa0IsRUFBQyxnQ0FBVyxDQUFDLENBQUMsQ0FBQztJQUM5RSxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyw2QkFBNkIsRUFBRSxLQUFLLElBQUksRUFBRTtRQUMzQyxNQUFNLEdBQUcsR0FBRyxFQUFFLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsQ0FBQztRQUMxRyxNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBVSxDQUFDLENBQUM7UUFDaEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUN4QyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzlDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsb0JBQW9CLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDMUQsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsZ0NBQWdDLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDOUMsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDdkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUM7SUFDNUMsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMscUNBQXFDLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDbkQsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDMUMsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMseURBQXlELEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDdkUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEQsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsMEJBQWlCLENBQUMsQ0FBQztJQUMxRSxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyw2QkFBNkIsRUFBRSxLQUFLLElBQUksRUFBRTtRQUMzQyxNQUFNLE9BQU8sR0FBRyxNQUFNLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLEVBQUUsTUFBTSxFQUFFLGFBQWEsRUFBRSxDQUFDLENBQUM7UUFDckUsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLEVBQUUsRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLENBQUMsQ0FBQztRQUN6RSxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQzNDLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLDZCQUE2QixFQUFFLEtBQUssSUFBSSxFQUFFO1FBQzNDLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN6QyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDL0IsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNoRCxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyx1REFBdUQsRUFBRSxLQUFLLElBQUksRUFBRTtRQUNyRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzlELE1BQU0sTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLDBCQUFpQixDQUFDLENBQUM7SUFDekUsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXG9qb3NlcGhcXERvY3VtZW50c1xcU3RyZWxsZXJNaW5kcy1CYWNrZW5kXFxzcmNcXGNlcnRpZmljYXRlXFxjZXJ0aWZpY2F0ZS5zZXJ2aWNlLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XHJcbmltcG9ydCB7IENlcnRpZmljYXRlc1NlcnZpY2UgfSBmcm9tICcuL2NlcnRpZmljYXRlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBnZXRSZXBvc2l0b3J5VG9rZW4gfSBmcm9tICdAbmVzdGpzL3R5cGVvcm0nO1xyXG5pbXBvcnQgeyBDZXJ0aWZpY2F0ZSB9IGZyb20gJy4vZW50aXR5L2NlcnRpZmljYXRlLmVudGl0eSc7XHJcbmltcG9ydCB7IFJlcG9zaXRvcnkgfSBmcm9tICd0eXBlb3JtJztcclxuaW1wb3J0IHsgTm90Rm91bmRFeGNlcHRpb24gfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XHJcblxyXG5kZXNjcmliZSgnQ2VydGlmaWNhdGVzU2VydmljZScsICgpID0+IHtcclxuICBsZXQgc2VydmljZTogQ2VydGlmaWNhdGVzU2VydmljZTtcclxuICBsZXQgcmVwbzogUmVwb3NpdG9yeTxDZXJ0aWZpY2F0ZT47XHJcblxyXG4gIGNvbnN0IG1vY2tDZXJ0aWZpY2F0ZSA9IHtcclxuICAgIGlkOiAnMScsXHJcbiAgICBjZXJ0aWZpY2F0ZU51bWJlcjogJ0NFUlQxMjMnLFxyXG4gICAgaXNzdWVEYXRlOiBuZXcgRGF0ZSgpLFxyXG4gICAgcGRmVXJsOiAnaHR0cDovL2V4YW1wbGUuY29tL2NlcnQucGRmJyxcclxuICAgIHVzZXI6IFByb21pc2UucmVzb2x2ZSh7IGlkOiAndXNlcjEnIH0pLFxyXG4gICAgY291cnNlOiBQcm9taXNlLnJlc29sdmUoeyBpZDogJ2NvdXJzZTEnIH0pLFxyXG4gIH0gYXMgQ2VydGlmaWNhdGU7XHJcblxyXG4gIGNvbnN0IG1vY2tSZXBvID0ge1xyXG4gICAgY3JlYXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG1vY2tDZXJ0aWZpY2F0ZSksXHJcbiAgICBzYXZlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NlcnRpZmljYXRlKSxcclxuICAgIGZpbmQ6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbbW9ja0NlcnRpZmljYXRlXSksXHJcbiAgICBmaW5kT25lOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NlcnRpZmljYXRlKSxcclxuICAgIHVwZGF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXHJcbiAgICBkZWxldGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGFmZmVjdGVkOiAxIH0pLFxyXG4gIH07XHJcblxyXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcclxuICAgICAgcHJvdmlkZXJzOiBbXHJcbiAgICAgICAgQ2VydGlmaWNhdGVzU2VydmljZSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBwcm92aWRlOiBnZXRSZXBvc2l0b3J5VG9rZW4oQ2VydGlmaWNhdGUpLFxyXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tSZXBvLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF0sXHJcbiAgICB9KS5jb21waWxlKCk7XHJcblxyXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8Q2VydGlmaWNhdGVzU2VydmljZT4oQ2VydGlmaWNhdGVzU2VydmljZSk7XHJcbiAgICByZXBvID0gbW9kdWxlLmdldDxSZXBvc2l0b3J5PENlcnRpZmljYXRlPj4oZ2V0UmVwb3NpdG9yeVRva2VuKENlcnRpZmljYXRlKSk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzaG91bGQgY3JlYXRlIGEgY2VydGlmaWNhdGUnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCBkdG8gPSB7IGNlcnRpZmljYXRlTnVtYmVyOiAnQ0VSVDEyMycsIGlzc3VlRGF0ZTogbmV3IERhdGUoKSwgdXNlcklkOiAndXNlcjEnLCBjb3Vyc2VJZDogJ2NvdXJzZTEnIH07XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmNyZWF0ZShkdG8gYXMgYW55KTtcclxuICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0NlcnRpZmljYXRlKTtcclxuICAgIGV4cGVjdChyZXBvLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZHRvKTtcclxuICAgIGV4cGVjdChyZXBvLnNhdmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tDZXJ0aWZpY2F0ZSk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzaG91bGQgcmV0dXJuIGFsbCBjZXJ0aWZpY2F0ZXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRBbGwoKTtcclxuICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoW21vY2tDZXJ0aWZpY2F0ZV0pO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIHJldHVybiBvbmUgY2VydGlmaWNhdGUgYnkgSUQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRPbmUoJzEnKTtcclxuICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0NlcnRpZmljYXRlKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3Nob3VsZCB0aHJvdyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBjZXJ0aWZpY2F0ZSBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBqZXN0LnNweU9uKHJlcG8sICdmaW5kT25lJykubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XHJcbiAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5maW5kT25lKCc5OTknKSkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3Nob3VsZCB1cGRhdGUgYSBjZXJ0aWZpY2F0ZScsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCBzZXJ2aWNlLnVwZGF0ZSgnMScsIHsgcGRmVXJsOiAnbmV3LXVybC5wZGYnIH0pO1xyXG4gICAgZXhwZWN0KHJlcG8udXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnMScsIHsgcGRmVXJsOiAnbmV3LXVybC5wZGYnIH0pO1xyXG4gICAgZXhwZWN0KHVwZGF0ZWQpLnRvRXF1YWwobW9ja0NlcnRpZmljYXRlKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3Nob3VsZCBkZWxldGUgYSBjZXJ0aWZpY2F0ZScsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UucmVtb3ZlKCcxJyk7XHJcbiAgICBleHBlY3QocmVzdWx0KS50b0JlVW5kZWZpbmVkKCk7XHJcbiAgICBleHBlY3QocmVwby5kZWxldGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcxJyk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gb24gZGVsZXRlIGlmIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgIGplc3Quc3B5T24ocmVwbywgJ2RlbGV0ZScpLm1vY2tSZXNvbHZlZFZhbHVlKHsgYWZmZWN0ZWQ6IDAgfSk7XHJcbiAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5yZW1vdmUoJzk5OScpKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9