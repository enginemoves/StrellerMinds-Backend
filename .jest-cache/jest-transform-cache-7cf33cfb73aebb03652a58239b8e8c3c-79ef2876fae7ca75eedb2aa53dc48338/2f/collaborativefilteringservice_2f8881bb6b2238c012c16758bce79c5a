39b13820b73ae6e75564fbc23bdf4670
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var CollaborativeFilteringService_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.CollaborativeFilteringService = void 0;
const common_1 = require("@nestjs/common");
const typeorm_1 = require("@nestjs/typeorm");
const typeorm_2 = require("typeorm");
const user_interaction_entity_1 = require("../entities/user-interaction.entity");
const user_entity_1 = require("../../users/entities/user.entity");
const course_entity_1 = require("../../courses/entities/course.entity");
const recommendation_entity_1 = require("../entities/recommendation.entity");
let CollaborativeFilteringService = CollaborativeFilteringService_1 = class CollaborativeFilteringService {
    constructor(interactionRepository, userRepository, courseRepository) {
        this.interactionRepository = interactionRepository;
        this.userRepository = userRepository;
        this.courseRepository = courseRepository;
        this.logger = new common_1.Logger(CollaborativeFilteringService_1.name);
        this.userSimilarityCache = new Map();
        this.itemSimilarityCache = new Map();
        this.cacheExpiry = 24 * 60 * 60 * 1000; // 24 hours
    }
    /**
     * Generate recommendations using collaborative filtering
     */
    async generateRecommendations(context, options) {
        try {
            this.logger.log(`Generating collaborative filtering recommendations for user ${context.userId}`);
            // Get user-based collaborative filtering recommendations
            const userBasedRecs = await this.getUserBasedRecommendations(context, Math.ceil(options.limit * 0.6));
            // Get item-based collaborative filtering recommendations
            const itemBasedRecs = await this.getItemBasedRecommendations(context, Math.ceil(options.limit * 0.4));
            // Combine and rank recommendations
            const combinedRecs = [...userBasedRecs, ...itemBasedRecs];
            const rankedRecs = this.rankCollaborativeRecommendations(combinedRecs);
            // Filter by confidence and limit
            const filteredRecs = rankedRecs
                .filter(rec => rec.score >= options.minConfidence)
                .slice(0, options.limit);
            // Convert to recommendation format
            return filteredRecs.map(rec => this.createRecommendation(rec, context));
        }
        catch (error) {
            this.logger.error('Error generating collaborative filtering recommendations:', error);
            return [];
        }
    }
    /**
     * Find similar users based on interaction patterns
     */
    async findSimilarUsers(userId, limit = 20) {
        // Check cache first
        const cacheKey = `user_${userId}`;
        const cached = this.userSimilarityCache.get(cacheKey);
        if (cached && this.isCacheValid(cacheKey)) {
            return cached.slice(0, limit);
        }
        try {
            // Get user's interactions
            const userInteractions = await this.getUserInteractions(userId);
            if (userInteractions.length === 0) {
                return [];
            }
            // Get all other users who have interacted with similar content
            const courseIds = userInteractions.map(i => i.courseId).filter(Boolean);
            const otherUsers = await this.interactionRepository
                .createQueryBuilder('interaction')
                .select('DISTINCT interaction.userId')
                .where('interaction.courseId IN (:...courseIds)', { courseIds })
                .andWhere('interaction.userId != :userId', { userId })
                .getRawMany();
            // Calculate similarity with each user
            const similarities = [];
            for (const { userId: otherUserId } of otherUsers) {
                const otherInteractions = await this.getUserInteractions(otherUserId);
                const similarity = this.calculateUserSimilarity(userInteractions, otherInteractions);
                if (similarity.similarity > 0.1) { // Only include users with meaningful similarity
                    similarities.push({
                        userId: otherUserId,
                        similarity: similarity.similarity,
                        commonInteractions: similarity.commonInteractions,
                    });
                }
            }
            // Sort by similarity and cache
            similarities.sort((a, b) => b.similarity - a.similarity);
            this.userSimilarityCache.set(cacheKey, similarities);
            return similarities.slice(0, limit);
        }
        catch (error) {
            this.logger.error(`Error finding similar users for ${userId}:`, error);
            return [];
        }
    }
    /**
     * Find similar items (courses) based on user interaction patterns
     */
    async findSimilarItems(courseId, limit = 20) {
        // Check cache first
        const cacheKey = `item_${courseId}`;
        const cached = this.itemSimilarityCache.get(cacheKey);
        if (cached && this.isCacheValid(cacheKey)) {
            return cached.slice(0, limit);
        }
        try {
            // Get users who interacted with this course
            const courseUsers = await this.interactionRepository.find({
                where: { courseId },
                select: ['userId'],
            });
            if (courseUsers.length === 0) {
                return [];
            }
            const userIds = courseUsers.map(u => u.userId);
            // Get other courses these users interacted with
            const otherCourses = await this.interactionRepository
                .createQueryBuilder('interaction')
                .select('DISTINCT interaction.courseId')
                .where('interaction.userId IN (:...userIds)', { userIds })
                .andWhere('interaction.courseId != :courseId', { courseId })
                .getRawMany();
            // Calculate similarity with each course
            const similarities = [];
            for (const { courseId: otherCourseId } of otherCourses) {
                const otherCourseUsers = await this.interactionRepository.find({
                    where: { courseId: otherCourseId },
                    select: ['userId'],
                });
                const similarity = this.calculateItemSimilarity(userIds, otherCourseUsers.map(u => u.userId));
                if (similarity.similarity > 0.1) {
                    similarities.push({
                        courseId: otherCourseId,
                        similarity: similarity.similarity,
                        commonUsers: similarity.commonUsers,
                    });
                }
            }
            // Sort by similarity and cache
            similarities.sort((a, b) => b.similarity - a.similarity);
            this.itemSimilarityCache.set(cacheKey, similarities);
            return similarities.slice(0, limit);
        }
        catch (error) {
            this.logger.error(`Error finding similar items for ${courseId}:`, error);
            return [];
        }
    }
    /**
     * Get user-based collaborative filtering recommendations
     */
    async getUserBasedRecommendations(context, limit) {
        // Find similar users
        const similarUsers = await this.findSimilarUsers(context.userId, 50);
        if (similarUsers.length === 0) {
            return [];
        }
        // Get courses that similar users liked but current user hasn't interacted with
        const userCourseIds = new Set(context.recentInteractions?.map(i => i.courseId).filter(Boolean) || []);
        const recommendations = new Map();
        for (const similarUser of similarUsers.slice(0, 20)) { // Top 20 similar users
            const similarUserInteractions = await this.getUserInteractions(similarUser.userId);
            // Find highly rated interactions from similar users
            const positiveInteractions = similarUserInteractions.filter(interaction => this.isPositiveInteraction(interaction) &&
                !userCourseIds.has(interaction.courseId));
            for (const interaction of positiveInteractions) {
                if (!interaction.courseId)
                    continue;
                const existing = recommendations.get(interaction.courseId) || {
                    score: 0,
                    count: 0,
                    similarUsers: [],
                };
                // Weight by user similarity and interaction strength
                const interactionWeight = this.getInteractionWeight(interaction);
                const weightedScore = similarUser.similarity * interactionWeight;
                existing.score += weightedScore;
                existing.count += 1;
                existing.similarUsers.push(similarUser.userId);
                recommendations.set(interaction.courseId, existing);
            }
        }
        // Convert to recommendation format and sort
        const result = [];
        for (const [courseId, data] of recommendations.entries()) {
            const normalizedScore = data.score / Math.max(data.count, 1);
            result.push({
                courseId,
                score: normalizedScore,
                reason: `Recommended by ${data.count} similar learners`,
                similarUsers: data.similarUsers.slice(0, 5),
            });
        }
        return result
            .sort((a, b) => b.score - a.score)
            .slice(0, limit);
    }
    /**
     * Get item-based collaborative filtering recommendations
     */
    async getItemBasedRecommendations(context, limit) {
        // Get courses user has positively interacted with
        const userInteractions = context.recentInteractions || [];
        const positiveCourses = userInteractions
            .filter(i => this.isPositiveInteraction(i) && i.courseId)
            .map(i => i.courseId)
            .slice(0, 10); // Consider top 10 courses
        if (positiveCourses.length === 0) {
            return [];
        }
        const recommendations = new Map();
        // For each course user liked, find similar courses
        for (const courseId of positiveCourses) {
            const similarItems = await this.findSimilarItems(courseId, 20);
            for (const similarItem of similarItems) {
                // Skip if user already interacted with this course
                if (positiveCourses.includes(similarItem.courseId))
                    continue;
                const existing = recommendations.get(similarItem.courseId) || {
                    score: 0,
                    count: 0,
                    similarItems: [],
                };
                existing.score += similarItem.similarity;
                existing.count += 1;
                existing.similarItems.push(courseId);
                recommendations.set(similarItem.courseId, existing);
            }
        }
        // Convert to recommendation format and sort
        const result = [];
        for (const [courseId, data] of recommendations.entries()) {
            const normalizedScore = data.score / Math.max(data.count, 1);
            result.push({
                courseId,
                score: normalizedScore,
                reason: `Similar to ${data.count} courses you've engaged with`,
                similarItems: data.similarItems.slice(0, 3),
            });
        }
        return result
            .sort((a, b) => b.score - a.score)
            .slice(0, limit);
    }
    /**
     * Get user interactions with weighted values
     */
    async getUserInteractions(userId) {
        return await this.interactionRepository.find({
            where: { userId },
            order: { createdAt: 'DESC' },
            take: 500, // Limit for performance
            relations: ['course'],
        });
    }
    /**
     * Calculate similarity between two users based on their interactions
     */
    calculateUserSimilarity(user1Interactions, user2Interactions) {
        // Create maps of course interactions for each user
        const user1Courses = new Map();
        const user2Courses = new Map();
        // Build weighted interaction maps
        user1Interactions.forEach(interaction => {
            if (interaction.courseId) {
                const weight = this.getInteractionWeight(interaction);
                user1Courses.set(interaction.courseId, (user1Courses.get(interaction.courseId) || 0) + weight);
            }
        });
        user2Interactions.forEach(interaction => {
            if (interaction.courseId) {
                const weight = this.getInteractionWeight(interaction);
                user2Courses.set(interaction.courseId, (user2Courses.get(interaction.courseId) || 0) + weight);
            }
        });
        // Find common courses
        const commonCourses = new Set([...user1Courses.keys()].filter(courseId => user2Courses.has(courseId)));
        if (commonCourses.size === 0) {
            return { similarity: 0, commonInteractions: 0 };
        }
        // Calculate cosine similarity
        let dotProduct = 0;
        let norm1 = 0;
        let norm2 = 0;
        // Calculate for all courses (not just common ones)
        const allCourses = new Set([...user1Courses.keys(), ...user2Courses.keys()]);
        for (const courseId of allCourses) {
            const rating1 = user1Courses.get(courseId) || 0;
            const rating2 = user2Courses.get(courseId) || 0;
            dotProduct += rating1 * rating2;
            norm1 += rating1 * rating1;
            norm2 += rating2 * rating2;
        }
        const similarity = (norm1 > 0 && norm2 > 0)
            ? dotProduct / (Math.sqrt(norm1) * Math.sqrt(norm2))
            : 0;
        return {
            similarity: Math.max(0, Math.min(1, similarity)),
            commonInteractions: commonCourses.size,
        };
    }
    /**
     * Calculate similarity between two items based on user interactions
     */
    calculateItemSimilarity(item1Users, item2Users) {
        const users1Set = new Set(item1Users);
        const users2Set = new Set(item2Users);
        // Calculate Jaccard similarity
        const intersection = new Set([...users1Set].filter(userId => users2Set.has(userId)));
        const union = new Set([...users1Set, ...users2Set]);
        const similarity = union.size > 0 ? intersection.size / union.size : 0;
        return {
            similarity,
            commonUsers: intersection.size,
        };
    }
    /**
     * Get weight for different interaction types
     */
    getInteractionWeight(interaction) {
        const weights = {
            [user_interaction_entity_1.InteractionType.VIEW]: 0.1,
            [user_interaction_entity_1.InteractionType.CLICK]: 0.2,
            [user_interaction_entity_1.InteractionType.ENROLL]: 0.8,
            [user_interaction_entity_1.InteractionType.START]: 0.6,
            [user_interaction_entity_1.InteractionType.PROGRESS]: 0.7,
            [user_interaction_entity_1.InteractionType.COMPLETE]: 1.0,
            [user_interaction_entity_1.InteractionType.RATE]: 0.9,
            [user_interaction_entity_1.InteractionType.BOOKMARK]: 0.5,
            [user_interaction_entity_1.InteractionType.SHARE]: 0.4,
            [user_interaction_entity_1.InteractionType.DOWNLOAD]: 0.3,
        };
        let baseWeight = weights[interaction.interactionType] || 0.1;
        // Apply additional weighting based on interaction metadata
        if (interaction.weightedValue) {
            baseWeight *= interaction.weightedValue;
        }
        return Math.max(0, Math.min(1, baseWeight));
    }
    /**
     * Check if interaction is positive (indicates user interest/satisfaction)
     */
    isPositiveInteraction(interaction) {
        const positiveTypes = [
            user_interaction_entity_1.InteractionType.ENROLL,
            user_interaction_entity_1.InteractionType.COMPLETE,
            user_interaction_entity_1.InteractionType.RATE,
            user_interaction_entity_1.InteractionType.BOOKMARK,
            user_interaction_entity_1.InteractionType.SHARE,
            user_interaction_entity_1.InteractionType.PROGRESS,
        ];
        return positiveTypes.includes(interaction.interactionType) ||
            (interaction.weightedValue && interaction.weightedValue > 0.5);
    }
    /**
     * Rank collaborative recommendations by combining scores
     */
    rankCollaborativeRecommendations(recommendations) {
        // Remove duplicates and combine scores
        const combined = new Map();
        recommendations.forEach(rec => {
            const existing = combined.get(rec.courseId);
            if (existing) {
                // Combine scores using weighted average
                existing.score = (existing.score + rec.score) / 2;
                existing.reason = `${existing.reason} and ${rec.reason}`;
                if (rec.similarUsers) {
                    existing.similarUsers = [...(existing.similarUsers || []), ...rec.similarUsers];
                }
                if (rec.similarItems) {
                    existing.similarItems = [...(existing.similarItems || []), ...rec.similarItems];
                }
            }
            else {
                combined.set(rec.courseId, { ...rec });
            }
        });
        return Array.from(combined.values()).sort((a, b) => b.score - a.score);
    }
    /**
     * Create recommendation from collaborative recommendation
     */
    createRecommendation(colabRec, context) {
        const hasUserBased = colabRec.similarUsers && colabRec.similarUsers.length > 0;
        const hasItemBased = colabRec.similarItems && colabRec.similarItems.length > 0;
        let reason;
        if (hasUserBased && hasItemBased) {
            reason = recommendation_entity_1.RecommendationReason.COLLABORATIVE_FILTERING;
        }
        else if (hasUserBased) {
            reason = recommendation_entity_1.RecommendationReason.SIMILAR_USERS;
        }
        else {
            reason = recommendation_entity_1.RecommendationReason.SIMILAR_CONTENT;
        }
        return {
            userId: context.userId,
            courseId: colabRec.courseId,
            recommendationType: recommendation_entity_1.RecommendationType.COLLABORATIVE,
            reason,
            confidenceScore: colabRec.score,
            relevanceScore: colabRec.score * 0.9,
            priority: this.calculatePriority(colabRec.score),
            explanation: colabRec.reason,
            metadata: {
                algorithmUsed: 'collaborative_filtering',
                collaborativeScore: colabRec.score,
                similarUsers: colabRec.similarUsers?.slice(0, 3) || [],
                similarItems: colabRec.similarItems?.slice(0, 3) || [],
                recommendationType: hasUserBased ? 'user_based' : 'item_based',
            },
        };
    }
    /**
     * Calculate priority based on collaborative score
     */
    calculatePriority(score) {
        if (score >= 0.8)
            return 5;
        if (score >= 0.6)
            return 4;
        if (score >= 0.4)
            return 3;
        if (score >= 0.2)
            return 2;
        return 1;
    }
    /**
     * Check if cache is still valid
     */
    isCacheValid(cacheKey) {
        // Simple time-based cache validation
        // In a real implementation, you might want more sophisticated cache invalidation
        return true; // Placeholder - implement based on your caching strategy
    }
    /**
     * Clear similarity caches (useful for testing or manual cache refresh)
     */
    clearCache() {
        this.userSimilarityCache.clear();
        this.itemSimilarityCache.clear();
        this.logger.log('Collaborative filtering caches cleared');
    }
};
exports.CollaborativeFilteringService = CollaborativeFilteringService;
exports.CollaborativeFilteringService = CollaborativeFilteringService = CollaborativeFilteringService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(user_interaction_entity_1.UserInteraction)),
    __param(1, (0, typeorm_1.InjectRepository)(user_entity_1.User)),
    __param(2, (0, typeorm_1.InjectRepository)(course_entity_1.Course)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _c : Object])
], CollaborativeFilteringService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxyZWNvbW1lbmRhdGlvblxcc2VydmljZXNcXGNvbGxhYm9yYXRpdmUtZmlsdGVyaW5nLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBb0Q7QUFDcEQsNkNBQW1EO0FBQ25ELHFDQUFxQztBQUNyQyxpRkFBdUY7QUFDdkYsa0VBQXdEO0FBQ3hELHdFQUE4RDtBQUM5RCw2RUFBNkc7QUEwQnRHLElBQU0sNkJBQTZCLHFDQUFuQyxNQUFNLDZCQUE2QjtJQU14QyxZQUVFLHFCQUEwRCxFQUUxRCxjQUF3QyxFQUV4QyxnQkFBNEM7UUFKcEMsMEJBQXFCLEdBQXJCLHFCQUFxQixDQUE2QjtRQUVsRCxtQkFBYyxHQUFkLGNBQWMsQ0FBa0I7UUFFaEMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFvQjtRQVg3QixXQUFNLEdBQUcsSUFBSSxlQUFNLENBQUMsK0JBQTZCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakUsd0JBQW1CLEdBQUcsSUFBSSxHQUFHLEVBQTRCLENBQUM7UUFDMUQsd0JBQW1CLEdBQUcsSUFBSSxHQUFHLEVBQTRCLENBQUM7UUFDMUQsZ0JBQVcsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQyxXQUFXO0lBU25ELENBQUM7SUFFSjs7T0FFRztJQUNILEtBQUssQ0FBQyx1QkFBdUIsQ0FDM0IsT0FBOEIsRUFDOUIsT0FBaUQ7UUFFakQsSUFBSSxDQUFDO1lBQ0gsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsK0RBQStELE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBRWpHLHlEQUF5RDtZQUN6RCxNQUFNLGFBQWEsR0FBRyxNQUFNLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FB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Qiw2QkFBNkIsQ0F5aUJ6QyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXG9qb3NlcGhcXERvY3VtZW50c1xcU3RyZWxsZXJNaW5kcy1CYWNrZW5kXFxzcmNcXHJlY29tbWVuZGF0aW9uXFxzZXJ2aWNlc1xcY29sbGFib3JhdGl2ZS1maWx0ZXJpbmcuc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBMb2dnZXIgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XHJcbmltcG9ydCB7IEluamVjdFJlcG9zaXRvcnkgfSBmcm9tICdAbmVzdGpzL3R5cGVvcm0nO1xyXG5pbXBvcnQgeyBSZXBvc2l0b3J5IH0gZnJvbSAndHlwZW9ybSc7XHJcbmltcG9ydCB7IFVzZXJJbnRlcmFjdGlvbiwgSW50ZXJhY3Rpb25UeXBlIH0gZnJvbSAnLi4vZW50aXRpZXMvdXNlci1pbnRlcmFjdGlvbi5lbnRpdHknO1xyXG5pbXBvcnQgeyBVc2VyIH0gZnJvbSAnLi4vLi4vdXNlcnMvZW50aXRpZXMvdXNlci5lbnRpdHknO1xyXG5pbXBvcnQgeyBDb3Vyc2UgfSBmcm9tICcuLi8uLi9jb3Vyc2VzL2VudGl0aWVzL2NvdXJzZS5lbnRpdHknO1xyXG5pbXBvcnQgeyBSZWNvbW1lbmRhdGlvbiwgUmVjb21tZW5kYXRpb25UeXBlLCBSZWNvbW1lbmRhdGlvblJlYXNvbiB9IGZyb20gJy4uL2VudGl0aWVzL3JlY29tbWVuZGF0aW9uLmVudGl0eSc7XHJcbmltcG9ydCB7IFJlY29tbWVuZGF0aW9uQ29udGV4dCB9IGZyb20gJy4vcmVjb21tZW5kYXRpb24tZW5naW5lLnNlcnZpY2UnO1xyXG5cclxuaW50ZXJmYWNlIFVzZXJTaW1pbGFyaXR5IHtcclxuICB1c2VySWQ6IHN0cmluZztcclxuICBzaW1pbGFyaXR5OiBudW1iZXI7XHJcbiAgY29tbW9uSW50ZXJhY3Rpb25zOiBudW1iZXI7XHJcbiAgdXNlcj86IFVzZXI7XHJcbn1cclxuXHJcbmludGVyZmFjZSBJdGVtU2ltaWxhcml0eSB7XHJcbiAgY291cnNlSWQ6IHN0cmluZztcclxuICBzaW1pbGFyaXR5OiBudW1iZXI7XHJcbiAgY29tbW9uVXNlcnM6IG51bWJlcjtcclxuICBjb3Vyc2U/OiBDb3Vyc2U7XHJcbn1cclxuXHJcbmludGVyZmFjZSBDb2xsYWJvcmF0aXZlUmVjb21tZW5kYXRpb24ge1xyXG4gIGNvdXJzZUlkOiBzdHJpbmc7XHJcbiAgc2NvcmU6IG51bWJlcjtcclxuICByZWFzb246IHN0cmluZztcclxuICBzaW1pbGFyVXNlcnM/OiBzdHJpbmdbXTtcclxuICBzaW1pbGFySXRlbXM/OiBzdHJpbmdbXTtcclxufVxyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgQ29sbGFib3JhdGl2ZUZpbHRlcmluZ1NlcnZpY2Uge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihDb2xsYWJvcmF0aXZlRmlsdGVyaW5nU2VydmljZS5uYW1lKTtcclxuICBwcml2YXRlIHVzZXJTaW1pbGFyaXR5Q2FjaGUgPSBuZXcgTWFwPHN0cmluZywgVXNlclNpbWlsYXJpdHlbXT4oKTtcclxuICBwcml2YXRlIGl0ZW1TaW1pbGFyaXR5Q2FjaGUgPSBuZXcgTWFwPHN0cmluZywgSXRlbVNpbWlsYXJpdHlbXT4oKTtcclxuICBwcml2YXRlIGNhY2hlRXhwaXJ5ID0gMjQgKiA2MCAqIDYwICogMTAwMDsgLy8gMjQgaG91cnNcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBASW5qZWN0UmVwb3NpdG9yeShVc2VySW50ZXJhY3Rpb24pXHJcbiAgICBwcml2YXRlIGludGVyYWN0aW9uUmVwb3NpdG9yeTogUmVwb3NpdG9yeTxVc2VySW50ZXJhY3Rpb24+LFxyXG4gICAgQEluamVjdFJlcG9zaXRvcnkoVXNlcilcclxuICAgIHByaXZhdGUgdXNlclJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8VXNlcj4sXHJcbiAgICBASW5qZWN0UmVwb3NpdG9yeShDb3Vyc2UpXHJcbiAgICBwcml2YXRlIGNvdXJzZVJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8Q291cnNlPixcclxuICApIHt9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYXRlIHJlY29tbWVuZGF0aW9ucyB1c2luZyBjb2xsYWJvcmF0aXZlIGZpbHRlcmluZ1xyXG4gICAqL1xyXG4gIGFzeW5jIGdlbmVyYXRlUmVjb21tZW5kYXRpb25zKFxyXG4gICAgY29udGV4dDogUmVjb21tZW5kYXRpb25Db250ZXh0LFxyXG4gICAgb3B0aW9uczogeyBsaW1pdDogbnVtYmVyOyBtaW5Db25maWRlbmNlOiBudW1iZXIgfSxcclxuICApOiBQcm9taXNlPFBhcnRpYWw8UmVjb21tZW5kYXRpb24+W10+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmxvZyhgR2VuZXJhdGluZyBjb2xsYWJvcmF0aXZlIGZpbHRlcmluZyByZWNvbW1lbmRhdGlvbnMgZm9yIHVzZXIgJHtjb250ZXh0LnVzZXJJZH1gKTtcclxuXHJcbiAgICAgIC8vIEdldCB1c2VyLWJhc2VkIGNvbGxhYm9yYXRpdmUgZmlsdGVyaW5nIHJlY29tbWVuZGF0aW9uc1xyXG4gICAgICBjb25zdCB1c2VyQmFzZWRSZWNzID0gYXdhaXQgdGhpcy5nZXRVc2VyQmFzZWRSZWNvbW1lbmRhdGlvbnMoY29udGV4dCwgTWF0aC5jZWlsKG9wdGlvbnMubGltaXQgKiAwLjYpKTtcclxuICAgICAgXHJcbiAgICAgIC8vIEdldCBpdGVtLWJhc2VkIGNvbGxhYm9yYXRpdmUgZmlsdGVyaW5nIHJlY29tbWVuZGF0aW9uc1xyXG4gICAgICBjb25zdCBpdGVtQmFzZWRSZWNzID0gYXdhaXQgdGhpcy5nZXRJdGVtQmFzZWRSZWNvbW1lbmRhdGlvbnMoY29udGV4dCwgTWF0aC5jZWlsKG9wdGlvbnMubGltaXQgKiAwLjQpKTtcclxuICAgICAgXHJcbiAgICAgIC8vIENvbWJpbmUgYW5kIHJhbmsgcmVjb21tZW5kYXRpb25zXHJcbiAgICAgIGNvbnN0IGNvbWJpbmVkUmVjcyA9IFsuLi51c2VyQmFzZWRSZWNzLCAuLi5pdGVtQmFzZWRSZWNzXTtcclxuICAgICAgY29uc3QgcmFua2VkUmVjcyA9IHRoaXMucmFua0NvbGxhYm9yYXRpdmVSZWNvbW1lbmRhdGlvbnMoY29tYmluZWRSZWNzKTtcclxuICAgICAgXHJcbiAgICAgIC8vIEZpbHRlciBieSBjb25maWRlbmNlIGFuZCBsaW1pdFxyXG4gICAgICBjb25zdCBmaWx0ZXJlZFJlY3MgPSByYW5rZWRSZWNzXHJcbiAgICAgICAgLmZpbHRlcihyZWMgPT4gcmVjLnNjb3JlID49IG9wdGlvbnMubWluQ29uZmlkZW5jZSlcclxuICAgICAgICAuc2xpY2UoMCwgb3B0aW9ucy5saW1pdCk7XHJcblxyXG4gICAgICAvLyBDb252ZXJ0IHRvIHJlY29tbWVuZGF0aW9uIGZvcm1hdFxyXG4gICAgICByZXR1cm4gZmlsdGVyZWRSZWNzLm1hcChyZWMgPT4gdGhpcy5jcmVhdGVSZWNvbW1lbmRhdGlvbihyZWMsIGNvbnRleHQpKTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcignRXJyb3IgZ2VuZXJhdGluZyBjb2xsYWJvcmF0aXZlIGZpbHRlcmluZyByZWNvbW1lbmRhdGlvbnM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGaW5kIHNpbWlsYXIgdXNlcnMgYmFzZWQgb24gaW50ZXJhY3Rpb24gcGF0dGVybnNcclxuICAgKi9cclxuICBhc3luYyBmaW5kU2ltaWxhclVzZXJzKHVzZXJJZDogc3RyaW5nLCBsaW1pdDogbnVtYmVyID0gMjApOiBQcm9taXNlPFVzZXJTaW1pbGFyaXR5W10+IHtcclxuICAgIC8vIENoZWNrIGNhY2hlIGZpcnN0XHJcbiAgICBjb25zdCBjYWNoZUtleSA9IGB1c2VyXyR7dXNlcklkfWA7XHJcbiAgICBjb25zdCBjYWNoZWQgPSB0aGlzLnVzZXJTaW1pbGFyaXR5Q2FjaGUuZ2V0KGNhY2hlS2V5KTtcclxuICAgIGlmIChjYWNoZWQgJiYgdGhpcy5pc0NhY2hlVmFsaWQoY2FjaGVLZXkpKSB7XHJcbiAgICAgIHJldHVybiBjYWNoZWQuc2xpY2UoMCwgbGltaXQpO1xyXG4gICAgfVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIEdldCB1c2VyJ3MgaW50ZXJhY3Rpb25zXHJcbiAgICAgIGNvbnN0IHVzZXJJbnRlcmFjdGlvbnMgPSBhd2FpdCB0aGlzLmdldFVzZXJJbnRlcmFjdGlvbnModXNlcklkKTtcclxuICAgICAgaWYgKHVzZXJJbnRlcmFjdGlvbnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBHZXQgYWxsIG90aGVyIHVzZXJzIHdobyBoYXZlIGludGVyYWN0ZWQgd2l0aCBzaW1pbGFyIGNvbnRlbnRcclxuICAgICAgY29uc3QgY291cnNlSWRzID0gdXNlckludGVyYWN0aW9ucy5tYXAoaSA9PiBpLmNvdXJzZUlkKS5maWx0ZXIoQm9vbGVhbik7XHJcbiAgICAgIGNvbnN0IG90aGVyVXNlcnMgPSBhd2FpdCB0aGlzLmludGVyYWN0aW9uUmVwb3NpdG9yeVxyXG4gICAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoJ2ludGVyYWN0aW9uJylcclxuICAgICAgICAuc2VsZWN0KCdESVNUSU5DVCBpbnRlcmFjdGlvbi51c2VySWQnKVxyXG4gICAgICAgIC53aGVyZSgnaW50ZXJhY3Rpb24uY291cnNlSWQgSU4gKDouLi5jb3Vyc2VJZHMpJywgeyBjb3Vyc2VJZHMgfSlcclxuICAgICAgICAuYW5kV2hlcmUoJ2ludGVyYWN0aW9uLnVzZXJJZCAhPSA6dXNlcklkJywgeyB1c2VySWQgfSlcclxuICAgICAgICAuZ2V0UmF3TWFueSgpO1xyXG5cclxuICAgICAgLy8gQ2FsY3VsYXRlIHNpbWlsYXJpdHkgd2l0aCBlYWNoIHVzZXJcclxuICAgICAgY29uc3Qgc2ltaWxhcml0aWVzOiBVc2VyU2ltaWxhcml0eVtdID0gW107XHJcbiAgICAgIFxyXG4gICAgICBmb3IgKGNvbnN0IHsgdXNlcklkOiBvdGhlclVzZXJJZCB9IG9mIG90aGVyVXNlcnMpIHtcclxuICAgICAgICBjb25zdCBvdGhlckludGVyYWN0aW9ucyA9IGF3YWl0IHRoaXMuZ2V0VXNlckludGVyYWN0aW9ucyhvdGhlclVzZXJJZCk7XHJcbiAgICAgICAgY29uc3Qgc2ltaWxhcml0eSA9IHRoaXMuY2FsY3VsYXRlVXNlclNpbWlsYXJpdHkodXNlckludGVyYWN0aW9ucywgb3RoZXJJbnRlcmFjdGlvbnMpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChzaW1pbGFyaXR5LnNpbWlsYXJpdHkgPiAwLjEpIHsgLy8gT25seSBpbmNsdWRlIHVzZXJzIHdpdGggbWVhbmluZ2Z1bCBzaW1pbGFyaXR5XHJcbiAgICAgICAgICBzaW1pbGFyaXRpZXMucHVzaCh7XHJcbiAgICAgICAgICAgIHVzZXJJZDogb3RoZXJVc2VySWQsXHJcbiAgICAgICAgICAgIHNpbWlsYXJpdHk6IHNpbWlsYXJpdHkuc2ltaWxhcml0eSxcclxuICAgICAgICAgICAgY29tbW9uSW50ZXJhY3Rpb25zOiBzaW1pbGFyaXR5LmNvbW1vbkludGVyYWN0aW9ucyxcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gU29ydCBieSBzaW1pbGFyaXR5IGFuZCBjYWNoZVxyXG4gICAgICBzaW1pbGFyaXRpZXMuc29ydCgoYSwgYikgPT4gYi5zaW1pbGFyaXR5IC0gYS5zaW1pbGFyaXR5KTtcclxuICAgICAgdGhpcy51c2VyU2ltaWxhcml0eUNhY2hlLnNldChjYWNoZUtleSwgc2ltaWxhcml0aWVzKTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiBzaW1pbGFyaXRpZXMuc2xpY2UoMCwgbGltaXQpO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBFcnJvciBmaW5kaW5nIHNpbWlsYXIgdXNlcnMgZm9yICR7dXNlcklkfTpgLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZpbmQgc2ltaWxhciBpdGVtcyAoY291cnNlcykgYmFzZWQgb24gdXNlciBpbnRlcmFjdGlvbiBwYXR0ZXJuc1xyXG4gICAqL1xyXG4gIGFzeW5jIGZpbmRTaW1pbGFySXRlbXMoY291cnNlSWQ6IHN0cmluZywgbGltaXQ6IG51bWJlciA9IDIwKTogUHJvbWlzZTxJdGVtU2ltaWxhcml0eVtdPiB7XHJcbiAgICAvLyBDaGVjayBjYWNoZSBmaXJzdFxyXG4gICAgY29uc3QgY2FjaGVLZXkgPSBgaXRlbV8ke2NvdXJzZUlkfWA7XHJcbiAgICBjb25zdCBjYWNoZWQgPSB0aGlzLml0ZW1TaW1pbGFyaXR5Q2FjaGUuZ2V0KGNhY2hlS2V5KTtcclxuICAgIGlmIChjYWNoZWQgJiYgdGhpcy5pc0NhY2hlVmFsaWQoY2FjaGVLZXkpKSB7XHJcbiAgICAgIHJldHVybiBjYWNoZWQuc2xpY2UoMCwgbGltaXQpO1xyXG4gICAgfVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIEdldCB1c2VycyB3aG8gaW50ZXJhY3RlZCB3aXRoIHRoaXMgY291cnNlXHJcbiAgICAgIGNvbnN0IGNvdXJzZVVzZXJzID0gYXdhaXQgdGhpcy5pbnRlcmFjdGlvblJlcG9zaXRvcnkuZmluZCh7XHJcbiAgICAgICAgd2hlcmU6IHsgY291cnNlSWQgfSxcclxuICAgICAgICBzZWxlY3Q6IFsndXNlcklkJ10sXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKGNvdXJzZVVzZXJzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHJldHVybiBbXTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgdXNlcklkcyA9IGNvdXJzZVVzZXJzLm1hcCh1ID0+IHUudXNlcklkKTtcclxuXHJcbiAgICAgIC8vIEdldCBvdGhlciBjb3Vyc2VzIHRoZXNlIHVzZXJzIGludGVyYWN0ZWQgd2l0aFxyXG4gICAgICBjb25zdCBvdGhlckNvdXJzZXMgPSBhd2FpdCB0aGlzLmludGVyYWN0aW9uUmVwb3NpdG9yeVxyXG4gICAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoJ2ludGVyYWN0aW9uJylcclxuICAgICAgICAuc2VsZWN0KCdESVNUSU5DVCBpbnRlcmFjdGlvbi5jb3Vyc2VJZCcpXHJcbiAgICAgICAgLndoZXJlKCdpbnRlcmFjdGlvbi51c2VySWQgSU4gKDouLi51c2VySWRzKScsIHsgdXNlcklkcyB9KVxyXG4gICAgICAgIC5hbmRXaGVyZSgnaW50ZXJhY3Rpb24uY291cnNlSWQgIT0gOmNvdXJzZUlkJywgeyBjb3Vyc2VJZCB9KVxyXG4gICAgICAgIC5nZXRSYXdNYW55KCk7XHJcblxyXG4gICAgICAvLyBDYWxjdWxhdGUgc2ltaWxhcml0eSB3aXRoIGVhY2ggY291cnNlXHJcbiAgICAgIGNvbnN0IHNpbWlsYXJpdGllczogSXRlbVNpbWlsYXJpdHlbXSA9IFtdO1xyXG4gICAgICBcclxuICAgICAgZm9yIChjb25zdCB7IGNvdXJzZUlkOiBvdGhlckNvdXJzZUlkIH0gb2Ygb3RoZXJDb3Vyc2VzKSB7XHJcbiAgICAgICAgY29uc3Qgb3RoZXJDb3Vyc2VVc2VycyA9IGF3YWl0IHRoaXMuaW50ZXJhY3Rpb25SZXBvc2l0b3J5LmZpbmQoe1xyXG4gICAgICAgICAgd2hlcmU6IHsgY291cnNlSWQ6IG90aGVyQ291cnNlSWQgfSxcclxuICAgICAgICAgIHNlbGVjdDogWyd1c2VySWQnXSxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3Qgc2ltaWxhcml0eSA9IHRoaXMuY2FsY3VsYXRlSXRlbVNpbWlsYXJpdHkoXHJcbiAgICAgICAgICB1c2VySWRzLFxyXG4gICAgICAgICAgb3RoZXJDb3Vyc2VVc2Vycy5tYXAodSA9PiB1LnVzZXJJZClcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBpZiAoc2ltaWxhcml0eS5zaW1pbGFyaXR5ID4gMC4xKSB7XHJcbiAgICAgICAgICBzaW1pbGFyaXRpZXMucHVzaCh7XHJcbiAgICAgICAgICAgIGNvdXJzZUlkOiBvdGhlckNvdXJzZUlkLFxyXG4gICAgICAgICAgICBzaW1pbGFyaXR5OiBzaW1pbGFyaXR5LnNpbWlsYXJpdHksXHJcbiAgICAgICAgICAgIGNvbW1vblVzZXJzOiBzaW1pbGFyaXR5LmNvbW1vblVzZXJzLFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBTb3J0IGJ5IHNpbWlsYXJpdHkgYW5kIGNhY2hlXHJcbiAgICAgIHNpbWlsYXJpdGllcy5zb3J0KChhLCBiKSA9PiBiLnNpbWlsYXJpdHkgLSBhLnNpbWlsYXJpdHkpO1xyXG4gICAgICB0aGlzLml0ZW1TaW1pbGFyaXR5Q2FjaGUuc2V0KGNhY2hlS2V5LCBzaW1pbGFyaXRpZXMpO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHNpbWlsYXJpdGllcy5zbGljZSgwLCBsaW1pdCk7XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm9yIGZpbmRpbmcgc2ltaWxhciBpdGVtcyBmb3IgJHtjb3Vyc2VJZH06YCwgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdXNlci1iYXNlZCBjb2xsYWJvcmF0aXZlIGZpbHRlcmluZyByZWNvbW1lbmRhdGlvbnNcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIGdldFVzZXJCYXNlZFJlY29tbWVuZGF0aW9ucyhcclxuICAgIGNvbnRleHQ6IFJlY29tbWVuZGF0aW9uQ29udGV4dCxcclxuICAgIGxpbWl0OiBudW1iZXIsXHJcbiAgKTogUHJvbWlzZTxDb2xsYWJvcmF0aXZlUmVjb21tZW5kYXRpb25bXT4ge1xyXG4gICAgLy8gRmluZCBzaW1pbGFyIHVzZXJzXHJcbiAgICBjb25zdCBzaW1pbGFyVXNlcnMgPSBhd2FpdCB0aGlzLmZpbmRTaW1pbGFyVXNlcnMoY29udGV4dC51c2VySWQsIDUwKTtcclxuICAgIFxyXG4gICAgaWYgKHNpbWlsYXJVc2Vycy5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdldCBjb3Vyc2VzIHRoYXQgc2ltaWxhciB1c2VycyBsaWtlZCBidXQgY3VycmVudCB1c2VyIGhhc24ndCBpbnRlcmFjdGVkIHdpdGhcclxuICAgIGNvbnN0IHVzZXJDb3Vyc2VJZHMgPSBuZXcgU2V0KFxyXG4gICAgICBjb250ZXh0LnJlY2VudEludGVyYWN0aW9ucz8ubWFwKGkgPT4gaS5jb3Vyc2VJZCkuZmlsdGVyKEJvb2xlYW4pIHx8IFtdXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IG5ldyBNYXA8c3RyaW5nLCB7XHJcbiAgICAgIHNjb3JlOiBudW1iZXI7XHJcbiAgICAgIGNvdW50OiBudW1iZXI7XHJcbiAgICAgIHNpbWlsYXJVc2Vyczogc3RyaW5nW107XHJcbiAgICB9PigpO1xyXG5cclxuICAgIGZvciAoY29uc3Qgc2ltaWxhclVzZXIgb2Ygc2ltaWxhclVzZXJzLnNsaWNlKDAsIDIwKSkgeyAvLyBUb3AgMjAgc2ltaWxhciB1c2Vyc1xyXG4gICAgICBjb25zdCBzaW1pbGFyVXNlckludGVyYWN0aW9ucyA9IGF3YWl0IHRoaXMuZ2V0VXNlckludGVyYWN0aW9ucyhzaW1pbGFyVXNlci51c2VySWQpO1xyXG4gICAgICBcclxuICAgICAgLy8gRmluZCBoaWdobHkgcmF0ZWQgaW50ZXJhY3Rpb25zIGZyb20gc2ltaWxhciB1c2Vyc1xyXG4gICAgICBjb25zdCBwb3NpdGl2ZUludGVyYWN0aW9ucyA9IHNpbWlsYXJVc2VySW50ZXJhY3Rpb25zLmZpbHRlcihpbnRlcmFjdGlvbiA9PlxyXG4gICAgICAgIHRoaXMuaXNQb3NpdGl2ZUludGVyYWN0aW9uKGludGVyYWN0aW9uKSAmJiBcclxuICAgICAgICAhdXNlckNvdXJzZUlkcy5oYXMoaW50ZXJhY3Rpb24uY291cnNlSWQpXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBmb3IgKGNvbnN0IGludGVyYWN0aW9uIG9mIHBvc2l0aXZlSW50ZXJhY3Rpb25zKSB7XHJcbiAgICAgICAgaWYgKCFpbnRlcmFjdGlvbi5jb3Vyc2VJZCkgY29udGludWU7XHJcblxyXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gcmVjb21tZW5kYXRpb25zLmdldChpbnRlcmFjdGlvbi5jb3Vyc2VJZCkgfHwge1xyXG4gICAgICAgICAgc2NvcmU6IDAsXHJcbiAgICAgICAgICBjb3VudDogMCxcclxuICAgICAgICAgIHNpbWlsYXJVc2VyczogW10sXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gV2VpZ2h0IGJ5IHVzZXIgc2ltaWxhcml0eSBhbmQgaW50ZXJhY3Rpb24gc3RyZW5ndGhcclxuICAgICAgICBjb25zdCBpbnRlcmFjdGlvbldlaWdodCA9IHRoaXMuZ2V0SW50ZXJhY3Rpb25XZWlnaHQoaW50ZXJhY3Rpb24pO1xyXG4gICAgICAgIGNvbnN0IHdlaWdodGVkU2NvcmUgPSBzaW1pbGFyVXNlci5zaW1pbGFyaXR5ICogaW50ZXJhY3Rpb25XZWlnaHQ7XHJcblxyXG4gICAgICAgIGV4aXN0aW5nLnNjb3JlICs9IHdlaWdodGVkU2NvcmU7XHJcbiAgICAgICAgZXhpc3RpbmcuY291bnQgKz0gMTtcclxuICAgICAgICBleGlzdGluZy5zaW1pbGFyVXNlcnMucHVzaChzaW1pbGFyVXNlci51c2VySWQpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5zZXQoaW50ZXJhY3Rpb24uY291cnNlSWQsIGV4aXN0aW5nKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIENvbnZlcnQgdG8gcmVjb21tZW5kYXRpb24gZm9ybWF0IGFuZCBzb3J0XHJcbiAgICBjb25zdCByZXN1bHQ6IENvbGxhYm9yYXRpdmVSZWNvbW1lbmRhdGlvbltdID0gW107XHJcbiAgICBcclxuICAgIGZvciAoY29uc3QgW2NvdXJzZUlkLCBkYXRhXSBvZiByZWNvbW1lbmRhdGlvbnMuZW50cmllcygpKSB7XHJcbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWRTY29yZSA9IGRhdGEuc2NvcmUgLyBNYXRoLm1heChkYXRhLmNvdW50LCAxKTtcclxuICAgICAgXHJcbiAgICAgIHJlc3VsdC5wdXNoKHtcclxuICAgICAgICBjb3Vyc2VJZCxcclxuICAgICAgICBzY29yZTogbm9ybWFsaXplZFNjb3JlLFxyXG4gICAgICAgIHJlYXNvbjogYFJlY29tbWVuZGVkIGJ5ICR7ZGF0YS5jb3VudH0gc2ltaWxhciBsZWFybmVyc2AsXHJcbiAgICAgICAgc2ltaWxhclVzZXJzOiBkYXRhLnNpbWlsYXJVc2Vycy5zbGljZSgwLCA1KSxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgICAuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpXHJcbiAgICAgIC5zbGljZSgwLCBsaW1pdCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgaXRlbS1iYXNlZCBjb2xsYWJvcmF0aXZlIGZpbHRlcmluZyByZWNvbW1lbmRhdGlvbnNcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIGdldEl0ZW1CYXNlZFJlY29tbWVuZGF0aW9ucyhcclxuICAgIGNvbnRleHQ6IFJlY29tbWVuZGF0aW9uQ29udGV4dCxcclxuICAgIGxpbWl0OiBudW1iZXIsXHJcbiAgKTogUHJvbWlzZTxDb2xsYWJvcmF0aXZlUmVjb21tZW5kYXRpb25bXT4ge1xyXG4gICAgLy8gR2V0IGNvdXJzZXMgdXNlciBoYXMgcG9zaXRpdmVseSBpbnRlcmFjdGVkIHdpdGhcclxuICAgIGNvbnN0IHVzZXJJbnRlcmFjdGlvbnMgPSBjb250ZXh0LnJlY2VudEludGVyYWN0aW9ucyB8fCBbXTtcclxuICAgIGNvbnN0IHBvc2l0aXZlQ291cnNlcyA9IHVzZXJJbnRlcmFjdGlvbnNcclxuICAgICAgLmZpbHRlcihpID0+IHRoaXMuaXNQb3NpdGl2ZUludGVyYWN0aW9uKGkpICYmIGkuY291cnNlSWQpXHJcbiAgICAgIC5tYXAoaSA9PiBpLmNvdXJzZUlkISlcclxuICAgICAgLnNsaWNlKDAsIDEwKTsgLy8gQ29uc2lkZXIgdG9wIDEwIGNvdXJzZXNcclxuXHJcbiAgICBpZiAocG9zaXRpdmVDb3Vyc2VzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zID0gbmV3IE1hcDxzdHJpbmcsIHtcclxuICAgICAgc2NvcmU6IG51bWJlcjtcclxuICAgICAgY291bnQ6IG51bWJlcjtcclxuICAgICAgc2ltaWxhckl0ZW1zOiBzdHJpbmdbXTtcclxuICAgIH0+KCk7XHJcblxyXG4gICAgLy8gRm9yIGVhY2ggY291cnNlIHVzZXIgbGlrZWQsIGZpbmQgc2ltaWxhciBjb3Vyc2VzXHJcbiAgICBmb3IgKGNvbnN0IGNvdXJzZUlkIG9mIHBvc2l0aXZlQ291cnNlcykge1xyXG4gICAgICBjb25zdCBzaW1pbGFySXRlbXMgPSBhd2FpdCB0aGlzLmZpbmRTaW1pbGFySXRlbXMoY291cnNlSWQsIDIwKTtcclxuICAgICAgXHJcbiAgICAgIGZvciAoY29uc3Qgc2ltaWxhckl0ZW0gb2Ygc2ltaWxhckl0ZW1zKSB7XHJcbiAgICAgICAgLy8gU2tpcCBpZiB1c2VyIGFscmVhZHkgaW50ZXJhY3RlZCB3aXRoIHRoaXMgY291cnNlXHJcbiAgICAgICAgaWYgKHBvc2l0aXZlQ291cnNlcy5pbmNsdWRlcyhzaW1pbGFySXRlbS5jb3Vyc2VJZCkpIGNvbnRpbnVlO1xyXG5cclxuICAgICAgICBjb25zdCBleGlzdGluZyA9IHJlY29tbWVuZGF0aW9ucy5nZXQoc2ltaWxhckl0ZW0uY291cnNlSWQpIHx8IHtcclxuICAgICAgICAgIHNjb3JlOiAwLFxyXG4gICAgICAgICAgY291bnQ6IDAsXHJcbiAgICAgICAgICBzaW1pbGFySXRlbXM6IFtdLFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGV4aXN0aW5nLnNjb3JlICs9IHNpbWlsYXJJdGVtLnNpbWlsYXJpdHk7XHJcbiAgICAgICAgZXhpc3RpbmcuY291bnQgKz0gMTtcclxuICAgICAgICBleGlzdGluZy5zaW1pbGFySXRlbXMucHVzaChjb3Vyc2VJZCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLnNldChzaW1pbGFySXRlbS5jb3Vyc2VJZCwgZXhpc3RpbmcpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ29udmVydCB0byByZWNvbW1lbmRhdGlvbiBmb3JtYXQgYW5kIHNvcnRcclxuICAgIGNvbnN0IHJlc3VsdDogQ29sbGFib3JhdGl2ZVJlY29tbWVuZGF0aW9uW10gPSBbXTtcclxuICAgIFxyXG4gICAgZm9yIChjb25zdCBbY291cnNlSWQsIGRhdGFdIG9mIHJlY29tbWVuZGF0aW9ucy5lbnRyaWVzKCkpIHtcclxuICAgICAgY29uc3Qgbm9ybWFsaXplZFNjb3JlID0gZGF0YS5zY29yZSAvIE1hdGgubWF4KGRhdGEuY291bnQsIDEpO1xyXG4gICAgICBcclxuICAgICAgcmVzdWx0LnB1c2goe1xyXG4gICAgICAgIGNvdXJzZUlkLFxyXG4gICAgICAgIHNjb3JlOiBub3JtYWxpemVkU2NvcmUsXHJcbiAgICAgICAgcmVhc29uOiBgU2ltaWxhciB0byAke2RhdGEuY291bnR9IGNvdXJzZXMgeW91J3ZlIGVuZ2FnZWQgd2l0aGAsXHJcbiAgICAgICAgc2ltaWxhckl0ZW1zOiBkYXRhLnNpbWlsYXJJdGVtcy5zbGljZSgwLCAzKSxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdFxyXG4gICAgICAuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpXHJcbiAgICAgIC5zbGljZSgwLCBsaW1pdCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdXNlciBpbnRlcmFjdGlvbnMgd2l0aCB3ZWlnaHRlZCB2YWx1ZXNcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIGdldFVzZXJJbnRlcmFjdGlvbnModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJJbnRlcmFjdGlvbltdPiB7XHJcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5pbnRlcmFjdGlvblJlcG9zaXRvcnkuZmluZCh7XHJcbiAgICAgIHdoZXJlOiB7IHVzZXJJZCB9LFxyXG4gICAgICBvcmRlcjogeyBjcmVhdGVkQXQ6ICdERVNDJyB9LFxyXG4gICAgICB0YWtlOiA1MDAsIC8vIExpbWl0IGZvciBwZXJmb3JtYW5jZVxyXG4gICAgICByZWxhdGlvbnM6IFsnY291cnNlJ10sXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENhbGN1bGF0ZSBzaW1pbGFyaXR5IGJldHdlZW4gdHdvIHVzZXJzIGJhc2VkIG9uIHRoZWlyIGludGVyYWN0aW9uc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgY2FsY3VsYXRlVXNlclNpbWlsYXJpdHkoXHJcbiAgICB1c2VyMUludGVyYWN0aW9uczogVXNlckludGVyYWN0aW9uW10sXHJcbiAgICB1c2VyMkludGVyYWN0aW9uczogVXNlckludGVyYWN0aW9uW10sXHJcbiAgKTogeyBzaW1pbGFyaXR5OiBudW1iZXI7IGNvbW1vbkludGVyYWN0aW9uczogbnVtYmVyIH0ge1xyXG4gICAgLy8gQ3JlYXRlIG1hcHMgb2YgY291cnNlIGludGVyYWN0aW9ucyBmb3IgZWFjaCB1c2VyXHJcbiAgICBjb25zdCB1c2VyMUNvdXJzZXMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xyXG4gICAgY29uc3QgdXNlcjJDb3Vyc2VzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcclxuXHJcbiAgICAvLyBCdWlsZCB3ZWlnaHRlZCBpbnRlcmFjdGlvbiBtYXBzXHJcbiAgICB1c2VyMUludGVyYWN0aW9ucy5mb3JFYWNoKGludGVyYWN0aW9uID0+IHtcclxuICAgICAgaWYgKGludGVyYWN0aW9uLmNvdXJzZUlkKSB7XHJcbiAgICAgICAgY29uc3Qgd2VpZ2h0ID0gdGhpcy5nZXRJbnRlcmFjdGlvbldlaWdodChpbnRlcmFjdGlvbik7XHJcbiAgICAgICAgdXNlcjFDb3Vyc2VzLnNldChcclxuICAgICAgICAgIGludGVyYWN0aW9uLmNvdXJzZUlkLFxyXG4gICAgICAgICAgKHVzZXIxQ291cnNlcy5nZXQoaW50ZXJhY3Rpb24uY291cnNlSWQpIHx8IDApICsgd2VpZ2h0XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdXNlcjJJbnRlcmFjdGlvbnMuZm9yRWFjaChpbnRlcmFjdGlvbiA9PiB7XHJcbiAgICAgIGlmIChpbnRlcmFjdGlvbi5jb3Vyc2VJZCkge1xyXG4gICAgICAgIGNvbnN0IHdlaWdodCA9IHRoaXMuZ2V0SW50ZXJhY3Rpb25XZWlnaHQoaW50ZXJhY3Rpb24pO1xyXG4gICAgICAgIHVzZXIyQ291cnNlcy5zZXQoXHJcbiAgICAgICAgICBpbnRlcmFjdGlvbi5jb3Vyc2VJZCxcclxuICAgICAgICAgICh1c2VyMkNvdXJzZXMuZ2V0KGludGVyYWN0aW9uLmNvdXJzZUlkKSB8fCAwKSArIHdlaWdodFxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEZpbmQgY29tbW9uIGNvdXJzZXNcclxuICAgIGNvbnN0IGNvbW1vbkNvdXJzZXMgPSBuZXcgU2V0KFsuLi51c2VyMUNvdXJzZXMua2V5cygpXS5maWx0ZXIoY291cnNlSWQgPT4gXHJcbiAgICAgIHVzZXIyQ291cnNlcy5oYXMoY291cnNlSWQpXHJcbiAgICApKTtcclxuXHJcbiAgICBpZiAoY29tbW9uQ291cnNlcy5zaXplID09PSAwKSB7XHJcbiAgICAgIHJldHVybiB7IHNpbWlsYXJpdHk6IDAsIGNvbW1vbkludGVyYWN0aW9uczogMCB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENhbGN1bGF0ZSBjb3NpbmUgc2ltaWxhcml0eVxyXG4gICAgbGV0IGRvdFByb2R1Y3QgPSAwO1xyXG4gICAgbGV0IG5vcm0xID0gMDtcclxuICAgIGxldCBub3JtMiA9IDA7XHJcblxyXG4gICAgLy8gQ2FsY3VsYXRlIGZvciBhbGwgY291cnNlcyAobm90IGp1c3QgY29tbW9uIG9uZXMpXHJcbiAgICBjb25zdCBhbGxDb3Vyc2VzID0gbmV3IFNldChbLi4udXNlcjFDb3Vyc2VzLmtleXMoKSwgLi4udXNlcjJDb3Vyc2VzLmtleXMoKV0pO1xyXG4gICAgXHJcbiAgICBmb3IgKGNvbnN0IGNvdXJzZUlkIG9mIGFsbENvdXJzZXMpIHtcclxuICAgICAgY29uc3QgcmF0aW5nMSA9IHVzZXIxQ291cnNlcy5nZXQoY291cnNlSWQpIHx8IDA7XHJcbiAgICAgIGNvbnN0IHJhdGluZzIgPSB1c2VyMkNvdXJzZXMuZ2V0KGNvdXJzZUlkKSB8fCAwO1xyXG4gICAgICBcclxuICAgICAgZG90UHJvZHVjdCArPSByYXRpbmcxICogcmF0aW5nMjtcclxuICAgICAgbm9ybTEgKz0gcmF0aW5nMSAqIHJhdGluZzE7XHJcbiAgICAgIG5vcm0yICs9IHJhdGluZzIgKiByYXRpbmcyO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHNpbWlsYXJpdHkgPSAobm9ybTEgPiAwICYmIG5vcm0yID4gMCkgXHJcbiAgICAgID8gZG90UHJvZHVjdCAvIChNYXRoLnNxcnQobm9ybTEpICogTWF0aC5zcXJ0KG5vcm0yKSlcclxuICAgICAgOiAwO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHNpbWlsYXJpdHk6IE1hdGgubWF4KDAsIE1hdGgubWluKDEsIHNpbWlsYXJpdHkpKSxcclxuICAgICAgY29tbW9uSW50ZXJhY3Rpb25zOiBjb21tb25Db3Vyc2VzLnNpemUsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2FsY3VsYXRlIHNpbWlsYXJpdHkgYmV0d2VlbiB0d28gaXRlbXMgYmFzZWQgb24gdXNlciBpbnRlcmFjdGlvbnNcclxuICAgKi9cclxuICBwcml2YXRlIGNhbGN1bGF0ZUl0ZW1TaW1pbGFyaXR5KFxyXG4gICAgaXRlbTFVc2Vyczogc3RyaW5nW10sXHJcbiAgICBpdGVtMlVzZXJzOiBzdHJpbmdbXSxcclxuICApOiB7IHNpbWlsYXJpdHk6IG51bWJlcjsgY29tbW9uVXNlcnM6IG51bWJlciB9IHtcclxuICAgIGNvbnN0IHVzZXJzMVNldCA9IG5ldyBTZXQoaXRlbTFVc2Vycyk7XHJcbiAgICBjb25zdCB1c2VyczJTZXQgPSBuZXcgU2V0KGl0ZW0yVXNlcnMpO1xyXG4gICAgXHJcbiAgICAvLyBDYWxjdWxhdGUgSmFjY2FyZCBzaW1pbGFyaXR5XHJcbiAgICBjb25zdCBpbnRlcnNlY3Rpb24gPSBuZXcgU2V0KFsuLi51c2VyczFTZXRdLmZpbHRlcih1c2VySWQgPT4gdXNlcnMyU2V0Lmhhcyh1c2VySWQpKSk7XHJcbiAgICBjb25zdCB1bmlvbiA9IG5ldyBTZXQoWy4uLnVzZXJzMVNldCwgLi4udXNlcnMyU2V0XSk7XHJcbiAgICBcclxuICAgIGNvbnN0IHNpbWlsYXJpdHkgPSB1bmlvbi5zaXplID4gMCA/IGludGVyc2VjdGlvbi5zaXplIC8gdW5pb24uc2l6ZSA6IDA7XHJcbiAgICBcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHNpbWlsYXJpdHksXHJcbiAgICAgIGNvbW1vblVzZXJzOiBpbnRlcnNlY3Rpb24uc2l6ZSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgd2VpZ2h0IGZvciBkaWZmZXJlbnQgaW50ZXJhY3Rpb24gdHlwZXNcclxuICAgKi9cclxuICBwcml2YXRlIGdldEludGVyYWN0aW9uV2VpZ2h0KGludGVyYWN0aW9uOiBVc2VySW50ZXJhY3Rpb24pOiBudW1iZXIge1xyXG4gICAgY29uc3Qgd2VpZ2h0cyA9IHtcclxuICAgICAgW0ludGVyYWN0aW9uVHlwZS5WSUVXXTogMC4xLFxyXG4gICAgICBbSW50ZXJhY3Rpb25UeXBlLkNMSUNLXTogMC4yLFxyXG4gICAgICBbSW50ZXJhY3Rpb25UeXBlLkVOUk9MTF06IDAuOCxcclxuICAgICAgW0ludGVyYWN0aW9uVHlwZS5TVEFSVF06IDAuNixcclxuICAgICAgW0ludGVyYWN0aW9uVHlwZS5QUk9HUkVTU106IDAuNyxcclxuICAgICAgW0ludGVyYWN0aW9uVHlwZS5DT01QTEVURV06IDEuMCxcclxuICAgICAgW0ludGVyYWN0aW9uVHlwZS5SQVRFXTogMC45LFxyXG4gICAgICBbSW50ZXJhY3Rpb25UeXBlLkJPT0tNQVJLXTogMC41LFxyXG4gICAgICBbSW50ZXJhY3Rpb25UeXBlLlNIQVJFXTogMC40LFxyXG4gICAgICBbSW50ZXJhY3Rpb25UeXBlLkRPV05MT0FEXTogMC4zLFxyXG4gICAgfTtcclxuXHJcbiAgICBsZXQgYmFzZVdlaWdodCA9IHdlaWdodHNbaW50ZXJhY3Rpb24uaW50ZXJhY3Rpb25UeXBlXSB8fCAwLjE7XHJcbiAgICBcclxuICAgIC8vIEFwcGx5IGFkZGl0aW9uYWwgd2VpZ2h0aW5nIGJhc2VkIG9uIGludGVyYWN0aW9uIG1ldGFkYXRhXHJcbiAgICBpZiAoaW50ZXJhY3Rpb24ud2VpZ2h0ZWRWYWx1ZSkge1xyXG4gICAgICBiYXNlV2VpZ2h0ICo9IGludGVyYWN0aW9uLndlaWdodGVkVmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIE1hdGgubWF4KDAsIE1hdGgubWluKDEsIGJhc2VXZWlnaHQpKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrIGlmIGludGVyYWN0aW9uIGlzIHBvc2l0aXZlIChpbmRpY2F0ZXMgdXNlciBpbnRlcmVzdC9zYXRpc2ZhY3Rpb24pXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc1Bvc2l0aXZlSW50ZXJhY3Rpb24oaW50ZXJhY3Rpb246IFVzZXJJbnRlcmFjdGlvbik6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgcG9zaXRpdmVUeXBlcyA9IFtcclxuICAgICAgSW50ZXJhY3Rpb25UeXBlLkVOUk9MTCxcclxuICAgICAgSW50ZXJhY3Rpb25UeXBlLkNPTVBMRVRFLFxyXG4gICAgICBJbnRlcmFjdGlvblR5cGUuUkFURSxcclxuICAgICAgSW50ZXJhY3Rpb25UeXBlLkJPT0tNQVJLLFxyXG4gICAgICBJbnRlcmFjdGlvblR5cGUuU0hBUkUsXHJcbiAgICAgIEludGVyYWN0aW9uVHlwZS5QUk9HUkVTUyxcclxuICAgIF07XHJcblxyXG4gICAgcmV0dXJuIHBvc2l0aXZlVHlwZXMuaW5jbHVkZXMoaW50ZXJhY3Rpb24uaW50ZXJhY3Rpb25UeXBlKSB8fFxyXG4gICAgICAgICAgIChpbnRlcmFjdGlvbi53ZWlnaHRlZFZhbHVlICYmIGludGVyYWN0aW9uLndlaWdodGVkVmFsdWUgPiAwLjUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmFuayBjb2xsYWJvcmF0aXZlIHJlY29tbWVuZGF0aW9ucyBieSBjb21iaW5pbmcgc2NvcmVzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByYW5rQ29sbGFib3JhdGl2ZVJlY29tbWVuZGF0aW9ucyhcclxuICAgIHJlY29tbWVuZGF0aW9uczogQ29sbGFib3JhdGl2ZVJlY29tbWVuZGF0aW9uW10sXHJcbiAgKTogQ29sbGFib3JhdGl2ZVJlY29tbWVuZGF0aW9uW10ge1xyXG4gICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgYW5kIGNvbWJpbmUgc2NvcmVzXHJcbiAgICBjb25zdCBjb21iaW5lZCA9IG5ldyBNYXA8c3RyaW5nLCBDb2xsYWJvcmF0aXZlUmVjb21tZW5kYXRpb24+KCk7XHJcbiAgICBcclxuICAgIHJlY29tbWVuZGF0aW9ucy5mb3JFYWNoKHJlYyA9PiB7XHJcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gY29tYmluZWQuZ2V0KHJlYy5jb3Vyc2VJZCk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoZXhpc3RpbmcpIHtcclxuICAgICAgICAvLyBDb21iaW5lIHNjb3JlcyB1c2luZyB3ZWlnaHRlZCBhdmVyYWdlXHJcbiAgICAgICAgZXhpc3Rpbmcuc2NvcmUgPSAoZXhpc3Rpbmcuc2NvcmUgKyByZWMuc2NvcmUpIC8gMjtcclxuICAgICAgICBleGlzdGluZy5yZWFzb24gPSBgJHtleGlzdGluZy5yZWFzb259IGFuZCAke3JlYy5yZWFzb259YDtcclxuICAgICAgICBcclxuICAgICAgICBpZiAocmVjLnNpbWlsYXJVc2Vycykge1xyXG4gICAgICAgICAgZXhpc3Rpbmcuc2ltaWxhclVzZXJzID0gWy4uLihleGlzdGluZy5zaW1pbGFyVXNlcnMgfHwgW10pLCAuLi5yZWMuc2ltaWxhclVzZXJzXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJlYy5zaW1pbGFySXRlbXMpIHtcclxuICAgICAgICAgIGV4aXN0aW5nLnNpbWlsYXJJdGVtcyA9IFsuLi4oZXhpc3Rpbmcuc2ltaWxhckl0ZW1zIHx8IFtdKSwgLi4ucmVjLnNpbWlsYXJJdGVtc107XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbWJpbmVkLnNldChyZWMuY291cnNlSWQsIHsgLi4ucmVjIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbShjb21iaW5lZC52YWx1ZXMoKSkuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIHJlY29tbWVuZGF0aW9uIGZyb20gY29sbGFib3JhdGl2ZSByZWNvbW1lbmRhdGlvblxyXG4gICAqL1xyXG4gIHByaXZhdGUgY3JlYXRlUmVjb21tZW5kYXRpb24oXHJcbiAgICBjb2xhYlJlYzogQ29sbGFib3JhdGl2ZVJlY29tbWVuZGF0aW9uLFxyXG4gICAgY29udGV4dDogUmVjb21tZW5kYXRpb25Db250ZXh0LFxyXG4gICk6IFBhcnRpYWw8UmVjb21tZW5kYXRpb24+IHtcclxuICAgIGNvbnN0IGhhc1VzZXJCYXNlZCA9IGNvbGFiUmVjLnNpbWlsYXJVc2VycyAmJiBjb2xhYlJlYy5zaW1pbGFyVXNlcnMubGVuZ3RoID4gMDtcclxuICAgIGNvbnN0IGhhc0l0ZW1CYXNlZCA9IGNvbGFiUmVjLnNpbWlsYXJJdGVtcyAmJiBjb2xhYlJlYy5zaW1pbGFySXRlbXMubGVuZ3RoID4gMDtcclxuICAgIFxyXG4gICAgbGV0IHJlYXNvbjogUmVjb21tZW5kYXRpb25SZWFzb247XHJcbiAgICBpZiAoaGFzVXNlckJhc2VkICYmIGhhc0l0ZW1CYXNlZCkge1xyXG4gICAgICByZWFzb24gPSBSZWNvbW1lbmRhdGlvblJlYXNvbi5DT0xMQUJPUkFUSVZFX0ZJTFRFUklORztcclxuICAgIH0gZWxzZSBpZiAoaGFzVXNlckJhc2VkKSB7XHJcbiAgICAgIHJlYXNvbiA9IFJlY29tbWVuZGF0aW9uUmVhc29uLlNJTUlMQVJfVVNFUlM7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZWFzb24gPSBSZWNvbW1lbmRhdGlvblJlYXNvbi5TSU1JTEFSX0NPTlRFTlQ7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdXNlcklkOiBjb250ZXh0LnVzZXJJZCxcclxuICAgICAgY291cnNlSWQ6IGNvbGFiUmVjLmNvdXJzZUlkLFxyXG4gICAgICByZWNvbW1lbmRhdGlvblR5cGU6IFJlY29tbWVuZGF0aW9uVHlwZS5DT0xMQUJPUkFUSVZFLFxyXG4gICAgICByZWFzb24sXHJcbiAgICAgIGNvbmZpZGVuY2VTY29yZTogY29sYWJSZWMuc2NvcmUsXHJcbiAgICAgIHJlbGV2YW5jZVNjb3JlOiBjb2xhYlJlYy5zY29yZSAqIDAuOSxcclxuICAgICAgcHJpb3JpdHk6IHRoaXMuY2FsY3VsYXRlUHJpb3JpdHkoY29sYWJSZWMuc2NvcmUpLFxyXG4gICAgICBleHBsYW5hdGlvbjogY29sYWJSZWMucmVhc29uLFxyXG4gICAgICBtZXRhZGF0YToge1xyXG4gICAgICAgIGFsZ29yaXRobVVzZWQ6ICdjb2xsYWJvcmF0aXZlX2ZpbHRlcmluZycsXHJcbiAgICAgICAgY29sbGFib3JhdGl2ZVNjb3JlOiBjb2xhYlJlYy5zY29yZSxcclxuICAgICAgICBzaW1pbGFyVXNlcnM6IGNvbGFiUmVjLnNpbWlsYXJVc2Vycz8uc2xpY2UoMCwgMykgfHwgW10sXHJcbiAgICAgICAgc2ltaWxhckl0ZW1zOiBjb2xhYlJlYy5zaW1pbGFySXRlbXM/LnNsaWNlKDAsIDMpIHx8IFtdLFxyXG4gICAgICAgIHJlY29tbWVuZGF0aW9uVHlwZTogaGFzVXNlckJhc2VkID8gJ3VzZXJfYmFzZWQnIDogJ2l0ZW1fYmFzZWQnLFxyXG4gICAgICB9LFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENhbGN1bGF0ZSBwcmlvcml0eSBiYXNlZCBvbiBjb2xsYWJvcmF0aXZlIHNjb3JlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjYWxjdWxhdGVQcmlvcml0eShzY29yZTogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgIGlmIChzY29yZSA+PSAwLjgpIHJldHVybiA1O1xyXG4gICAgaWYgKHNjb3JlID49IDAuNikgcmV0dXJuIDQ7XHJcbiAgICBpZiAoc2NvcmUgPj0gMC40KSByZXR1cm4gMztcclxuICAgIGlmIChzY29yZSA+PSAwLjIpIHJldHVybiAyO1xyXG4gICAgcmV0dXJuIDE7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGVjayBpZiBjYWNoZSBpcyBzdGlsbCB2YWxpZFxyXG4gICAqL1xyXG4gIHByaXZhdGUgaXNDYWNoZVZhbGlkKGNhY2hlS2V5OiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIC8vIFNpbXBsZSB0aW1lLWJhc2VkIGNhY2hlIHZhbGlkYXRpb25cclxuICAgIC8vIEluIGEgcmVhbCBpbXBsZW1lbnRhdGlvbiwgeW91IG1pZ2h0IHdhbnQgbW9yZSBzb3BoaXN0aWNhdGVkIGNhY2hlIGludmFsaWRhdGlvblxyXG4gICAgcmV0dXJuIHRydWU7IC8vIFBsYWNlaG9sZGVyIC0gaW1wbGVtZW50IGJhc2VkIG9uIHlvdXIgY2FjaGluZyBzdHJhdGVneVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2xlYXIgc2ltaWxhcml0eSBjYWNoZXMgKHVzZWZ1bCBmb3IgdGVzdGluZyBvciBtYW51YWwgY2FjaGUgcmVmcmVzaClcclxuICAgKi9cclxuICBjbGVhckNhY2hlKCk6IHZvaWQge1xyXG4gICAgdGhpcy51c2VyU2ltaWxhcml0eUNhY2hlLmNsZWFyKCk7XHJcbiAgICB0aGlzLml0ZW1TaW1pbGFyaXR5Q2FjaGUuY2xlYXIoKTtcclxuICAgIHRoaXMubG9nZ2VyLmxvZygnQ29sbGFib3JhdGl2ZSBmaWx0ZXJpbmcgY2FjaGVzIGNsZWFyZWQnKTtcclxuICB9XHJcbn1cclxuIl0sInZlcnNpb24iOjN9