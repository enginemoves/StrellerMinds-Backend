6ccf8bd94868098cc5e69cb1fef8b599
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AchievementService = void 0;
const common_1 = require("@nestjs/common");
const typeorm_1 = require("@nestjs/typeorm");
const typeorm_2 = require("typeorm");
const achievement_entity_1 = require("../entities/achievement.entity");
const user_achievement_entity_1 = require("../entities/user-achievement.entity");
let AchievementService = class AchievementService {
    constructor(achievementRepo, userAchievementRepo) {
        this.achievementRepo = achievementRepo;
        this.userAchievementRepo = userAchievementRepo;
    }
    async createAchievement(dto) {
        const achievement = this.achievementRepo.create(dto);
        return this.achievementRepo.save(achievement);
    }
    async getAllAchievements() {
        return this.achievementRepo.find();
    }
    async unlockAchievement(user, achievementId) {
        const achievement = await this.achievementRepo.findOneBy({ id: achievementId });
        if (!achievement)
            throw new common_1.NotFoundException('Achievement not found');
        let userAchievement = await this.userAchievementRepo.findOne({
            where: { user: { id: user.id }, achievement: { id: achievementId } },
        });
        if (!userAchievement) {
            userAchievement = this.userAchievementRepo.create({ user, achievement });
            await this.userAchievementRepo.save(userAchievement);
        }
        return userAchievement;
    }
    async getUserAchievements(user) {
        return this.userAchievementRepo.find({ where: { user: { id: user.id } }, relations: ['achievement'] });
    }
};
exports.AchievementService = AchievementService;
exports.AchievementService = AchievementService = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(achievement_entity_1.Achievement)),
    __param(1, (0, typeorm_1.InjectRepository)(user_achievement_entity_1.UserAchievement)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object])
], AchievementService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxnYW1pZmljYXRpb25cXHNlcnZpY2VzXFxhY2hpZXZlbWVudC5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBK0Q7QUFDL0QsNkNBQW1EO0FBQ25ELHFDQUFxQztBQUNyQyx1RUFBNkQ7QUFDN0QsaUZBQXNFO0FBSy9ELElBQU0sa0JBQWtCLEdBQXhCLE1BQU0sa0JBQWtCO0lBQzdCLFlBRVUsZUFBd0MsRUFFeEMsbUJBQWdEO1FBRmhELG9CQUFlLEdBQWYsZUFBZSxDQUF5QjtRQUV4Qyx3QkFBbUIsR0FBbkIsbUJBQW1CLENBQTZCO0lBQ3ZELENBQUM7SUFFSixLQUFLLENBQUMsaUJBQWlCLENBQUMsR0FBeUI7UUFDL0MsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDckQsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUQsS0FBSyxDQUFDLGtCQUFrQjtRQUN0QixPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDckMsQ0FBQztJQUVELEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxJQUFVLEVBQUUsYUFBcUI7UUFDdkQsTUFBTSxXQUFXLEdBQUcsTUFBTSxJQUFJLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxhQUFhLEVBQUUsQ0FBQyxDQUFDO1FBQ2hGLElBQUksQ0FBQyxXQUFXO1lBQUUsTUFBTSxJQUFJLDBCQUFpQixDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDdkUsSUFBSSxlQUFlLEdBQUcsTUFBTSxJQUFJLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDO1lBQzNELEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUUsV0FBVyxFQUFFLEVBQUUsRUFBRSxFQUFFLGFBQWEsRUFBRSxFQUFFO1NBQ3JFLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUNyQixlQUFlLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDO1lBQ3pFLE1BQU0sSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUN2RCxDQUFDO1FBQ0QsT0FBTyxlQUFlLENBQUM7SUFDekIsQ0FBQztJQUVELEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxJQUFVO1FBQ2xDLE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDekcsQ0FBQztDQUNGLENBQUE7QUFqQ1ksZ0RBQWtCOzZCQUFsQixrQkFBa0I7SUFEOUIsSUFBQSxtQkFBVSxHQUFFO0lBR1IsV0FBQSxJQUFBLDBCQUFnQixFQUFDLGdDQUFXLENBQUMsQ0FBQTtJQUU3QixXQUFBLElBQUEsMEJBQWdCLEVBQUMseUNBQWUsQ0FBQyxDQUFBO3lEQURULG9CQUFVLG9CQUFWLG9CQUFVLG9EQUVOLG9CQUFVLG9CQUFWLG9CQUFVO0dBTDlCLGtCQUFrQixDQWlDOUIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxnYW1pZmljYXRpb25cXHNlcnZpY2VzXFxhY2hpZXZlbWVudC5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIE5vdEZvdW5kRXhjZXB0aW9uIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xyXG5pbXBvcnQgeyBJbmplY3RSZXBvc2l0b3J5IH0gZnJvbSAnQG5lc3Rqcy90eXBlb3JtJztcclxuaW1wb3J0IHsgUmVwb3NpdG9yeSB9IGZyb20gJ3R5cGVvcm0nO1xyXG5pbXBvcnQgeyBBY2hpZXZlbWVudCB9IGZyb20gJy4uL2VudGl0aWVzL2FjaGlldmVtZW50LmVudGl0eSc7XHJcbmltcG9ydCB7IFVzZXJBY2hpZXZlbWVudCB9IGZyb20gJy4uL2VudGl0aWVzL3VzZXItYWNoaWV2ZW1lbnQuZW50aXR5JztcclxuaW1wb3J0IHsgVXNlciB9IGZyb20gJy4uLy4uL3VzZXJzL2VudGl0aWVzL3VzZXIuZW50aXR5JztcclxuaW1wb3J0IHsgQ3JlYXRlQWNoaWV2ZW1lbnREdG8gfSBmcm9tICcuLi9kdG8vY3JlYXRlLWFjaGlldmVtZW50LmR0byc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBBY2hpZXZlbWVudFNlcnZpY2Uge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgQEluamVjdFJlcG9zaXRvcnkoQWNoaWV2ZW1lbnQpXHJcbiAgICBwcml2YXRlIGFjaGlldmVtZW50UmVwbzogUmVwb3NpdG9yeTxBY2hpZXZlbWVudD4sXHJcbiAgICBASW5qZWN0UmVwb3NpdG9yeShVc2VyQWNoaWV2ZW1lbnQpXHJcbiAgICBwcml2YXRlIHVzZXJBY2hpZXZlbWVudFJlcG86IFJlcG9zaXRvcnk8VXNlckFjaGlldmVtZW50PixcclxuICApIHt9XHJcblxyXG4gIGFzeW5jIGNyZWF0ZUFjaGlldmVtZW50KGR0bzogQ3JlYXRlQWNoaWV2ZW1lbnREdG8pOiBQcm9taXNlPEFjaGlldmVtZW50PiB7XHJcbiAgICBjb25zdCBhY2hpZXZlbWVudCA9IHRoaXMuYWNoaWV2ZW1lbnRSZXBvLmNyZWF0ZShkdG8pO1xyXG4gICAgcmV0dXJuIHRoaXMuYWNoaWV2ZW1lbnRSZXBvLnNhdmUoYWNoaWV2ZW1lbnQpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0QWxsQWNoaWV2ZW1lbnRzKCk6IFByb21pc2U8QWNoaWV2ZW1lbnRbXT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuYWNoaWV2ZW1lbnRSZXBvLmZpbmQoKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHVubG9ja0FjaGlldmVtZW50KHVzZXI6IFVzZXIsIGFjaGlldmVtZW50SWQ6IG51bWJlcik6IFByb21pc2U8VXNlckFjaGlldmVtZW50PiB7XHJcbiAgICBjb25zdCBhY2hpZXZlbWVudCA9IGF3YWl0IHRoaXMuYWNoaWV2ZW1lbnRSZXBvLmZpbmRPbmVCeSh7IGlkOiBhY2hpZXZlbWVudElkIH0pO1xyXG4gICAgaWYgKCFhY2hpZXZlbWVudCkgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdBY2hpZXZlbWVudCBub3QgZm91bmQnKTtcclxuICAgIGxldCB1c2VyQWNoaWV2ZW1lbnQgPSBhd2FpdCB0aGlzLnVzZXJBY2hpZXZlbWVudFJlcG8uZmluZE9uZSh7XHJcbiAgICAgIHdoZXJlOiB7IHVzZXI6IHsgaWQ6IHVzZXIuaWQgfSwgYWNoaWV2ZW1lbnQ6IHsgaWQ6IGFjaGlldmVtZW50SWQgfSB9LFxyXG4gICAgfSk7XHJcbiAgICBpZiAoIXVzZXJBY2hpZXZlbWVudCkge1xyXG4gICAgICB1c2VyQWNoaWV2ZW1lbnQgPSB0aGlzLnVzZXJBY2hpZXZlbWVudFJlcG8uY3JlYXRlKHsgdXNlciwgYWNoaWV2ZW1lbnQgfSk7XHJcbiAgICAgIGF3YWl0IHRoaXMudXNlckFjaGlldmVtZW50UmVwby5zYXZlKHVzZXJBY2hpZXZlbWVudCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdXNlckFjaGlldmVtZW50O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0VXNlckFjaGlldmVtZW50cyh1c2VyOiBVc2VyKTogUHJvbWlzZTxVc2VyQWNoaWV2ZW1lbnRbXT4ge1xyXG4gICAgcmV0dXJuIHRoaXMudXNlckFjaGlldmVtZW50UmVwby5maW5kKHsgd2hlcmU6IHsgdXNlcjogeyBpZDogdXNlci5pZCB9IH0sIHJlbGF0aW9uczogWydhY2hpZXZlbWVudCddIH0pO1xyXG4gIH1cclxufSAiXSwidmVyc2lvbiI6M30=