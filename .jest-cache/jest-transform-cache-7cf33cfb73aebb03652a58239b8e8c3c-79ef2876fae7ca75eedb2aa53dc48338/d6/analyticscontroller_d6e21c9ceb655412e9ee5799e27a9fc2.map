{"file":"C:\\Users\\ojoseph\\Documents\\StrellerMinds-Backend\\src\\email\\admin\\analytics.controller.ts","mappings":"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","names":[],"sources":["C:\\Users\\ojoseph\\Documents\\StrellerMinds-Backend\\src\\email\\admin\\analytics.controller.ts"],"sourcesContent":["import { Controller, Get, Query } from '@nestjs/common';\r\nimport { EmailService } from '../email.service';\r\n\r\n@Controller('admin/email-analytics')\r\nexport class EmailAnalyticsController {\r\n  constructor(private readonly emailService: EmailService) {}\r\n\r\n  @Get('overview')\r\n  async getOverview(\r\n    @Query('startDate') startDate: string,\r\n    @Query('endDate') endDate: string,\r\n  ) {\r\n    const start = new Date(\r\n      startDate || new Date(Date.now() - 30 * 24 * 60 * 60 * 1000),\r\n    );\r\n    const end = new Date(endDate || new Date());\r\n\r\n    const analytics = await this.emailService.getEmailAnalytics(start, end);\r\n\r\n    // Calculate overall metrics\r\n    const totalSent = analytics.reduce((sum, item) => {\r\n      return sum + (item.status === 'sent' ? Number.parseInt(item.count) : 0);\r\n    }, 0);\r\n\r\n    const totalOpened = analytics.reduce((sum, item) => {\r\n      return sum + (item.status === 'opened' ? Number.parseInt(item.count) : 0);\r\n    }, 0);\r\n\r\n    const totalClicked = analytics.reduce((sum, item) => {\r\n      return (\r\n        sum + (item.status === 'clicked' ? Number.parseInt(item.count) : 0)\r\n      );\r\n    }, 0);\r\n\r\n    const totalFailed = analytics.reduce((sum, item) => {\r\n      return sum + (item.status === 'failed' ? Number.parseInt(item.count) : 0);\r\n    }, 0);\r\n\r\n    // Calculate open and click rates\r\n    const openRate = totalSent > 0 ? (totalOpened / totalSent) * 100 : 0;\r\n    const clickRate = totalOpened > 0 ? (totalClicked / totalOpened) * 100 : 0;\r\n\r\n    return {\r\n      totalSent,\r\n      totalOpened,\r\n      totalClicked,\r\n      totalFailed,\r\n      openRate: openRate.toFixed(2) + '%',\r\n      clickRate: clickRate.toFixed(2) + '%',\r\n      byTemplate: analytics,\r\n    };\r\n  }\r\n\r\n  @Get('by-template')\r\n  async getByTemplate(\r\n    @Query('startDate') startDate: string,\r\n    @Query('endDate') endDate: string,\r\n    @Query('templateName') templateName: string,\r\n  ) {\r\n    const start = new Date(\r\n      startDate || new Date(Date.now() - 30 * 24 * 60 * 60 * 1000),\r\n    );\r\n    const end = new Date(endDate || new Date());\r\n\r\n    return this.emailService.getEmailAnalytics(start, end, templateName);\r\n  }\r\n\r\n  @Get('daily')\r\n  async getDailyStats(\r\n    @Query('startDate') startDate: string,\r\n    @Query('endDate') endDate: string,\r\n    @Query('templateName') templateName?: string,\r\n  ) {\r\n    const start = new Date(\r\n      startDate || new Date(Date.now() - 30 * 24 * 60 * 60 * 1000),\r\n    );\r\n    const end = new Date(endDate || new Date());\r\n\r\n    // Get daily stats for the date range\r\n    return this.emailService.getDailyEmailStats(start, end, templateName);\r\n  }\r\n}\r\n"],"version":3}