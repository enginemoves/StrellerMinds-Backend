6aa3aec6f763339503593b0aeba70add
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const user_profiles_controller_1 = require("./user-profiles.controller");
const user_profiles_service_1 = require("./user-profiles.service");
describe('UserProfilesController', () => {
    let controller;
    let service;
    const mockUserId = 'user-123';
    const mockProfileId = 'profile-123';
    const mockProfile = {
        id: mockProfileId,
        firstName: 'John',
        lastName: 'Doe',
        bio: 'A short bio',
        avatarUrl: 'http://avatar.com/image.png',
        phoneNumber: '1234567890',
        address: '123 Main St',
        city: 'New York',
        country: 'USA',
        postalCode: '10001',
        dateOfBirth: new Date('1990-01-01'),
        isPublic: true,
        userId: mockUserId,
        user: null,
        createdAt: new Date(),
        updatedAt: new Date(),
    };
    const mockService = {
        create: jest.fn().mockResolvedValue(mockProfile),
        findAll: jest.fn().mockResolvedValue([mockProfile]),
        findOne: jest.fn().mockResolvedValue(mockProfile),
        findByUserId: jest.fn().mockResolvedValue(mockProfile),
        update: jest.fn().mockResolvedValue(mockProfile),
        patch: jest.fn().mockResolvedValue(mockProfile),
        remove: jest.fn().mockResolvedValue(undefined),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            controllers: [user_profiles_controller_1.UserProfilesController],
            providers: [
                {
                    provide: user_profiles_service_1.UserProfilesService,
                    useValue: mockService,
                },
            ],
        }).compile();
        controller = module.get(user_profiles_controller_1.UserProfilesController);
        service = module.get(user_profiles_service_1.UserProfilesService);
    });
    it('should be defined', () => {
        expect(controller).toBeDefined();
    });
    describe('create', () => {
        it('should create a new user profile', async () => {
            const dto = { firstName: 'John' };
            const req = { user: { id: mockUserId } };
            const result = await controller.create(req, dto);
            expect(result).toEqual(mockProfile);
            expect(service.create).toHaveBeenCalledWith(mockUserId, dto);
        });
    });
    describe('findAll', () => {
        it('should return all public profiles', async () => {
            const result = await controller.findAll();
            expect(result).toEqual([mockProfile]);
            expect(service.findAll).toHaveBeenCalled();
        });
    });
    describe('findOne', () => {
        it('should return a profile by id', async () => {
            const req = { user: { id: mockUserId } };
            const result = await controller.findOne(mockProfileId, req);
            expect(result).toEqual(mockProfile);
            expect(service.findOne).toHaveBeenCalledWith(mockProfileId);
        });
    });
    describe('findByUserId', () => {
        it('should return a profile by user id', async () => {
            const req = { user: { id: mockUserId } };
            const result = await controller.findByUserId(mockUserId, req);
            expect(result).toEqual(mockProfile);
            expect(service.findByUserId).toHaveBeenCalledWith(mockUserId, mockUserId);
        });
    });
    describe('update', () => {
        it('should update a profile', async () => {
            const dto = { firstName: 'Jane' };
            const req = { user: { id: mockUserId } };
            const result = await controller.update(mockProfileId, req, dto);
            expect(result).toEqual(mockProfile);
            expect(service.update).toHaveBeenCalledWith(mockProfileId, mockUserId, dto);
        });
    });
    describe('patch', () => {
        it('should partially update a profile', async () => {
            const dto = { bio: 'Updated bio' };
            const req = { user: { id: mockUserId } };
            const result = await controller.patch(mockProfileId, req, dto);
            expect(result).toEqual(mockProfile);
            expect(service.patch).toHaveBeenCalledWith(mockProfileId, mockUserId, dto);
        });
    });
    describe('remove', () => {
        it('should delete a profile', async () => {
            const req = { user: { id: mockUserId } };
            const result = await controller.remove(mockProfileId, req);
            expect(result).toBeUndefined();
            expect(service.remove).toHaveBeenCalledWith(mockProfileId, mockUserId);
        });
    });
    describe('adminRemove', () => {
        it('should allow an admin to delete a profile', async () => {
            const req = { user: { id: 'admin-id' } };
            const result = await controller.adminRemove(mockProfileId, req);
            expect(result).toBeUndefined();
            expect(service.remove).toHaveBeenCalledWith(mockProfileId, 'admin-id');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFx1c2VyLXByb2ZpbGVzXFx1c2VyLXByb2ZpbGVzLmNvbnRyb2xsZXIuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCx5RUFBb0U7QUFDcEUsbUVBQThEO0FBSzlELFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7SUFDdEMsSUFBSSxVQUFrQyxDQUFDO0lBQ3ZDLElBQUksT0FBNEIsQ0FBQztJQUVqQyxNQUFNLFVBQVUsR0FBRyxVQUFVLENBQUM7SUFDOUIsTUFBTSxhQUFhLEdBQUcsYUFBYSxDQUFDO0lBQ3BDLE1BQU0sV0FBVyxHQUFnQjtRQUMvQixFQUFFLEVBQUUsYUFBYTtRQUNqQixTQUFTLEVBQUUsTUFBTTtRQUNqQixRQUFRLEVBQUUsS0FBSztRQUNmLEdBQUcsRUFBRSxhQUFhO1FBQ2xCLFNBQVMsRUFBRSw2QkFBNkI7UUFDeEMsV0FBVyxFQUFFLFlBQVk7UUFDekIsT0FBTyxFQUFFLGFBQWE7UUFDdEIsSUFBSSxFQUFFLFVBQVU7UUFDaEIsT0FBTyxFQUFFLEtBQUs7UUFDZCxVQUFVLEVBQUUsT0FBTztRQUNuQixXQUFXLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDO1FBQ25DLFFBQVEsRUFBRSxJQUFJO1FBQ2QsTUFBTSxFQUFFLFVBQVU7UUFDbEIsSUFBSSxFQUFFLElBQUk7UUFDVixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7UUFDckIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO0tBQ3RCLENBQUM7SUFFRixNQUFNLFdBQVcsR0FBRztRQUNsQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQztRQUNoRCxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDbkQsT0FBTyxFQUFFLElBQUksQ0FB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UUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7UUFDM0IsRUFBRSxDQUFDLDJDQUEyQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3pELE1BQU0sR0FBRyxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFLFVBQVUsRUFBRSxFQUFFLENBQUM7WUFDekMsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsV0FBVyxDQUFDLGFBQWEsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNoRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDL0IsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxhQUFhLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDekUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcb2pvc2VwaFxcRG9jdW1lbnRzXFxTdHJlbGxlck1pbmRzLUJhY2tlbmRcXHNyY1xcdXNlci1wcm9maWxlc1xcdXNlci1wcm9maWxlcy5jb250cm9sbGVyLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XHJcbmltcG9ydCB7IFVzZXJQcm9maWxlc0NvbnRyb2xsZXIgfSBmcm9tICcuL3VzZXItcHJvZmlsZXMuY29udHJvbGxlcic7XHJcbmltcG9ydCB7IFVzZXJQcm9maWxlc1NlcnZpY2UgfSBmcm9tICcuL3VzZXItcHJvZmlsZXMuc2VydmljZSc7XHJcbmltcG9ydCB7IENyZWF0ZVVzZXJQcm9maWxlRHRvIH0gZnJvbSAnLi9kdG8vY3JlYXRlLXVzZXItcHJvZmlsZS5kdG8nO1xyXG5pbXBvcnQgeyBVcGRhdGVVc2VyUHJvZmlsZUR0byB9IGZyb20gJy4vZHRvL3VwZGF0ZS11c2VyLXByb2ZpbGUuZHRvJztcclxuaW1wb3J0IHsgVXNlclByb2ZpbGUgfSBmcm9tICcuL2VudGl0aWVzL3VzZXItcHJvZmlsZS5lbnRpdHknO1xyXG5cclxuZGVzY3JpYmUoJ1VzZXJQcm9maWxlc0NvbnRyb2xsZXInLCAoKSA9PiB7XHJcbiAgbGV0IGNvbnRyb2xsZXI6IFVzZXJQcm9maWxlc0NvbnRyb2xsZXI7XHJcbiAgbGV0IHNlcnZpY2U6IFVzZXJQcm9maWxlc1NlcnZpY2U7XHJcblxyXG4gIGNvbnN0IG1vY2tVc2VySWQgPSAndXNlci0xMjMnO1xyXG4gIGNvbnN0IG1vY2tQcm9maWxlSWQgPSAncHJvZmlsZS0xMjMnO1xyXG4gIGNvbnN0IG1vY2tQcm9maWxlOiBVc2VyUHJvZmlsZSA9IHtcclxuICAgIGlkOiBtb2NrUHJvZmlsZUlkLFxyXG4gICAgZmlyc3ROYW1lOiAnSm9obicsXHJcbiAgICBsYXN0TmFtZTogJ0RvZScsXHJcbiAgICBiaW86ICdBIHNob3J0IGJpbycsXHJcbiAgICBhdmF0YXJVcmw6ICdodHRwOi8vYXZhdGFyLmNvbS9pbWFnZS5wbmcnLFxyXG4gICAgcGhvbmVOdW1iZXI6ICcxMjM0NTY3ODkwJyxcclxuICAgIGFkZHJlc3M6ICcxMjMgTWFpbiBTdCcsXHJcbiAgICBjaXR5OiAnTmV3IFlvcmsnLFxyXG4gICAgY291bnRyeTogJ1VTQScsXHJcbiAgICBwb3N0YWxDb2RlOiAnMTAwMDEnLFxyXG4gICAgZGF0ZU9mQmlydGg6IG5ldyBEYXRlKCcxOTkwLTAxLTAxJyksXHJcbiAgICBpc1B1YmxpYzogdHJ1ZSxcclxuICAgIHVzZXJJZDogbW9ja1VzZXJJZCxcclxuICAgIHVzZXI6IG51bGwsXHJcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgfTtcclxuXHJcbiAgY29uc3QgbW9ja1NlcnZpY2UgPSB7XHJcbiAgICBjcmVhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvZmlsZSksXHJcbiAgICBmaW5kQWxsOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoW21vY2tQcm9maWxlXSksXHJcbiAgICBmaW5kT25lOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2ZpbGUpLFxyXG4gICAgZmluZEJ5VXNlcklkOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2ZpbGUpLFxyXG4gICAgdXBkYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2ZpbGUpLFxyXG4gICAgcGF0Y2g6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvZmlsZSksXHJcbiAgICByZW1vdmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpLFxyXG4gIH07XHJcblxyXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcclxuICAgICAgY29udHJvbGxlcnM6IFtVc2VyUHJvZmlsZXNDb250cm9sbGVyXSxcclxuICAgICAgcHJvdmlkZXJzOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgcHJvdmlkZTogVXNlclByb2ZpbGVzU2VydmljZSxcclxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrU2VydmljZSxcclxuICAgICAgICB9LFxyXG4gICAgICBdLFxyXG4gICAgfSkuY29tcGlsZSgpO1xyXG5cclxuICAgIGNvbnRyb2xsZXIgPSBtb2R1bGUuZ2V0PFVzZXJQcm9maWxlc0NvbnRyb2xsZXI+KFVzZXJQcm9maWxlc0NvbnRyb2xsZXIpO1xyXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8VXNlclByb2ZpbGVzU2VydmljZT4oVXNlclByb2ZpbGVzU2VydmljZSk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzaG91bGQgYmUgZGVmaW5lZCcsICgpID0+IHtcclxuICAgIGV4cGVjdChjb250cm9sbGVyKS50b0JlRGVmaW5lZCgpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY3JlYXRlJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYSBuZXcgdXNlciBwcm9maWxlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBkdG86IENyZWF0ZVVzZXJQcm9maWxlRHRvID0geyBmaXJzdE5hbWU6ICdKb2huJyB9O1xyXG4gICAgICBjb25zdCByZXEgPSB7IHVzZXI6IHsgaWQ6IG1vY2tVc2VySWQgfSB9O1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmNyZWF0ZShyZXEsIGR0byk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1Byb2ZpbGUpO1xyXG4gICAgICBleHBlY3Qoc2VydmljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tVc2VySWQsIGR0byk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2ZpbmRBbGwnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBhbGwgcHVibGljIHByb2ZpbGVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmZpbmRBbGwoKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbbW9ja1Byb2ZpbGVdKTtcclxuICAgICAgZXhwZWN0KHNlcnZpY2UuZmluZEFsbCkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdmaW5kT25lJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYSBwcm9maWxlIGJ5IGlkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXEgPSB7IHVzZXI6IHsgaWQ6IG1vY2tVc2VySWQgfSB9O1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmZpbmRPbmUobW9ja1Byb2ZpbGVJZCwgcmVxKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUHJvZmlsZSk7XHJcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmZpbmRPbmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tQcm9maWxlSWQpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdmaW5kQnlVc2VySWQnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBhIHByb2ZpbGUgYnkgdXNlciBpZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcmVxID0geyB1c2VyOiB7IGlkOiBtb2NrVXNlcklkIH0gfTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5maW5kQnlVc2VySWQobW9ja1VzZXJJZCwgcmVxKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUHJvZmlsZSk7XHJcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmZpbmRCeVVzZXJJZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgobW9ja1VzZXJJZCwgbW9ja1VzZXJJZCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3VwZGF0ZScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgdXBkYXRlIGEgcHJvZmlsZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZHRvOiBVcGRhdGVVc2VyUHJvZmlsZUR0byA9IHsgZmlyc3ROYW1lOiAnSmFuZScgfTtcclxuICAgICAgY29uc3QgcmVxID0geyB1c2VyOiB7IGlkOiBtb2NrVXNlcklkIH0gfTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci51cGRhdGUobW9ja1Byb2ZpbGVJZCwgcmVxLCBkdG8pO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tQcm9maWxlKTtcclxuICAgICAgZXhwZWN0KHNlcnZpY2UudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrUHJvZmlsZUlkLCBtb2NrVXNlcklkLCBkdG8pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdwYXRjaCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcGFydGlhbGx5IHVwZGF0ZSBhIHByb2ZpbGUnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGR0bzogVXBkYXRlVXNlclByb2ZpbGVEdG8gPSB7IGJpbzogJ1VwZGF0ZWQgYmlvJyB9O1xyXG4gICAgICBjb25zdCByZXEgPSB7IHVzZXI6IHsgaWQ6IG1vY2tVc2VySWQgfSB9O1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnBhdGNoKG1vY2tQcm9maWxlSWQsIHJlcSwgZHRvKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUHJvZmlsZSk7XHJcbiAgICAgIGV4cGVjdChzZXJ2aWNlLnBhdGNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrUHJvZmlsZUlkLCBtb2NrVXNlcklkLCBkdG8pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdyZW1vdmUnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGRlbGV0ZSBhIHByb2ZpbGUnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlcSA9IHsgdXNlcjogeyBpZDogbW9ja1VzZXJJZCB9IH07XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIucmVtb3ZlKG1vY2tQcm9maWxlSWQsIHJlcSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVVbmRlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHNlcnZpY2UucmVtb3ZlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrUHJvZmlsZUlkLCBtb2NrVXNlcklkKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnYWRtaW5SZW1vdmUnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGFsbG93IGFuIGFkbWluIHRvIGRlbGV0ZSBhIHByb2ZpbGUnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlcSA9IHsgdXNlcjogeyBpZDogJ2FkbWluLWlkJyB9IH07XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuYWRtaW5SZW1vdmUobW9ja1Byb2ZpbGVJZCwgcmVxKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZVVuZGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3Qoc2VydmljZS5yZW1vdmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tQcm9maWxlSWQsICdhZG1pbi1pZCcpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=