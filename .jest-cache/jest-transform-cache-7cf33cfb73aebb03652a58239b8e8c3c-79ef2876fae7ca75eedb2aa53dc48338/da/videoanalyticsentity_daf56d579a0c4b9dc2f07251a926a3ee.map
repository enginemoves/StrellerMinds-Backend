{"file":"C:\\Users\\ojoseph\\Documents\\StrellerMinds-Backend\\src\\video-streaming\\entities\\video-analytics.entity.ts","mappings":"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","names":[],"sources":["C:\\Users\\ojoseph\\Documents\\StrellerMinds-Backend\\src\\video-streaming\\entities\\video-analytics.entity.ts"],"sourcesContent":["import {\r\n  Entity,\r\n  PrimaryGeneratedColumn,\r\n  Column,\r\n  CreateDateColumn,\r\n  UpdateDateColumn,\r\n  ManyToOne,\r\n  Index,\r\n  JoinColumn,\r\n} from 'typeorm';\r\nimport { ApiProperty } from '@nestjs/swagger';\r\nimport { Video } from './video.entity';\r\nimport { User } from '../../users/entities/user.entity';\r\n\r\nexport enum AnalyticsEventType {\r\n  VIEW_START = 'view_start',\r\n  VIEW_END = 'view_end',\r\n  PAUSE = 'pause',\r\n  RESUME = 'resume',\r\n  SEEK = 'seek',\r\n  QUALITY_CHANGE = 'quality_change',\r\n  FULLSCREEN_ENTER = 'fullscreen_enter',\r\n  FULLSCREEN_EXIT = 'fullscreen_exit',\r\n  VOLUME_CHANGE = 'volume_change',\r\n  PLAYBACK_RATE_CHANGE = 'playback_rate_change',\r\n  BUFFER_START = 'buffer_start',\r\n  BUFFER_END = 'buffer_end',\r\n  ERROR = 'error',\r\n}\r\n\r\n@Entity('video_analytics')\r\n@Index(['video', 'user'])\r\n@Index(['eventType'])\r\n@Index(['timestamp'])\r\n@Index(['sessionId'])\r\nexport class VideoAnalytics {\r\n  @ApiProperty({ description: 'Analytics event ID' })\r\n  @PrimaryGeneratedColumn('uuid')\r\n  id: string;\r\n\r\n  @ApiProperty({ description: 'Session ID for grouping events' })\r\n  @Column({ length: 255 })\r\n  sessionId: string;\r\n\r\n  @ApiProperty({ description: 'Event type', enum: AnalyticsEventType })\r\n  @Column({\r\n    type: 'enum',\r\n    enum: AnalyticsEventType,\r\n  })\r\n  eventType: AnalyticsEventType;\r\n\r\n  @ApiProperty({ description: 'Timestamp when event occurred' })\r\n  @Column({ type: 'timestamp with time zone' })\r\n  timestamp: Date;\r\n\r\n  @ApiProperty({ description: 'Video playback position in seconds' })\r\n  @Column({ type: 'float', nullable: true })\r\n  playbackPosition: number;\r\n\r\n  @ApiProperty({ description: 'Video quality at time of event' })\r\n  @Column({ length: 50, nullable: true })\r\n  quality: string;\r\n\r\n  @ApiProperty({ description: 'Playback rate (1.0 = normal speed)' })\r\n  @Column({ type: 'float', default: 1.0 })\r\n  playbackRate: number;\r\n\r\n  @ApiProperty({ description: 'Volume level (0.0 to 1.0)' })\r\n  @Column({ type: 'float', nullable: true })\r\n  volume: number;\r\n\r\n  @ApiProperty({ description: 'Whether video is in fullscreen' })\r\n  @Column({ default: false })\r\n  isFullscreen: boolean;\r\n\r\n  @ApiProperty({ description: 'Buffer health percentage' })\r\n  @Column({ type: 'float', nullable: true })\r\n  bufferHealth: number;\r\n\r\n  @ApiProperty({ description: 'Network bandwidth in kbps' })\r\n  @Column({ type: 'int', nullable: true })\r\n  bandwidth: number;\r\n\r\n  @ApiProperty({ description: 'User agent string' })\r\n  @Column({ type: 'text', nullable: true })\r\n  userAgent: string;\r\n\r\n  @ApiProperty({ description: 'IP address' })\r\n  @Column({ length: 45, nullable: true })\r\n  ipAddress: string;\r\n\r\n  @ApiProperty({ description: 'Geographic location' })\r\n  @Column({ type: 'jsonb', nullable: true })\r\n  geolocation: {\r\n    country?: string;\r\n    region?: string;\r\n    city?: string;\r\n    latitude?: number;\r\n    longitude?: number;\r\n    timezone?: string;\r\n  };\r\n\r\n  @ApiProperty({ description: 'Device information' })\r\n  @Column({ type: 'jsonb', nullable: true })\r\n  deviceInfo: {\r\n    type?: 'desktop' | 'mobile' | 'tablet' | 'tv' | 'unknown';\r\n    os?: string;\r\n    osVersion?: string;\r\n    browser?: string;\r\n    browserVersion?: string;\r\n    screenResolution?: string;\r\n    devicePixelRatio?: number;\r\n  };\r\n\r\n  @ApiProperty({ description: 'Player information' })\r\n  @Column({ type: 'jsonb', nullable: true })\r\n  playerInfo: {\r\n    version?: string;\r\n    type?: 'html5' | 'flash' | 'native';\r\n    features?: string[];\r\n    plugins?: string[];\r\n  };\r\n\r\n  @ApiProperty({ description: 'Network information' })\r\n  @Column({ type: 'jsonb', nullable: true })\r\n  networkInfo: {\r\n    connectionType?: string;\r\n    effectiveType?: string;\r\n    downlink?: number;\r\n    rtt?: number;\r\n    saveData?: boolean;\r\n  };\r\n\r\n  @ApiProperty({ description: 'Performance metrics' })\r\n  @Column({ type: 'jsonb', nullable: true })\r\n  performanceMetrics: {\r\n    loadTime?: number;\r\n    firstFrame?: number;\r\n    bufferEvents?: number;\r\n    qualityChanges?: number;\r\n    errors?: number;\r\n    averageBitrate?: number;\r\n    droppedFrames?: number;\r\n  };\r\n\r\n  @ApiProperty({ description: 'Event-specific data' })\r\n  @Column({ type: 'jsonb', nullable: true })\r\n  eventData: {\r\n    seekFrom?: number;\r\n    seekTo?: number;\r\n    previousQuality?: string;\r\n    newQuality?: string;\r\n    errorCode?: string;\r\n    errorMessage?: string;\r\n    bufferDuration?: number;\r\n    [key: string]: any;\r\n  };\r\n\r\n  @ApiProperty({ description: 'Referrer URL' })\r\n  @Column({ type: 'text', nullable: true })\r\n  referrer: string;\r\n\r\n  @ApiProperty({ description: 'Page URL where video is being watched' })\r\n  @Column({ type: 'text', nullable: true })\r\n  pageUrl: string;\r\n\r\n  @ApiProperty({ description: 'Video being watched' })\r\n  @ManyToOne(() => Video, (video) => video.analytics, {\r\n    onDelete: 'CASCADE',\r\n  })\r\n  @JoinColumn({ name: 'video_id' })\r\n  video: Video;\r\n\r\n  @ApiProperty({ description: 'User watching the video' })\r\n  @ManyToOne(() => User, { nullable: true })\r\n  @JoinColumn({ name: 'user_id' })\r\n  user: User;\r\n\r\n  @ApiProperty({ description: 'Creation date' })\r\n  @CreateDateColumn()\r\n  createdAt: Date;\r\n\r\n  @ApiProperty({ description: 'Last update date' })\r\n  @UpdateDateColumn()\r\n  updatedAt: Date;\r\n\r\n  // Computed properties\r\n  get isEngagementEvent(): boolean {\r\n    return [\r\n      AnalyticsEventType.VIEW_START,\r\n      AnalyticsEventType.PAUSE,\r\n      AnalyticsEventType.RESUME,\r\n      AnalyticsEventType.SEEK,\r\n      AnalyticsEventType.FULLSCREEN_ENTER,\r\n    ].includes(this.eventType);\r\n  }\r\n\r\n  get isQualityEvent(): boolean {\r\n    return this.eventType === AnalyticsEventType.QUALITY_CHANGE;\r\n  }\r\n\r\n  get isPerformanceEvent(): boolean {\r\n    return [\r\n      AnalyticsEventType.BUFFER_START,\r\n      AnalyticsEventType.BUFFER_END,\r\n      AnalyticsEventType.ERROR,\r\n    ].includes(this.eventType);\r\n  }\r\n\r\n  get formattedTimestamp(): string {\r\n    return this.timestamp.toISOString();\r\n  }\r\n\r\n  get playbackPositionFormatted(): string {\r\n    if (!this.playbackPosition) return '0:00';\r\n    \r\n    const minutes = Math.floor(this.playbackPosition / 60);\r\n    const seconds = Math.floor(this.playbackPosition % 60);\r\n    \r\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\r\n  }\r\n}\r\n"],"version":3}