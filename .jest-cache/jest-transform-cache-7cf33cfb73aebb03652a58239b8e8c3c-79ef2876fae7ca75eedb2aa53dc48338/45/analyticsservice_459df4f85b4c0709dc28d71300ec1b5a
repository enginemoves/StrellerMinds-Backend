2d3f0b0459e04fda3c96c6d80d24f2c7
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var AnalyticsService_1;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AnalyticsService = void 0;
const common_1 = require("@nestjs/common");
let AnalyticsService = AnalyticsService_1 = class AnalyticsService {
    constructor(analyticsDataService, realtimeAnalyticsService, predictiveAnalyticsService, reportingService, courseCompletionPredictionRepository) {
        this.analyticsDataService = analyticsDataService;
        this.realtimeAnalyticsService = realtimeAnalyticsService;
        this.predictiveAnalyticsService = predictiveAnalyticsService;
        this.reportingService = reportingService;
        this.courseCompletionPredictionRepository = courseCompletionPredictionRepository;
        this.logger = new common_1.Logger(AnalyticsService_1.name);
    }
    async getCoursePerformance(dto) {
        const startDate = dto.startDate ? new Date(dto.startDate) : undefined;
        const endDate = dto.endDate ? new Date(dto.endDate) : undefined;
        if (!dto.courseId) {
            throw new Error("Course ID is required for course performance analytics.");
        }
        return this.reportingService.getCoursePerformanceMetrics(dto.courseId, startDate, endDate);
    }
    async getUserEngagement(dto) {
        const startDate = dto.startDate ? new Date(dto.startDate) : undefined;
        const endDate = dto.endDate ? new Date(dto.endDate) : undefined;
        if (!dto.userId) {
            throw new Error("User ID is required for user engagement analytics.");
        }
        return this.reportingService.getUserEngagementMetrics(dto.userId, startDate, endDate);
    }
    async getInstructorPerformance(dto) {
        const startDate = dto.startDate ? new Date(dto.startDate) : undefined;
        const endDate = dto.endDate ? new Date(dto.endDate) : undefined;
        if (!dto.instructorId) {
            throw new Error("Instructor ID is required for instructor performance analytics.");
        }
        return this.reportingService.getInstructorPerformanceMetrics(dto.instructorId, startDate, endDate);
    }
    async getPlatformOverview(dto) {
        const startDate = dto.startDate ? new Date(dto.startDate) : undefined;
        const endDate = dto.endDate ? new Date(dto.endDate) : undefined;
        return this.reportingService["getPlatformOverviewMetrics"](startDate, endDate); // Access private method for now
    }
    async getRealtimeData() {
        return this.realtimeAnalyticsService.getRealtimeDashboardData();
    }
    async predictCompletion(dto) {
        return this.predictiveAnalyticsService.predictCourseCompletion(dto);
    }
    async getUserPredictions(userId) {
        return this.predictiveAnalyticsService.getUserCompletionPredictions(userId);
    }
    async getCoursePredictions(courseId) {
        return this.predictiveAnalyticsService.getCourseCompletionPredictions(courseId);
    }
    async generateReport(dto, userId) {
        const { jobId, status } = await this.reportingService.generateReport(dto, userId);
        return { jobId, status };
    }
    async getReportStatus(jobId) {
        return this.reportingService.getReportJobStatus(jobId);
    }
    async getPredictiveSummary(dto) {
        const startDate = dto.startDate ? new Date(dto.startDate) : undefined;
        const endDate = dto.endDate ? new Date(dto.endDate) : undefined;
        const summary = await this.reportingService["getPredictiveSummary"](startDate, endDate);
        return summary[0]; // It returns an array, but we want the single summary object
    }
};
exports.AnalyticsService = AnalyticsService;
exports.AnalyticsService = AnalyticsService = AnalyticsService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [Object, Object, Object, Object, Object])
], AnalyticsService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxhbmFseXRpY3Mtc3lzdGVtXFxhbmFseXRpY3Muc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQW1EO0FBcUI1QyxJQUFNLGdCQUFnQix3QkFBdEIsTUFBTSxnQkFBZ0I7SUFHM0IsWUFDbUIsb0JBQTBDLEVBQzFDLHdCQUFrRCxFQUNsRCwwQkFBc0QsRUFDdEQsZ0JBQWtDLEVBQ2xDLG9DQUE0RTtRQUo1RSx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXNCO1FBQzFDLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFDbEQsK0JBQTBCLEdBQTFCLDBCQUEwQixDQUE0QjtRQUN0RCxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLHlDQUFvQyxHQUFwQyxvQ0FBb0MsQ0FBd0M7UUFQOUUsV0FBTSxHQUFHLElBQUksZUFBTSxDQUFDLGtCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFBO0lBUXhELENBQUM7SUFFSixLQUFLLENBQUMsb0JBQW9CLENBQUMsR0FBc0I7UUFDL0MsTUFBTSxTQUFTLEdBQUcsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUE7UUFDckUsTUFBTSxPQUFPLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUE7UUFDL0QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNsQixNQUFNLElBQUksS0FBSyxDQUFDLHlEQUF5RCxDQUFDLENBQUE7UUFDNUUsQ0FBQztRQUNELE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLDJCQUEyQixDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsU0FB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RyxFQUFFLE1BQU0sQ0FBQyxDQUFBO1FBQ2pGLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUE7SUFDMUIsQ0FBQztJQUVELEtBQUssQ0FBQyxlQUFlLENBQUMsS0FBYTtRQUNqQyxPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUN4RCxDQUFDO0lBRUQsS0FBSyxDQUFDLG9CQUFvQixDQUFDLEdBQXNCO1FBQy9DLE1BQU0sU0FBUyxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFBO1FBQ3JFLE1BQU0sT0FBTyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFBO1FBQy9ELE1BQU0sT0FBTyxHQUFHLE1BQU0sSUFBSSxDQUFDLGdCQUFnQixDQUFDLHNCQUFzQixDQUFDLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFBO1FBQ3ZGLE9BQU8sT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBLENBQUMsNkRBQTZEO0lBQ2pGLENBQUM7Q0FDRixDQUFBO0FBM0VZLDRDQUFnQjsyQkFBaEIsZ0JBQWdCO0lBRDVCLElBQUEsbUJBQVUsR0FBRTs7R0FDQSxnQkFBZ0IsQ0EyRTVCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcb2pvc2VwaFxcRG9jdW1lbnRzXFxTdHJlbGxlck1pbmRzLUJhY2tlbmRcXHNyY1xcYW5hbHl0aWNzLXN5c3RlbVxcYW5hbHl0aWNzLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgTG9nZ2VyIH0gZnJvbSBcIkBuZXN0anMvY29tbW9uXCJcclxuaW1wb3J0IHR5cGUgeyBBbmFseXRpY3NRdWVyeUR0byB9IGZyb20gXCIuL2R0by9hbmFseXRpY3MtcXVlcnkuZHRvXCJcclxuaW1wb3J0IHR5cGUgeyBQcmVkaWN0Q29tcGxldGlvbkR0byB9IGZyb20gXCIuL2R0by9wcmVkaWN0LWNvbXBsZXRpb24uZHRvXCJcclxuaW1wb3J0IHR5cGUgeyBHZW5lcmF0ZVJlcG9ydER0byB9IGZyb20gXCIuL2R0by9nZW5lcmF0ZS1yZXBvcnQuZHRvXCJcclxuaW1wb3J0IHR5cGUge1xyXG4gIENvdXJzZVBlcmZvcm1hbmNlTWV0cmljcyxcclxuICBVc2VyRW5nYWdlbWVudE1ldHJpY3MsXHJcbiAgSW5zdHJ1Y3RvclBlcmZvcm1hbmNlTWV0cmljcyxcclxuICBQcmVkaWN0aXZlQW5hbHl0aWNzUmVzdWx0LFxyXG4gIFJlYWx0aW1lRGFzaGJvYXJkRGF0YSxcclxuICBHZW5lcmF0ZWRSZXBvcnQsXHJcbn0gZnJvbSBcIi4vaW50ZXJmYWNlcy9hbmFseXRpY3MuaW50ZXJmYWNlXCJcclxuaW1wb3J0IHR5cGUgeyBBbmFseXRpY3NEYXRhU2VydmljZSB9IGZyb20gXCIuL3NlcnZpY2VzL2FuYWx5dGljcy1kYXRhLnNlcnZpY2VcIlxyXG5pbXBvcnQgdHlwZSB7IFJlYWx0aW1lQW5hbHl0aWNzU2VydmljZSB9IGZyb20gXCIuL3NlcnZpY2VzL3JlYWx0aW1lLWFuYWx5dGljcy5zZXJ2aWNlXCJcclxuaW1wb3J0IHR5cGUgeyBQcmVkaWN0aXZlQW5hbHl0aWNzU2VydmljZSB9IGZyb20gXCIuL3NlcnZpY2VzL3ByZWRpY3RpdmUtYW5hbHl0aWNzLnNlcnZpY2VcIlxyXG5pbXBvcnQgdHlwZSB7IFJlcG9ydGluZ1NlcnZpY2UgfSBmcm9tIFwiLi9zZXJ2aWNlcy9yZXBvcnRpbmcuc2VydmljZVwiXHJcbmltcG9ydCB0eXBlIHsgUmVwb3J0R2VuZXJhdGlvbkpvYiB9IGZyb20gXCIuL2VudGl0aWVzL3JlcG9ydC1nZW5lcmF0aW9uLWpvYi5lbnRpdHlcIlxyXG5pbXBvcnQgdHlwZSB7IFJlcG9zaXRvcnkgfSBmcm9tIFwidHlwZW9ybVwiXHJcbmltcG9ydCB0eXBlIHsgQ291cnNlQ29tcGxldGlvblByZWRpY3Rpb24gfSBmcm9tIFwiLi9lbnRpdGllcy9jb3Vyc2UtY29tcGxldGlvbi1wcmVkaWN0aW9uLmVudGl0eVwiXHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBBbmFseXRpY3NTZXJ2aWNlIHtcclxuICBwcml2YXRlIHJlYWRvbmx5IGxvZ2dlciA9IG5ldyBMb2dnZXIoQW5hbHl0aWNzU2VydmljZS5uYW1lKVxyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgYW5hbHl0aWNzRGF0YVNlcnZpY2U6IEFuYWx5dGljc0RhdGFTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSByZWFkb25seSByZWFsdGltZUFuYWx5dGljc1NlcnZpY2U6IFJlYWx0aW1lQW5hbHl0aWNzU2VydmljZSxcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgcHJlZGljdGl2ZUFuYWx5dGljc1NlcnZpY2U6IFByZWRpY3RpdmVBbmFseXRpY3NTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSByZWFkb25seSByZXBvcnRpbmdTZXJ2aWNlOiBSZXBvcnRpbmdTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBjb3Vyc2VDb21wbGV0aW9uUHJlZGljdGlvblJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8Q291cnNlQ29tcGxldGlvblByZWRpY3Rpb24+LFxyXG4gICkge31cclxuXHJcbiAgYXN5bmMgZ2V0Q291cnNlUGVyZm9ybWFuY2UoZHRvOiBBbmFseXRpY3NRdWVyeUR0byk6IFByb21pc2U8Q291cnNlUGVyZm9ybWFuY2VNZXRyaWNzPiB7XHJcbiAgICBjb25zdCBzdGFydERhdGUgPSBkdG8uc3RhcnREYXRlID8gbmV3IERhdGUoZHRvLnN0YXJ0RGF0ZSkgOiB1bmRlZmluZWRcclxuICAgIGNvbnN0IGVuZERhdGUgPSBkdG8uZW5kRGF0ZSA/IG5ldyBEYXRlKGR0by5lbmREYXRlKSA6IHVuZGVmaW5lZFxyXG4gICAgaWYgKCFkdG8uY291cnNlSWQpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ291cnNlIElEIGlzIHJlcXVpcmVkIGZvciBjb3Vyc2UgcGVyZm9ybWFuY2UgYW5hbHl0aWNzLlwiKVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMucmVwb3J0aW5nU2VydmljZS5nZXRDb3Vyc2VQZXJmb3JtYW5jZU1ldHJpY3MoZHRvLmNvdXJzZUlkLCBzdGFydERhdGUsIGVuZERhdGUpXHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRVc2VyRW5nYWdlbWVudChkdG86IEFuYWx5dGljc1F1ZXJ5RHRvKTogUHJvbWlzZTxVc2VyRW5nYWdlbWVudE1ldHJpY3M+IHtcclxuICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IGR0by5zdGFydERhdGUgPyBuZXcgRGF0ZShkdG8uc3RhcnREYXRlKSA6IHVuZGVmaW5lZFxyXG4gICAgY29uc3QgZW5kRGF0ZSA9IGR0by5lbmREYXRlID8gbmV3IERhdGUoZHRvLmVuZERhdGUpIDogdW5kZWZpbmVkXHJcbiAgICBpZiAoIWR0by51c2VySWQpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVXNlciBJRCBpcyByZXF1aXJlZCBmb3IgdXNlciBlbmdhZ2VtZW50IGFuYWx5dGljcy5cIilcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLnJlcG9ydGluZ1NlcnZpY2UuZ2V0VXNlckVuZ2FnZW1lbnRNZXRyaWNzKGR0by51c2VySWQsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSlcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldEluc3RydWN0b3JQZXJmb3JtYW5jZShkdG86IEFuYWx5dGljc1F1ZXJ5RHRvKTogUHJvbWlzZTxJbnN0cnVjdG9yUGVyZm9ybWFuY2VNZXRyaWNzPiB7XHJcbiAgICBjb25zdCBzdGFydERhdGUgPSBkdG8uc3RhcnREYXRlID8gbmV3IERhdGUoZHRvLnN0YXJ0RGF0ZSkgOiB1bmRlZmluZWRcclxuICAgIGNvbnN0IGVuZERhdGUgPSBkdG8uZW5kRGF0ZSA/IG5ldyBEYXRlKGR0by5lbmREYXRlKSA6IHVuZGVmaW5lZFxyXG4gICAgaWYgKCFkdG8uaW5zdHJ1Y3RvcklkKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkluc3RydWN0b3IgSUQgaXMgcmVxdWlyZWQgZm9yIGluc3RydWN0b3IgcGVyZm9ybWFuY2UgYW5hbHl0aWNzLlwiKVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMucmVwb3J0aW5nU2VydmljZS5nZXRJbnN0cnVjdG9yUGVyZm9ybWFuY2VNZXRyaWNzKGR0by5pbnN0cnVjdG9ySWQsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSlcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldFBsYXRmb3JtT3ZlcnZpZXcoZHRvOiBBbmFseXRpY3NRdWVyeUR0byk6IFByb21pc2U8YW55PiB7XHJcbiAgICBjb25zdCBzdGFydERhdGUgPSBkdG8uc3RhcnREYXRlID8gbmV3IERhdGUoZHRvLnN0YXJ0RGF0ZSkgOiB1bmRlZmluZWRcclxuICAgIGNvbnN0IGVuZERhdGUgPSBkdG8uZW5kRGF0ZSA/IG5ldyBEYXRlKGR0by5lbmREYXRlKSA6IHVuZGVmaW5lZFxyXG4gICAgcmV0dXJuIHRoaXMucmVwb3J0aW5nU2VydmljZVtcImdldFBsYXRmb3JtT3ZlcnZpZXdNZXRyaWNzXCJdKHN0YXJ0RGF0ZSwgZW5kRGF0ZSkgLy8gQWNjZXNzIHByaXZhdGUgbWV0aG9kIGZvciBub3dcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldFJlYWx0aW1lRGF0YSgpOiBQcm9taXNlPFJlYWx0aW1lRGFzaGJvYXJkRGF0YT4ge1xyXG4gICAgcmV0dXJuIHRoaXMucmVhbHRpbWVBbmFseXRpY3NTZXJ2aWNlLmdldFJlYWx0aW1lRGFzaGJvYXJkRGF0YSgpXHJcbiAgfVxyXG5cclxuICBhc3luYyBwcmVkaWN0Q29tcGxldGlvbihkdG86IFByZWRpY3RDb21wbGV0aW9uRHRvKTogUHJvbWlzZTxQcmVkaWN0aXZlQW5hbHl0aWNzUmVzdWx0PiB7XHJcbiAgICByZXR1cm4gdGhpcy5wcmVkaWN0aXZlQW5hbHl0aWNzU2VydmljZS5wcmVkaWN0Q291cnNlQ29tcGxldGlvbihkdG8pXHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRVc2VyUHJlZGljdGlvbnModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPENvdXJzZUNvbXBsZXRpb25QcmVkaWN0aW9uW10+IHtcclxuICAgIHJldHVybiB0aGlzLnByZWRpY3RpdmVBbmFseXRpY3NTZXJ2aWNlLmdldFVzZXJDb21wbGV0aW9uUHJlZGljdGlvbnModXNlcklkKVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0Q291cnNlUHJlZGljdGlvbnMoY291cnNlSWQ6IHN0cmluZyk6IFByb21pc2U8Q291cnNlQ29tcGxldGlvblByZWRpY3Rpb25bXT4ge1xyXG4gICAgcmV0dXJuIHRoaXMucHJlZGljdGl2ZUFuYWx5dGljc1NlcnZpY2UuZ2V0Q291cnNlQ29tcGxldGlvblByZWRpY3Rpb25zKGNvdXJzZUlkKVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2VuZXJhdGVSZXBvcnQoZHRvOiBHZW5lcmF0ZVJlcG9ydER0bywgdXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPEdlbmVyYXRlZFJlcG9ydD4ge1xyXG4gICAgY29uc3QgeyBqb2JJZCwgc3RhdHVzIH0gPSBhd2FpdCB0aGlzLnJlcG9ydGluZ1NlcnZpY2UuZ2VuZXJhdGVSZXBvcnQoZHRvLCB1c2VySWQpXHJcbiAgICByZXR1cm4geyBqb2JJZCwgc3RhdHVzIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGdldFJlcG9ydFN0YXR1cyhqb2JJZDogc3RyaW5nKTogUHJvbWlzZTxSZXBvcnRHZW5lcmF0aW9uSm9iIHwgbnVsbD4ge1xyXG4gICAgcmV0dXJuIHRoaXMucmVwb3J0aW5nU2VydmljZS5nZXRSZXBvcnRKb2JTdGF0dXMoam9iSWQpXHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRQcmVkaWN0aXZlU3VtbWFyeShkdG86IEFuYWx5dGljc1F1ZXJ5RHRvKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IGR0by5zdGFydERhdGUgPyBuZXcgRGF0ZShkdG8uc3RhcnREYXRlKSA6IHVuZGVmaW5lZFxyXG4gICAgY29uc3QgZW5kRGF0ZSA9IGR0by5lbmREYXRlID8gbmV3IERhdGUoZHRvLmVuZERhdGUpIDogdW5kZWZpbmVkXHJcbiAgICBjb25zdCBzdW1tYXJ5ID0gYXdhaXQgdGhpcy5yZXBvcnRpbmdTZXJ2aWNlW1wiZ2V0UHJlZGljdGl2ZVN1bW1hcnlcIl0oc3RhcnREYXRlLCBlbmREYXRlKVxyXG4gICAgcmV0dXJuIHN1bW1hcnlbMF0gLy8gSXQgcmV0dXJucyBhbiBhcnJheSwgYnV0IHdlIHdhbnQgdGhlIHNpbmdsZSBzdW1tYXJ5IG9iamVjdFxyXG4gIH1cclxufVxyXG4iXSwidmVyc2lvbiI6M30=