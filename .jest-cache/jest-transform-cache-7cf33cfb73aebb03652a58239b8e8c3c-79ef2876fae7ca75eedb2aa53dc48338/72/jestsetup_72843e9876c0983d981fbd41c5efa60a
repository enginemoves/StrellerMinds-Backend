a8dcc99a7b659cdecda81c4255b95dd5
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
// Mock external services by default
jest.mock('nodemailer', () => ({
    createTransport: jest.fn(() => ({
        sendMail: jest.fn().mockResolvedValue({ messageId: 'test-message-id' }),
        verify: jest.fn().mockResolvedValue(true),
    })),
}));
jest.mock('@aws-sdk/client-s3', () => ({
    S3Client: jest.fn(() => ({
        send: jest.fn(),
    })),
    PutObjectCommand: jest.fn(),
    GetObjectCommand: jest.fn(),
    DeleteObjectCommand: jest.fn(),
    HeadObjectCommand: jest.fn(),
}));
jest.mock('@aws-sdk/client-cloudfront', () => ({
    CloudFrontClient: jest.fn(() => ({
        send: jest.fn(),
    })),
    CreateInvalidationCommand: jest.fn(),
    GetDistributionCommand: jest.fn(),
}));
jest.mock('stripe', () => ({
    __esModule: true,
    default: jest.fn(() => ({
        customers: {
            create: jest.fn(),
            retrieve: jest.fn(),
            update: jest.fn(),
            del: jest.fn(),
        },
        paymentIntents: {
            create: jest.fn(),
            retrieve: jest.fn(),
            confirm: jest.fn(),
            cancel: jest.fn(),
        },
        subscriptions: {
            create: jest.fn(),
            retrieve: jest.fn(),
            update: jest.fn(),
            del: jest.fn(),
        },
        webhooks: {
            constructEvent: jest.fn(),
        },
    })),
}));
require("reflect-metadata");
const dotenv_1 = require("dotenv");
// Load test environment variables
(0, dotenv_1.config)({ path: '.env.test' });
// Global test configuration
global.console = {
    ...console,
    // Suppress console.log in tests unless explicitly needed
    log: process.env.JEST_VERBOSE === 'true' ? console.log : jest.fn(),
    debug: process.env.JEST_VERBOSE === 'true' ? console.debug : jest.fn(),
    info: process.env.JEST_VERBOSE === 'true' ? console.info : jest.fn(),
    warn: console.warn,
    error: console.error,
};
// Global test timeout
jest.setTimeout(30000);
// Global test database connection
let testDataSource;
// Setup and teardown hooks
beforeAll(async () => {
    // Initialize test database connection if needed
    if (process.env.DATABASE_URL) {
        // Database setup would go here
    }
});
afterAll(async () => {
    // Cleanup test database connection
    if (testDataSource && testDataSource.isInitialized) {
        await testDataSource.destroy();
    }
});
beforeEach(() => {
    // Clear all mocks before each test
    jest.clearAllMocks();
});
afterEach(() => {
    // Additional cleanup after each test
    jest.restoreAllMocks();
});
// Export test utilities
global.testUtils = {
    createTestingModule: async (metadata) => {
        const { Test } = await Promise.resolve().then(() => __importStar(require('@nestjs/testing')));
        return Test.createTestingModule(metadata).compile();
    },
    createMockRepository: () => ({
        find: jest.fn(),
        findOne: jest.fn(),
        findOneBy: jest.fn(),
        findAndCount: jest.fn(),
        create: jest.fn(),
        save: jest.fn(),
        update: jest.fn(),
        delete: jest.fn(),
        remove: jest.fn(),
        count: jest.fn(),
        increment: jest.fn(),
        decrement: jest.fn(),
        createQueryBuilder: jest.fn(() => ({
            where: jest.fn().mockReturnThis(),
            andWhere: jest.fn().mockReturnThis(),
            orWhere: jest.fn().mockReturnThis(),
            orderBy: jest.fn().mockReturnThis(),
            limit: jest.fn().mockReturnThis(),
            offset: jest.fn().mockReturnThis(),
            skip: jest.fn().mockReturnThis(),
            take: jest.fn().mockReturnThis(),
            leftJoin: jest.fn().mockReturnThis(),
            leftJoinAndSelect: jest.fn().mockReturnThis(),
            innerJoin: jest.fn().mockReturnThis(),
            innerJoinAndSelect: jest.fn().mockReturnThis(),
            select: jest.fn().mockReturnThis(),
            addSelect: jest.fn().mockReturnThis(),
            groupBy: jest.fn().mockReturnThis(),
            having: jest.fn().mockReturnThis(),
            getOne: jest.fn(),
            getMany: jest.fn(),
            getManyAndCount: jest.fn(),
            getCount: jest.fn(),
            getRawOne: jest.fn(),
            getRawMany: jest.fn(),
            execute: jest.fn(),
        })),
    }),
    createMockService: (methods) => {
        const mockService = {};
        methods.forEach(method => {
            mockService[method] = jest.fn();
        });
        return mockService;
    },
    generateTestData: (type, overrides = {}) => {
        // This will be implemented with factories
        return { ...overrides };
    },
    cleanupDatabase: async () => {
        // Database cleanup implementation
        if (testDataSource && testDataSource.isInitialized) {
            // Clean up test data
        }
    },
};
// Environment validation
if (!process.env.NODE_ENV) {
    process.env.NODE_ENV = 'test';
}
if (process.env.NODE_ENV !== 'test') {
    throw new Error('Tests must be run with NODE_ENV=test');
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcdGVzdFxcc2V0dXBcXGplc3Quc2V0dXAudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFzQkEsb0NBQW9DO0FBQ3BDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDN0IsZUFBZSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUM5QixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsU0FBUyxFQUFFLGlCQUFpQixFQUFFLENBQUM7UUFDdkUsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUM7S0FDMUMsQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDLENBQUM7QUFFSixJQUFJLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDckMsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUN2QixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNoQixDQUFDLENBQUM7SUFDSCxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQzNCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDM0IsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUM5QixpQkFBaUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQzdCLENBQUMsQ0FBQyxDQUFDO0FBRUosSUFBSSxDQUFDLElBQUksQ0FBQyw0QkFBNEIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQzdDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztR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SSxLQUFLLENBQUMsc0NBQXNDLENBQUMsQ0FBQztBQUMxRCxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcb2pvc2VwaFxcRG9jdW1lbnRzXFxTdHJlbGxlck1pbmRzLUJhY2tlbmRcXHRlc3RcXHNldHVwXFxqZXN0LnNldHVwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAncmVmbGVjdC1tZXRhZGF0YSc7XHJcbmltcG9ydCB7IGNvbmZpZyB9IGZyb20gJ2RvdGVudic7XHJcbmltcG9ydCB7IERhdGFTb3VyY2UgfSBmcm9tICd0eXBlb3JtJztcclxuaW1wb3J0IHsgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XHJcblxyXG4vLyBMb2FkIHRlc3QgZW52aXJvbm1lbnQgdmFyaWFibGVzXHJcbmNvbmZpZyh7IHBhdGg6ICcuZW52LnRlc3QnIH0pO1xyXG5cclxuLy8gR2xvYmFsIHRlc3QgY29uZmlndXJhdGlvblxyXG5nbG9iYWwuY29uc29sZSA9IHtcclxuICAuLi5jb25zb2xlLFxyXG4gIC8vIFN1cHByZXNzIGNvbnNvbGUubG9nIGluIHRlc3RzIHVubGVzcyBleHBsaWNpdGx5IG5lZWRlZFxyXG4gIGxvZzogcHJvY2Vzcy5lbnYuSkVTVF9WRVJCT1NFID09PSAndHJ1ZScgPyBjb25zb2xlLmxvZyA6IGplc3QuZm4oKSxcclxuICBkZWJ1ZzogcHJvY2Vzcy5lbnYuSkVTVF9WRVJCT1NFID09PSAndHJ1ZScgPyBjb25zb2xlLmRlYnVnIDogamVzdC5mbigpLFxyXG4gIGluZm86IHByb2Nlc3MuZW52LkpFU1RfVkVSQk9TRSA9PT0gJ3RydWUnID8gY29uc29sZS5pbmZvIDogamVzdC5mbigpLFxyXG4gIHdhcm46IGNvbnNvbGUud2FybixcclxuICBlcnJvcjogY29uc29sZS5lcnJvcixcclxufTtcclxuXHJcbi8vIEdsb2JhbCB0ZXN0IHRpbWVvdXRcclxuamVzdC5zZXRUaW1lb3V0KDMwMDAwKTtcclxuXHJcbi8vIE1vY2sgZXh0ZXJuYWwgc2VydmljZXMgYnkgZGVmYXVsdFxyXG5qZXN0Lm1vY2soJ25vZGVtYWlsZXInLCAoKSA9PiAoe1xyXG4gIGNyZWF0ZVRyYW5zcG9ydDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgc2VuZE1haWw6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IG1lc3NhZ2VJZDogJ3Rlc3QtbWVzc2FnZS1pZCcgfSksXHJcbiAgICB2ZXJpZnk6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcclxuICB9KSksXHJcbn0pKTtcclxuXHJcbmplc3QubW9jaygnQGF3cy1zZGsvY2xpZW50LXMzJywgKCkgPT4gKHtcclxuICBTM0NsaWVudDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgc2VuZDogamVzdC5mbigpLFxyXG4gIH0pKSxcclxuICBQdXRPYmplY3RDb21tYW5kOiBqZXN0LmZuKCksXHJcbiAgR2V0T2JqZWN0Q29tbWFuZDogamVzdC5mbigpLFxyXG4gIERlbGV0ZU9iamVjdENvbW1hbmQ6IGplc3QuZm4oKSxcclxuICBIZWFkT2JqZWN0Q29tbWFuZDogamVzdC5mbigpLFxyXG59KSk7XHJcblxyXG5qZXN0Lm1vY2soJ0Bhd3Mtc2RrL2NsaWVudC1jbG91ZGZyb250JywgKCkgPT4gKHtcclxuICBDbG91ZEZyb250Q2xpZW50OiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICBzZW5kOiBqZXN0LmZuKCksXHJcbiAgfSkpLFxyXG4gIENyZWF0ZUludmFsaWRhdGlvbkNvbW1hbmQ6IGplc3QuZm4oKSxcclxuICBHZXREaXN0cmlidXRpb25Db21tYW5kOiBqZXN0LmZuKCksXHJcbn0pKTtcclxuXHJcbmplc3QubW9jaygnc3RyaXBlJywgKCkgPT4gKHtcclxuICBfX2VzTW9kdWxlOiB0cnVlLFxyXG4gIGRlZmF1bHQ6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgIGN1c3RvbWVyczoge1xyXG4gICAgICBjcmVhdGU6IGplc3QuZm4oKSxcclxuICAgICAgcmV0cmlldmU6IGplc3QuZm4oKSxcclxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXHJcbiAgICAgIGRlbDogamVzdC5mbigpLFxyXG4gICAgfSxcclxuICAgIHBheW1lbnRJbnRlbnRzOiB7XHJcbiAgICAgIGNyZWF0ZTogamVzdC5mbigpLFxyXG4gICAgICByZXRyaWV2ZTogamVzdC5mbigpLFxyXG4gICAgICBjb25maXJtOiBqZXN0LmZuKCksXHJcbiAgICAgIGNhbmNlbDogamVzdC5mbigpLFxyXG4gICAgfSxcclxuICAgIHN1YnNjcmlwdGlvbnM6IHtcclxuICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXHJcbiAgICAgIHJldHJpZXZlOiBqZXN0LmZuKCksXHJcbiAgICAgIHVwZGF0ZTogamVzdC5mbigpLFxyXG4gICAgICBkZWw6IGplc3QuZm4oKSxcclxuICAgIH0sXHJcbiAgICB3ZWJob29rczoge1xyXG4gICAgICBjb25zdHJ1Y3RFdmVudDogamVzdC5mbigpLFxyXG4gICAgfSxcclxuICB9KSksXHJcbn0pKTtcclxuXHJcbi8vIEdsb2JhbCB0ZXN0IGRhdGFiYXNlIGNvbm5lY3Rpb25cclxubGV0IHRlc3REYXRhU291cmNlOiBEYXRhU291cmNlO1xyXG5cclxuLy8gU2V0dXAgYW5kIHRlYXJkb3duIGhvb2tzXHJcbmJlZm9yZUFsbChhc3luYyAoKSA9PiB7XHJcbiAgLy8gSW5pdGlhbGl6ZSB0ZXN0IGRhdGFiYXNlIGNvbm5lY3Rpb24gaWYgbmVlZGVkXHJcbiAgaWYgKHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCkge1xyXG4gICAgLy8gRGF0YWJhc2Ugc2V0dXAgd291bGQgZ28gaGVyZVxyXG4gIH1cclxufSk7XHJcblxyXG5hZnRlckFsbChhc3luYyAoKSA9PiB7XHJcbiAgLy8gQ2xlYW51cCB0ZXN0IGRhdGFiYXNlIGNvbm5lY3Rpb25cclxuICBpZiAodGVzdERhdGFTb3VyY2UgJiYgdGVzdERhdGFTb3VyY2UuaXNJbml0aWFsaXplZCkge1xyXG4gICAgYXdhaXQgdGVzdERhdGFTb3VyY2UuZGVzdHJveSgpO1xyXG4gIH1cclxufSk7XHJcblxyXG5iZWZvcmVFYWNoKCgpID0+IHtcclxuICAvLyBDbGVhciBhbGwgbW9ja3MgYmVmb3JlIGVhY2ggdGVzdFxyXG4gIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG59KTtcclxuXHJcbmFmdGVyRWFjaCgoKSA9PiB7XHJcbiAgLy8gQWRkaXRpb25hbCBjbGVhbnVwIGFmdGVyIGVhY2ggdGVzdFxyXG4gIGplc3QucmVzdG9yZUFsbE1vY2tzKCk7XHJcbn0pO1xyXG5cclxuLy8gR2xvYmFsIHRlc3QgdXRpbGl0aWVzXHJcbmRlY2xhcmUgZ2xvYmFsIHtcclxuICBuYW1lc3BhY2UgamVzdCB7XHJcbiAgICBpbnRlcmZhY2UgTWF0Y2hlcnM8Uj4ge1xyXG4gICAgICB0b0JlVmFsaWRVVUlEKCk6IFI7XHJcbiAgICAgIHRvQmVWYWxpZEVtYWlsKCk6IFI7XHJcbiAgICAgIHRvQmVWYWxpZERhdGUoKTogUjtcclxuICAgICAgdG9IYXZlVmFsaWRhdGlvbkVycm9yKGZpZWxkOiBzdHJpbmcpOiBSO1xyXG4gICAgICB0b01hdGNoQXBpUmVzcG9uc2UoKTogUjtcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgdmFyIHRlc3RVdGlsczoge1xyXG4gICAgY3JlYXRlVGVzdGluZ01vZHVsZTogKG1ldGFkYXRhOiBhbnkpID0+IFByb21pc2U8VGVzdGluZ01vZHVsZT47XHJcbiAgICBjcmVhdGVNb2NrUmVwb3NpdG9yeTogKCkgPT4gYW55O1xyXG4gICAgY3JlYXRlTW9ja1NlcnZpY2U6IChtZXRob2RzOiBzdHJpbmdbXSkgPT4gYW55O1xyXG4gICAgZ2VuZXJhdGVUZXN0RGF0YTogKHR5cGU6IHN0cmluZywgb3ZlcnJpZGVzPzogYW55KSA9PiBhbnk7XHJcbiAgICBjbGVhbnVwRGF0YWJhc2U6ICgpID0+IFByb21pc2U8dm9pZD47XHJcbiAgfTtcclxufVxyXG5cclxuLy8gRXhwb3J0IHRlc3QgdXRpbGl0aWVzXHJcbmdsb2JhbC50ZXN0VXRpbHMgPSB7XHJcbiAgY3JlYXRlVGVzdGluZ01vZHVsZTogYXN5bmMgKG1ldGFkYXRhOiBhbnkpOiBQcm9taXNlPFRlc3RpbmdNb2R1bGU+ID0+IHtcclxuICAgIGNvbnN0IHsgVGVzdCB9ID0gYXdhaXQgaW1wb3J0KCdAbmVzdGpzL3Rlc3RpbmcnKTtcclxuICAgIHJldHVybiBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUobWV0YWRhdGEpLmNvbXBpbGUoKTtcclxuICB9LFxyXG5cclxuICBjcmVhdGVNb2NrUmVwb3NpdG9yeTogKCkgPT4gKHtcclxuICAgIGZpbmQ6IGplc3QuZm4oKSxcclxuICAgIGZpbmRPbmU6IGplc3QuZm4oKSxcclxuICAgIGZpbmRPbmVCeTogamVzdC5mbigpLFxyXG4gICAgZmluZEFuZENvdW50OiBqZXN0LmZuKCksXHJcbiAgICBjcmVhdGU6IGplc3QuZm4oKSxcclxuICAgIHNhdmU6IGplc3QuZm4oKSxcclxuICAgIHVwZGF0ZTogamVzdC5mbigpLFxyXG4gICAgZGVsZXRlOiBqZXN0LmZuKCksXHJcbiAgICByZW1vdmU6IGplc3QuZm4oKSxcclxuICAgIGNvdW50OiBqZXN0LmZuKCksXHJcbiAgICBpbmNyZW1lbnQ6IGplc3QuZm4oKSxcclxuICAgIGRlY3JlbWVudDogamVzdC5mbigpLFxyXG4gICAgY3JlYXRlUXVlcnlCdWlsZGVyOiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICAgIHdoZXJlOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgYW5kV2hlcmU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBvcldoZXJlOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgb3JkZXJCeTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXHJcbiAgICAgIGxpbWl0OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgb2Zmc2V0OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgc2tpcDogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXHJcbiAgICAgIHRha2U6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBsZWZ0Sm9pbjogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXHJcbiAgICAgIGxlZnRKb2luQW5kU2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgaW5uZXJKb2luOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgaW5uZXJKb2luQW5kU2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgYWRkU2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgZ3JvdXBCeTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXHJcbiAgICAgIGhhdmluZzogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXHJcbiAgICAgIGdldE9uZTogamVzdC5mbigpLFxyXG4gICAgICBnZXRNYW55OiBqZXN0LmZuKCksXHJcbiAgICAgIGdldE1hbnlBbmRDb3VudDogamVzdC5mbigpLFxyXG4gICAgICBnZXRDb3VudDogamVzdC5mbigpLFxyXG4gICAgICBnZXRSYXdPbmU6IGplc3QuZm4oKSxcclxuICAgICAgZ2V0UmF3TWFueTogamVzdC5mbigpLFxyXG4gICAgICBleGVjdXRlOiBqZXN0LmZuKCksXHJcbiAgICB9KSksXHJcbiAgfSksXHJcblxyXG4gIGNyZWF0ZU1vY2tTZXJ2aWNlOiAobWV0aG9kczogc3RyaW5nW10pID0+IHtcclxuICAgIGNvbnN0IG1vY2tTZXJ2aWNlID0ge307XHJcbiAgICBtZXRob2RzLmZvckVhY2gobWV0aG9kID0+IHtcclxuICAgICAgbW9ja1NlcnZpY2VbbWV0aG9kXSA9IGplc3QuZm4oKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIG1vY2tTZXJ2aWNlO1xyXG4gIH0sXHJcblxyXG4gIGdlbmVyYXRlVGVzdERhdGE6ICh0eXBlOiBzdHJpbmcsIG92ZXJyaWRlczogYW55ID0ge30pID0+IHtcclxuICAgIC8vIFRoaXMgd2lsbCBiZSBpbXBsZW1lbnRlZCB3aXRoIGZhY3Rvcmllc1xyXG4gICAgcmV0dXJuIHsgLi4ub3ZlcnJpZGVzIH07XHJcbiAgfSxcclxuXHJcbiAgY2xlYW51cERhdGFiYXNlOiBhc3luYyAoKSA9PiB7XHJcbiAgICAvLyBEYXRhYmFzZSBjbGVhbnVwIGltcGxlbWVudGF0aW9uXHJcbiAgICBpZiAodGVzdERhdGFTb3VyY2UgJiYgdGVzdERhdGFTb3VyY2UuaXNJbml0aWFsaXplZCkge1xyXG4gICAgICAvLyBDbGVhbiB1cCB0ZXN0IGRhdGFcclxuICAgIH1cclxuICB9LFxyXG59O1xyXG5cclxuLy8gRW52aXJvbm1lbnQgdmFsaWRhdGlvblxyXG5pZiAoIXByb2Nlc3MuZW52Lk5PREVfRU5WKSB7XHJcbiAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAndGVzdCc7XHJcbn1cclxuXHJcbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Rlc3QnKSB7XHJcbiAgdGhyb3cgbmV3IEVycm9yKCdUZXN0cyBtdXN0IGJlIHJ1biB3aXRoIE5PREVfRU5WPXRlc3QnKTtcclxufVxyXG4iXSwidmVyc2lvbiI6M30=