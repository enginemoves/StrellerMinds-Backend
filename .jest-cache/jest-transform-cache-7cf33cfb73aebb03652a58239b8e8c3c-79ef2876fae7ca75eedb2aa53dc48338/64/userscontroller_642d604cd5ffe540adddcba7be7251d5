151135e5cf23d8c341f97f4509bd7939
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", { value: true });
exports.Query = exports.UsersController = void 0;
exports.CustomCacheKey = CustomCacheKey;
/**
 * UsersController handles user CRUD operations and account management.
 */
const common_1 = require("@nestjs/common");
const swagger_1 = require("@nestjs/swagger");
const create_users_dto_1 = require("./dtos/create.users.dto");
const update_users_dto_1 = require("./dtos/update.users.dto");
const users_service_1 = require("./services/users.service");
const platform_express_1 = require("@nestjs/platform-express");
const rate_limiter_guard_1 = require("src/common/guards/rate-limiter.guard");
let UsersController = class UsersController {
    constructor(userService) {
        this.userService = userService;
    }
    /**
     * Create a new user
     * @param file - The file upload
     * @param createUsersDto - The user data
     * @returns The created user
     */
    async createUser(file, createUsersDto) {
        try {
            const user = await this.userService.create(createUsersDto, file);
            return user;
        }
        catch (error) {
            throw new common_1.InternalServerErrorException('Error creating user');
        }
    }
    /**
     * Update user (PATCH)
     * @param id - The user ID
     * @param updateUserDto - The updated user data
     * @returns The updated user
     */
    async patchUpdate(id, updateUserDto) {
        return await this.userService.update(id, updateUserDto);
    }
    /**
     * Delete user
     * @param id - The user ID
     * @returns Success message
     */
    async delete(id) {
        return await this.userService.delete(id);
    }
    /**
     * Request account deletion
     * @param id - The user ID
     * @returns Success message
     */
    async requestAccountDeletion(id) {
        await this.userService.requestAccountDeletion(id);
        return { message: 'Account deletion confirmation email sent' };
    }
    /**
     * Get all users
     * @returns List of users
     */
    async findAll() {
        return this.userService.findAll();
    }
    /**
     * Get user by ID
     * @param id - The user ID
     * @returns The user data
     */
    async findOne(id) {
        return this.userService.findOne(id);
    }
    /**
     * Update user (PUT)
     * @param id - The user ID
     * @param updateUserDto - The updated user data
     * @returns The updated user
     */
    async update(id, updateUserDto) {
        return this.userService.update(id, updateUserDto);
    }
};
exports.UsersController = UsersController;
__decorate([
    (0, swagger_1.ApiOperation)({ summary: 'Create a new user' }),
    (0, swagger_1.ApiBody)({ type: create_users_dto_1.CreateUsersDto }),
    (0, swagger_1.ApiResponse)({ status: 201, description: 'User created successfully.' }),
    (0, common_1.UseInterceptors)((0, platform_express_1.FileInterceptor)('file')),
    (0, common_1.UseGuards)(rate_limiter_guard_1.RateLimitGuard),
    (0, common_1.Post)('create'),
    __param(0, (0, common_1.UploadedFile)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof Express !== "undefined" && (_b = Express.Multer) !== void 0 && _b.File) === "function" ? _c : Object, typeof (_d = typeof create_users_dto_1.CreateUsersDto !== "undefined" && create_users_dto_1.CreateUsersDto) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], UsersController.prototype, "createUser", null);
__decorate([
    (0, swagger_1.ApiOperation)({ summary: 'Update user (PATCH)' }),
    (0, swagger_1.ApiParam)({ name: 'id', type: 'string', description: 'User ID' }),
    (0, swagger_1.ApiBody)({ type: update_users_dto_1.updateUsersDto }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'User updated.' }),
    (0, common_1.Patch)(':id'),
    __param(0, (0, common_1.Param)('id', common_1.ParseUUIDPipe)),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, typeof (_e = typeof update_users_dto_1.updateUsersDto !== "undefined" && update_users_dto_1.updateUsersDto) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], UsersController.prototype, "patchUpdate", null);
__decorate([
    (0, swagger_1.ApiOperation)({ summary: 'Delete user' }),
    (0, swagger_1.ApiParam)({ name: 'id', type: 'string', description: 'User ID' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'User deleted.' }),
    (0, common_1.Delete)(':id'),
    __param(0, (0, common_1.Param)('id', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], UsersController.prototype, "delete", null);
__decorate([
    (0, swagger_1.ApiOperation)({ summary: 'Request account deletion' }),
    (0, swagger_1.ApiParam)({ name: 'id', type: 'string', description: 'User ID' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Account deletion confirmation email sent.' }),
    (0, common_1.Post)(':id/request-account-deletion'),
    __param(0, (0, common_1.Param)('id')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], UsersController.prototype, "requestAccountDeletion", null);
__decorate([
    (0, swagger_1.ApiOperation)({ summary: 'Get all users' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'List of users.' }),
    (0, common_1.Get)(),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], UsersController.prototype, "findAll", null);
__decorate([
    (0, swagger_1.ApiOperation)({ summary: 'Get user by ID' }),
    (0, swagger_1.ApiParam)({ name: 'id', type: 'string', description: 'User ID' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'User found.' }),
    (0, common_1.Get)(':id'),
    CustomCacheKey((context) => {
        const request = context.switchToHttp().getRequest();
        return `user:${request.params.id}:profile`;
    }),
    __param(0, (0, common_1.Param)('id')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], UsersController.prototype, "findOne", null);
__decorate([
    (0, swagger_1.ApiOperation)({ summary: 'Update user (PUT)' }),
    (0, swagger_1.ApiParam)({ name: 'id', type: 'string', description: 'User ID' }),
    (0, swagger_1.ApiBody)({ type: update_users_dto_1.updateUsersDto }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'User updated.' }),
    (0, common_1.Put)(':id'),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, typeof (_f = typeof update_users_dto_1.updateUsersDto !== "undefined" && update_users_dto_1.updateUsersDto) === "function" ? _f : Object]),
    __metadata("design:returntype", Promise)
], UsersController.prototype, "update", null);
exports.UsersController = UsersController = __decorate([
    (0, swagger_1.ApiTags)('Users'),
    (0, swagger_1.ApiBearerAuth)(),
    (0, common_1.Controller)('users'),
    __metadata("design:paramtypes", [typeof (_a = typeof users_service_1.UsersService !== "undefined" && users_service_1.UsersService) === "function" ? _a : Object])
], UsersController);
// ✅ Custom param decorator
exports.Query = (0, common_1.createParamDecorator)((data, ctx) => {
    const request = ctx.switchToHttp().getRequest();
    return request.query;
});
// ✅ Dummy cache decorator placeholder (optional: move to separate file)
function CustomCacheKey(keyGenerator) {
    return (target, propertyKey, descriptor) => {
        // Cache logic placeholder
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFx1c2Vyc1xcdXNlcnMuY29udHJvbGxlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBNEpBLHdDQU1DO0FBbEtEOztHQUVHO0FBQ0gsMkNBZ0J3QjtBQUN4Qiw2Q0FBdUc7QUFFdkcsOERBQXlEO0FBQ3pELDhEQUF5RDtBQUN6RCw0REFBd0Q7QUFDeEQsK0RBQTJEO0FBQzNELDZFQUFzRTtBQUsvRCxJQUFNLGVBQWUsR0FBckIsTUFBTSxlQUFlO0lBQzFCLFlBQTZCLFdBQXlCO1FBQXpCLGdCQUFXLEdBQVgsV0FBVyxDQUFjO0lBQUcsQ0FBQztJQUUxRDs7Ozs7T0FLRztJQU9HLEFBQU4sS0FBSyxDQUFDLFVBQVUsQ0FDRSxJQUF5QixFQUNqQyxjQUE4QjtRQUV0QyxJQUFJLENBQUM7WUFDSCxNQUFNLElBQUksR0FBRyxNQUFNLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNqRSxPQUFPLElBQUksQ0FBQztRQUNkLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsTUFBTSxJQUFJLHFDQUE0QixDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDaEUsQ0FBQztJQUNILENBQUM7SUFFRDs7Ozs7T0FLRztJQU1VLEFBQU4sS0FBSyxDQUFDLFdBQVcsQ0FDTSxFQUFVLEVBQzlCLGFBQTZCO1FBRXJDLE9BQU8sTUFBTSxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsYUFBYSxDQUFDLENBQUM7SUFDMUQsQ0FBQztJQUVEOzs7O09BSUc7SUFLVSxBQUFOLEtBQUssQ0FBQyxNQUFNLENBQTZCLEVBQVU7UUFDeEQsT0FBTyxNQUFNLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFFRDs7OztPQUlHO0lBS0csQUFBTixLQUFLLENBQUMsc0JBQXNCLENBQWMsRUFBVTtRQUNsRCxNQUFNLElBQUksQ0FBQyxXQUFXLENBQUMsc0JBQXNCLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDbEQsT0FBTyxFQUFFLE9BQU8sRUFBRSwwQ0FBMEMsRUFBRSxDQUFDO0lBQ2pFLENBQUM7SUFFRDs7O09BR0c7SUFJRyxBQUFOLEtBQUssQ0FBQyxPQUFPO1FBQ1gsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ3BDLENBQUM7SUFFRDs7OztPQUlHO0lBU0csQUFBTixLQUFLLENBQUMsT0FBTyxDQUFjLEVBQVU7UUFDbkMsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRUQ7Ozs7O09BS0c7SUFNRyxBQUFOLEtBQUssQ0FBQyxNQUFNLENBQWMsRUFBVSxFQUFVLGFBQTZCO1FBQ3pFLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQ3BELENBQUM7Q0FDRixDQUFBO0FBbEhZLDBDQUFlO0FBZXBCO0lBTkwsSUFBQSxzQkFBWSxFQUFDLEVBQUUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLENBQUM7SUFDOUMsSUFBQSxpQkFBTyxFQUFDLEVBQUUsSUFBSSxFQUFFLGlDQUFjLEVBQUUsQ0FBQztJQUNqQyxJQUFBLHFCQUFXLEVBQUMsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFdBQVcsRUFBRSw0QkFBNEIsRUFBRSxDQUFDO0lBQ3ZFLElBQUEsd0JBQWUsRUFBQyxJQUFBLGtDQUFlLEVBQUMsTUFBTSxDQUFDLENBQUM7SUFDeEMsSUFBQSxrQkFBUyxFQUFDLG1DQUFjLENBQUM7SUFDekIsSUFBQSxhQUFJLEVBQUMsUUFBUSxDQUFDO0lBRVosV0FBQSxJQUFBLHFCQUFZLEdBQUUsQ0FBQTtJQUNkLFdBQUEsSUFBQSxhQUFJLEdBQUUsQ0FBQTs7eURBRGUsT0FBTywwQkFBUCxPQUFPLENBQUMsTUFBTSxtQkFBQyxJQUFJLG9EQUNqQixpQ0FBYyxvQkFBZCxpQ0FBYzs7aURBUXZDO0FBYVk7SUFMWixJQUFBLHNCQUFZLEVBQUMsRUFBRSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsQ0FBQztJQUNoRCxJQUFBLGtCQUFRLEVBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxDQUFDO0lBQ2hFLElBQUEsaUJBQU8sRUFBQyxFQUFFLElBQUksRUFBRSxpQ0FBYyxFQUFFLENBQUM7SUFDakMsSUFBQSxxQkFBVyxFQUFDLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsZUFBZSxFQUFFLENBQUM7SUFDMUQsSUFBQSxjQUFLLEVBQUMsS0FBSyxDQUFDO0lBRVYsV0FBQSxJQUFBLGNBQUssRUFBQyxJQUFJLEVBQUUsc0JBQWEsQ0FBQyxDQUFBO0lBQzFCLFdBQUEsSUFBQSxhQUFJLEdBQUUsQ0FBQTs7aUVBQWdCLGlDQUFjLG9CQUFkLGlDQUFjOztrREFHdEM7QUFXWTtJQUpaLElBQUEsc0JBQVksRUFBQyxFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQUUsQ0FBQztJQUN4QyxJQUFBLGtCQUFRLEVBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxDQUFDO0lBQ2hFLElBQUEscUJBQVcsRUFBQyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLGVBQWUsRUFBRSxDQUFDO0lBQzFELElBQUEsZUFBTSxFQUFDLEtBQUssQ0FBQztJQUNPLFdBQUEsSUFBQSxjQUFLLEVBQUMsSUFBSSxFQUFFLHNCQUFhLENBQUMsQ0FBQTs7Ozs2Q0FFOUM7QUFXSztJQUpMLElBQUEsc0JBQVksRUFBQyxFQUFFLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxDQUFDO0lBQ3JELElBQUEsa0JBQVEsRUFBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLENBQUM7SUFDaEUsSUFBQSxxQkFBVyxFQUFDLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsMkNBQTJDLEVBQUUsQ0FBQztJQUN0RixJQUFBLGFBQUksRUFBQyw4QkFBOEIsQ0FBQztJQUNQLFdBQUEsSUFBQSxjQUFLLEVBQUMsSUFBSSxDQUFDLENBQUE7Ozs7NkRBR3hDO0FBU0s7SUFITCxJQUFBLHNCQUFZLEVBQUMsRUFBRSxPQUFPLEVBQUUsZUFBZSxFQUFFLENBQUM7SUFDMUMsSUFBQSxxQkFBVyxFQUFDLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQztJQUMzRCxJQUFBLFlBQUcsR0FBRTs7Ozs4Q0FHTDtBQWVLO0lBUkwsSUFBQSxzQkFBWSxFQUFDLEVBQUUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLENBQUM7SUFDM0MsSUFBQSxrQkFBUSxFQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsQ0FBQztJQUNoRSxJQUFBLHFCQUFXLEVBQUMsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFdBQVcsRUFBRSxhQUFhLEVBQUUsQ0FBQztJQUN4RCxJQUFBLFlBQUcsRUFBQyxLQUFLLENBQUM7SUFDVixjQUFjLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtRQUMxQixNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsWUFBWSxFQUFFLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDcEQsT0FBTyxRQUFRLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxVQUFVLENBQUM7SUFDN0MsQ0FBQyxDQUFDO0lBQ2EsV0FBQSxJQUFBLGNBQUssRUFBQyxJQUFJLENBQUMsQ0FBQTs7Ozs4Q0FFekI7QUFhSztJQUxMLElBQUEsc0JBQVksRUFBQyxFQUFFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxDQUFDO0lBQzlDLElBQUEsa0JBQVEsRUFBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLENBQUM7SUFDaEUsSUFBQSxpQkFBTyxFQUFDLEVBQUUsSUFBSSxFQUFFLGlDQUFjLEVBQUUsQ0FBQztJQUNqQyxJQUFBLHFCQUFXLEVBQUMsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUUsQ0FBQztJQUMxRCxJQUFBLFlBQUcsRUFBQyxLQUFLLENBQUM7SUFDRyxXQUFBLElBQUEsY0FBSyxFQUFDLElBQUksQ0FBQyxDQUFBO0lBQWMsV0FBQSxJQUFBLGFBQUksR0FBRSxDQUFBOztpRUFBZ0IsaUNBQWMsb0JBQWQsaUNBQWM7OzZDQUUxRTswQkFqSFUsZUFBZTtJQUgzQixJQUFBLGlCQUFPLEVBQUMsT0FBTyxDQUFDO0lBQ2hCLElBQUEsdUJBQWEsR0FBRTtJQUNmLElBQUEsbUJBQVUsRUFBQyxPQUFPLENBQUM7eURBRXdCLDRCQUFZLG9CQUFaLDRCQUFZO0dBRDNDLGVBQWUsQ0FrSDNCO0FBRUQsMkJBQTJCO0FBQ2QsUUFBQSxLQUFLLEdBQUcsSUFBQSw2QkFBb0IsRUFDdkMsQ0FBQyxJQUFhLEVBQUUsR0FBcUIsRUFBRSxFQUFFO0lBQ3ZDLE1BQU0sT0FBTyxHQUFHLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUNoRCxPQUFPLE9BQU8sQ0FBQyxLQUFLLENBQUM7QUFDdkIsQ0FBQyxDQUNGLENBQUM7QUFFRix3RUFBd0U7QUFDeEUsU0FBZ0IsY0FBYyxDQUM1QixZQUFtRDtJQUVuRCxPQUFPLENBQUMsTUFBTSxFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQUUsRUFBRTtRQUN6QywwQkFBMEI7SUFDNUIsQ0FBQyxDQUFDO0FBQ0osQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXG9qb3NlcGhcXERvY3VtZW50c1xcU3RyZWxsZXJNaW5kcy1CYWNrZW5kXFxzcmNcXHVzZXJzXFx1c2Vycy5jb250cm9sbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBVc2Vyc0NvbnRyb2xsZXIgaGFuZGxlcyB1c2VyIENSVUQgb3BlcmF0aW9ucyBhbmQgYWNjb3VudCBtYW5hZ2VtZW50LlxyXG4gKi9cclxuaW1wb3J0IHtcclxuICBDb250cm9sbGVyLFxyXG4gIEdldCxcclxuICBQb3N0LFxyXG4gIFB1dCwgLy8g4pyFIEFkZCB0aGlzXHJcbiAgQm9keSxcclxuICBQYXJhbSxcclxuICBEZWxldGUsXHJcbiAgUGF0Y2gsXHJcbiAgUGFyc2VVVUlEUGlwZSxcclxuICBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uLFxyXG4gIFVzZUludGVyY2VwdG9ycyxcclxuICBVcGxvYWRlZEZpbGUsXHJcbiAgVXNlR3VhcmRzLFxyXG4gIGNyZWF0ZVBhcmFtRGVjb3JhdG9yLFxyXG4gIEV4ZWN1dGlvbkNvbnRleHQsXHJcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xyXG5pbXBvcnQgeyBBcGlUYWdzLCBBcGlCZWFyZXJBdXRoLCBBcGlPcGVyYXRpb24sIEFwaVJlc3BvbnNlLCBBcGlCb2R5LCBBcGlQYXJhbSB9IGZyb20gJ0BuZXN0anMvc3dhZ2dlcic7XHJcblxyXG5pbXBvcnQgeyBDcmVhdGVVc2Vyc0R0byB9IGZyb20gJy4vZHRvcy9jcmVhdGUudXNlcnMuZHRvJztcclxuaW1wb3J0IHsgdXBkYXRlVXNlcnNEdG8gfSBmcm9tICcuL2R0b3MvdXBkYXRlLnVzZXJzLmR0byc7XHJcbmltcG9ydCB7IFVzZXJzU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvdXNlcnMuc2VydmljZSc7XHJcbmltcG9ydCB7IEZpbGVJbnRlcmNlcHRvciB9IGZyb20gJ0BuZXN0anMvcGxhdGZvcm0tZXhwcmVzcyc7XHJcbmltcG9ydCB7IFJhdGVMaW1pdEd1YXJkIH0gZnJvbSAnc3JjL2NvbW1vbi9ndWFyZHMvcmF0ZS1saW1pdGVyLmd1YXJkJztcclxuXHJcbkBBcGlUYWdzKCdVc2VycycpXHJcbkBBcGlCZWFyZXJBdXRoKClcclxuQENvbnRyb2xsZXIoJ3VzZXJzJylcclxuZXhwb3J0IGNsYXNzIFVzZXJzQ29udHJvbGxlciB7XHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSB1c2VyU2VydmljZTogVXNlcnNTZXJ2aWNlKSB7fVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGUgYSBuZXcgdXNlclxyXG4gICAqIEBwYXJhbSBmaWxlIC0gVGhlIGZpbGUgdXBsb2FkXHJcbiAgICogQHBhcmFtIGNyZWF0ZVVzZXJzRHRvIC0gVGhlIHVzZXIgZGF0YVxyXG4gICAqIEByZXR1cm5zIFRoZSBjcmVhdGVkIHVzZXJcclxuICAgKi9cclxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ0NyZWF0ZSBhIG5ldyB1c2VyJyB9KVxyXG4gIEBBcGlCb2R5KHsgdHlwZTogQ3JlYXRlVXNlcnNEdG8gfSlcclxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDIwMSwgZGVzY3JpcHRpb246ICdVc2VyIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5LicgfSlcclxuICBAVXNlSW50ZXJjZXB0b3JzKEZpbGVJbnRlcmNlcHRvcignZmlsZScpKVxyXG4gIEBVc2VHdWFyZHMoUmF0ZUxpbWl0R3VhcmQpXHJcbiAgQFBvc3QoJ2NyZWF0ZScpXHJcbiAgYXN5bmMgY3JlYXRlVXNlcihcclxuICAgIEBVcGxvYWRlZEZpbGUoKSBmaWxlOiBFeHByZXNzLk11bHRlci5GaWxlLFxyXG4gICAgQEJvZHkoKSBjcmVhdGVVc2Vyc0R0bzogQ3JlYXRlVXNlcnNEdG8sXHJcbiAgKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy51c2VyU2VydmljZS5jcmVhdGUoY3JlYXRlVXNlcnNEdG8sIGZpbGUpO1xyXG4gICAgICByZXR1cm4gdXNlcjtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKCdFcnJvciBjcmVhdGluZyB1c2VyJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGUgdXNlciAoUEFUQ0gpXHJcbiAgICogQHBhcmFtIGlkIC0gVGhlIHVzZXIgSURcclxuICAgKiBAcGFyYW0gdXBkYXRlVXNlckR0byAtIFRoZSB1cGRhdGVkIHVzZXIgZGF0YVxyXG4gICAqIEByZXR1cm5zIFRoZSB1cGRhdGVkIHVzZXJcclxuICAgKi9cclxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ1VwZGF0ZSB1c2VyIChQQVRDSCknIH0pXHJcbiAgQEFwaVBhcmFtKHsgbmFtZTogJ2lkJywgdHlwZTogJ3N0cmluZycsIGRlc2NyaXB0aW9uOiAnVXNlciBJRCcgfSlcclxuICBAQXBpQm9keSh7IHR5cGU6IHVwZGF0ZVVzZXJzRHRvIH0pXHJcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiAyMDAsIGRlc2NyaXB0aW9uOiAnVXNlciB1cGRhdGVkLicgfSlcclxuICBAUGF0Y2goJzppZCcpXHJcbiAgcHVibGljIGFzeW5jIHBhdGNoVXBkYXRlKFxyXG4gICAgQFBhcmFtKCdpZCcsIFBhcnNlVVVJRFBpcGUpIGlkOiBzdHJpbmcsXHJcbiAgICBAQm9keSgpIHVwZGF0ZVVzZXJEdG86IHVwZGF0ZVVzZXJzRHRvLFxyXG4gICkge1xyXG4gICAgcmV0dXJuIGF3YWl0IHRoaXMudXNlclNlcnZpY2UudXBkYXRlKGlkLCB1cGRhdGVVc2VyRHRvKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERlbGV0ZSB1c2VyXHJcbiAgICogQHBhcmFtIGlkIC0gVGhlIHVzZXIgSURcclxuICAgKiBAcmV0dXJucyBTdWNjZXNzIG1lc3NhZ2VcclxuICAgKi9cclxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ0RlbGV0ZSB1c2VyJyB9KVxyXG4gIEBBcGlQYXJhbSh7IG5hbWU6ICdpZCcsIHR5cGU6ICdzdHJpbmcnLCBkZXNjcmlwdGlvbjogJ1VzZXIgSUQnIH0pXHJcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiAyMDAsIGRlc2NyaXB0aW9uOiAnVXNlciBkZWxldGVkLicgfSlcclxuICBARGVsZXRlKCc6aWQnKVxyXG4gIHB1YmxpYyBhc3luYyBkZWxldGUoQFBhcmFtKCdpZCcsIFBhcnNlVVVJRFBpcGUpIGlkOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBhd2FpdCB0aGlzLnVzZXJTZXJ2aWNlLmRlbGV0ZShpZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXF1ZXN0IGFjY291bnQgZGVsZXRpb25cclxuICAgKiBAcGFyYW0gaWQgLSBUaGUgdXNlciBJRFxyXG4gICAqIEByZXR1cm5zIFN1Y2Nlc3MgbWVzc2FnZVxyXG4gICAqL1xyXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnUmVxdWVzdCBhY2NvdW50IGRlbGV0aW9uJyB9KVxyXG4gIEBBcGlQYXJhbSh7IG5hbWU6ICdpZCcsIHR5cGU6ICdzdHJpbmcnLCBkZXNjcmlwdGlvbjogJ1VzZXIgSUQnIH0pXHJcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiAyMDAsIGRlc2NyaXB0aW9uOiAnQWNjb3VudCBkZWxldGlvbiBjb25maXJtYXRpb24gZW1haWwgc2VudC4nIH0pXHJcbiAgQFBvc3QoJzppZC9yZXF1ZXN0LWFjY291bnQtZGVsZXRpb24nKVxyXG4gIGFzeW5jIHJlcXVlc3RBY2NvdW50RGVsZXRpb24oQFBhcmFtKCdpZCcpIGlkOiBzdHJpbmcpIHtcclxuICAgIGF3YWl0IHRoaXMudXNlclNlcnZpY2UucmVxdWVzdEFjY291bnREZWxldGlvbihpZCk7XHJcbiAgICByZXR1cm4geyBtZXNzYWdlOiAnQWNjb3VudCBkZWxldGlvbiBjb25maXJtYXRpb24gZW1haWwgc2VudCcgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBhbGwgdXNlcnNcclxuICAgKiBAcmV0dXJucyBMaXN0IG9mIHVzZXJzXHJcbiAgICovXHJcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdHZXQgYWxsIHVzZXJzJyB9KVxyXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogMjAwLCBkZXNjcmlwdGlvbjogJ0xpc3Qgb2YgdXNlcnMuJyB9KVxyXG4gIEBHZXQoKVxyXG4gIGFzeW5jIGZpbmRBbGwoKSB7XHJcbiAgICByZXR1cm4gdGhpcy51c2VyU2VydmljZS5maW5kQWxsKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdXNlciBieSBJRFxyXG4gICAqIEBwYXJhbSBpZCAtIFRoZSB1c2VyIElEXHJcbiAgICogQHJldHVybnMgVGhlIHVzZXIgZGF0YVxyXG4gICAqL1xyXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnR2V0IHVzZXIgYnkgSUQnIH0pXHJcbiAgQEFwaVBhcmFtKHsgbmFtZTogJ2lkJywgdHlwZTogJ3N0cmluZycsIGRlc2NyaXB0aW9uOiAnVXNlciBJRCcgfSlcclxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDIwMCwgZGVzY3JpcHRpb246ICdVc2VyIGZvdW5kLicgfSlcclxuICBAR2V0KCc6aWQnKVxyXG4gIEBDdXN0b21DYWNoZUtleSgoY29udGV4dCkgPT4ge1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IGNvbnRleHQuc3dpdGNoVG9IdHRwKCkuZ2V0UmVxdWVzdCgpO1xyXG4gICAgcmV0dXJuIGB1c2VyOiR7cmVxdWVzdC5wYXJhbXMuaWR9OnByb2ZpbGVgO1xyXG4gIH0pXHJcbiAgYXN5bmMgZmluZE9uZShAUGFyYW0oJ2lkJykgaWQ6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIHRoaXMudXNlclNlcnZpY2UuZmluZE9uZShpZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGUgdXNlciAoUFVUKVxyXG4gICAqIEBwYXJhbSBpZCAtIFRoZSB1c2VyIElEXHJcbiAgICogQHBhcmFtIHVwZGF0ZVVzZXJEdG8gLSBUaGUgdXBkYXRlZCB1c2VyIGRhdGFcclxuICAgKiBAcmV0dXJucyBUaGUgdXBkYXRlZCB1c2VyXHJcbiAgICovXHJcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdVcGRhdGUgdXNlciAoUFVUKScgfSlcclxuICBAQXBpUGFyYW0oeyBuYW1lOiAnaWQnLCB0eXBlOiAnc3RyaW5nJywgZGVzY3JpcHRpb246ICdVc2VyIElEJyB9KVxyXG4gIEBBcGlCb2R5KHsgdHlwZTogdXBkYXRlVXNlcnNEdG8gfSlcclxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDIwMCwgZGVzY3JpcHRpb246ICdVc2VyIHVwZGF0ZWQuJyB9KVxyXG4gIEBQdXQoJzppZCcpXHJcbiAgYXN5bmMgdXBkYXRlKEBQYXJhbSgnaWQnKSBpZDogc3RyaW5nLCBAQm9keSgpIHVwZGF0ZVVzZXJEdG86IHVwZGF0ZVVzZXJzRHRvKSB7XHJcbiAgICByZXR1cm4gdGhpcy51c2VyU2VydmljZS51cGRhdGUoaWQsIHVwZGF0ZVVzZXJEdG8pO1xyXG4gIH1cclxufVxyXG5cclxuLy8g4pyFIEN1c3RvbSBwYXJhbSBkZWNvcmF0b3JcclxuZXhwb3J0IGNvbnN0IFF1ZXJ5ID0gY3JlYXRlUGFyYW1EZWNvcmF0b3IoXHJcbiAgKGRhdGE6IHVua25vd24sIGN0eDogRXhlY3V0aW9uQ29udGV4dCkgPT4ge1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IGN0eC5zd2l0Y2hUb0h0dHAoKS5nZXRSZXF1ZXN0KCk7XHJcbiAgICByZXR1cm4gcmVxdWVzdC5xdWVyeTtcclxuICB9LFxyXG4pO1xyXG5cclxuLy8g4pyFIER1bW15IGNhY2hlIGRlY29yYXRvciBwbGFjZWhvbGRlciAob3B0aW9uYWw6IG1vdmUgdG8gc2VwYXJhdGUgZmlsZSlcclxuZXhwb3J0IGZ1bmN0aW9uIEN1c3RvbUNhY2hlS2V5KFxyXG4gIGtleUdlbmVyYXRvcjogKGNvbnRleHQ6IEV4ZWN1dGlvbkNvbnRleHQpID0+IHN0cmluZ1xyXG4pOiBNZXRob2REZWNvcmF0b3Ige1xyXG4gIHJldHVybiAodGFyZ2V0LCBwcm9wZXJ0eUtleSwgZGVzY3JpcHRvcikgPT4ge1xyXG4gICAgLy8gQ2FjaGUgbG9naWMgcGxhY2Vob2xkZXJcclxuICB9O1xyXG59XHJcbiJdLCJ2ZXJzaW9uIjozfQ==