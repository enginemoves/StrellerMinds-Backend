c6d4de8741bae2b2e4f17ef32364004d
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const typeorm_1 = require("@nestjs/typeorm");
const credential_service_1 = require("./credential.service");
const credential_entity_1 = require("./entities/credential.entity");
const stellar_service_1 = require("../blockchain/stellar/stellar.service");
describe('CredentialService.verifyCredential', () => {
    let service;
    let repo;
    let stellar;
    beforeEach(async () => {
        repo = {
            findOne: jest.fn(),
            save: jest.fn(),
        };
        stellar = { monitorTransaction: jest.fn() };
        const module = await testing_1.Test.createTestingModule({
            providers: [
                credential_service_1.CredentialService,
                { provide: (0, typeorm_1.getRepositoryToken)(credential_entity_1.Credential), useValue: repo },
                { provide: stellar_service_1.StellarService, useValue: stellar },
            ],
        }).compile();
        service = module.get(credential_service_1.CredentialService);
    });
    it('verifies credential on Stellar and updates verificationStatus true when ledger matches blockHeight', async () => {
        const credential = {
            id: 'cred-1',
            userId: 'user-1',
            txHash: 'tx-abc',
            network: 'stellar',
            blockHeight: 123,
            verificationStatus: false,
        };
        repo.findOne.mockResolvedValue(credential);
        stellar.monitorTransaction.mockResolvedValue({ ledger: 123 });
        repo.save.mockImplementation(async (c) => c);
        const result = await service.verifyCredential('user-1', 'cred-1');
        expect(stellar.monitorTransaction).toHaveBeenCalledWith('tx-abc');
        expect(repo.save).toHaveBeenCalled();
        expect(result.verified).toBe(true);
        expect(result.credential.verificationStatus).toBe(true);
    });
    it('returns verified false if transaction not found', async () => {
        const credential = {
            id: 'cred-2',
            userId: 'user-1',
            txHash: 'tx-missing',
            network: 'stellar',
            blockHeight: 999,
            verificationStatus: false,
        };
        repo.findOne.mockResolvedValue(credential);
        stellar.monitorTransaction.mockResolvedValue(null);
        repo.save.mockImplementation(async (c) => c);
        const result = await service.verifyCredential('user-1', 'cred-2');
        expect(result.verified).toBe(false);
        expect(result.credential.verificationStatus).toBe(false);
    });
});
const blockchain_service_1 = require("../../blockchain/blockchain.service");
const credential_history_query_dto_1 = require("../dto/credential-history-query.dto");
describe('CredentialService', () => {
    let service;
    let repository;
    let blockchainService;
    const mockCredential = {
        id: '123e4567-e89b-12d3-a456-426614174000',
        userId: 'user-123',
        type: 'academic',
        name: 'Computer Science Degree',
        metadata: { university: 'MIT', year: 2023 },
        issuerId: 'issuer-123',
        issuerName: 'MIT University',
        issuedAt: new Date('2023-01-01'),
        expiresAt: new Date('2028-01-01'),
        status: 'VERIFIED',
        txHash: 'abc123txhash',
        network: 'stellar-testnet',
        blockHeight: 12345,
        verificationStatus: true,
        updatedAt: new Date(),
    };
    const mockCredentialRepository = {
        findAndCount: jest.fn(),
        findOne: jest.fn(),
        save: jest.fn(),
    };
    const mockBlockchainService = {
        verifyTransaction: jest.fn(),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                credential_service_1.CredentialService,
                {
                    provide: (0, typeorm_1.getRepositoryToken)(credential_entity_1.Credential),
                    useValue: mockCredentialRepository,
                },
                {
                    provide: blockchain_service_1.BlockchainService,
                    useValue: mockBlockchainService,
                },
            ],
        }).compile();
        service = module.get(credential_service_1.CredentialService);
        repository = module.get((0, typeorm_1.getRepositoryToken)(credential_entity_1.Credential));
        blockchainService = module.get(blockchain_service_1.BlockchainService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    describe('getUserCredentialHistory', () => {
        it('should return paginated credential history for a user', async () => {
            const queryParams = {
                page: 1,
                limit: 10,
                status: credential_history_query_dto_1.CredentialStatus.ALL,
            };
            mockCredentialRepository.findAndCount.mockResolvedValue([[mockCredential], 1]);
            const result = await service.getUserCredentialHistory('user-123', queryParams);
            expect(mockCredentialRepository.findAndCount).toHaveBeenCalled();
            expect(result).toHaveProperty('data');
            expect(result).toHaveProperty('meta');
            expect(result.meta).toEqual({
                page: 1,
                limit: 10,
                totalItems: 1,
                totalPages: 1,
            });
            expect(result.data).toHaveLength(1);
            expect(result.data[0]).toHaveProperty('id', mockCredential.id);
        });
        it('should apply filters correctly when provided', async () => {
            const queryParams = {
                page: 1,
                limit: 10,
                credentialType: 'academic',
                startDate: new Date('2022-01-01'),
                endDate: new Date('2023-12-31'),
                status: credential_history_query_dto_1.CredentialStatus.VERIFIED,
            };
            mockCredentialRepository.findAndCount.mockResolvedValue([[mockCredential], 1]);
            await service.getUserCredentialHistory('user-123', queryParams);
            expect(mockCredentialRepository.findAndCount).toHaveBeenCalledWith(expect.objectContaining({
                where: expect.objectContaining({
                    userId: 'user-123',
                    type: 'academic',
                    status: 'VERIFIED',
                }),
            }));
        });
    });
    describe('verifyCredential', () => {
        it('should verify a credential and update its status', async () => {
            mockCredentialRepository.findOne.mockResolvedValue(mockCredential);
            mockBlockchainService.verifyTransaction.mockResolvedValue({ verified: true });
            mockCredentialRepository.save.mockResolvedValue({
                ...mockCredential,
                verificationStatus: true,
            });
            const result = await service.verifyCredential('user-123', mockCredential.id);
            expect(mockCredentialRepository.findOne).toHaveBeenCalledWith({
                where: { id: mockCredential.id, userId: 'user-123' },
            });
            expect(mockBlockchainService.verifyTransaction).toHaveBeenCalledWith(mockCredential.txHash);
            expect(mockCredentialRepository.save).toHaveBeenCalled();
            expect(result).toHaveProperty('verified', true);
            expect(result).toHaveProperty('credential');
        });
        it('should throw an error when credential is not found', async () => {
            mockCredentialRepository.findOne.mockResolvedValue(null);
            await expect(service.verifyCredential('user-123', 'non-existent-id')).rejects.toThrow();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxjcmVkZW50aWFsXFxjcmVkZW50aWFsLnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCw2Q0FBcUQ7QUFFckQsNkRBQXlEO0FBQ3pELG9FQUEwRDtBQUMxRCwyRUFBdUU7QUFFdkUsUUFBUSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtJQUNsRCxJQUFJLE9BQTBCLENBQUM7SUFDL0IsSUFBSSxJQUF5QyxDQUFDO0lBQzlDLElBQUksT0FBMEMsQ0FBQztJQUUvQyxVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsSUFBSSxHQUFHO1lBQ0wsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDbEIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDVCxDQUFDO1FBRVQsT0FBTyxHQUFHLEVBQUUsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7UUFFNUMsTUFBTSxNQUFNLEdBQWtCLE1BQU0sY0FBSSxDQUFDLG1CQUFtQixDQUFDO1lBQzNELFNBQVMsRUFBRTtnQkFDVCxzQ0FBaUI7Z0JBQ2pCLEVBQUUsT0FBTyxFQUFFLElBQUEsNEJBQWtCLEVBQUMsOEJBQVUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUU7Z0JBQzNELEVBQUUsT0FBTyxFQUFFLGdDQUFjLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRTthQUMvQztTQUNGLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUViLE9BQU8sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLHNDQUFpQixDQUFDLENBQUM7SUFDMUMsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsb0dBQW9HLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDbEgsTUFBTSxVQUFVLEdBQXdCO1lBQ3RDLEVBQUUsRUFBRSxRQUFRO1lBQ1osTUFBTSxFQUFFLFFBQVE7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c1xcb2pvc2VwaFxcRG9jdW1lbnRzXFxTdHJlbGxlck1pbmRzLUJhY2tlbmRcXHNyY1xcY3JlZGVudGlhbFxcY3JlZGVudGlhbC5zZXJ2aWNlLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XHJcbmltcG9ydCB7IGdldFJlcG9zaXRvcnlUb2tlbiB9IGZyb20gJ0BuZXN0anMvdHlwZW9ybSc7XHJcbmltcG9ydCB7IFJlcG9zaXRvcnkgfSBmcm9tICd0eXBlb3JtJztcclxuaW1wb3J0IHsgQ3JlZGVudGlhbFNlcnZpY2UgfSBmcm9tICcuL2NyZWRlbnRpYWwuc2VydmljZSc7XHJcbmltcG9ydCB7IENyZWRlbnRpYWwgfSBmcm9tICcuL2VudGl0aWVzL2NyZWRlbnRpYWwuZW50aXR5JztcclxuaW1wb3J0IHsgU3RlbGxhclNlcnZpY2UgfSBmcm9tICcuLi9ibG9ja2NoYWluL3N0ZWxsYXIvc3RlbGxhci5zZXJ2aWNlJztcclxuXHJcbmRlc2NyaWJlKCdDcmVkZW50aWFsU2VydmljZS52ZXJpZnlDcmVkZW50aWFsJywgKCkgPT4ge1xyXG4gIGxldCBzZXJ2aWNlOiBDcmVkZW50aWFsU2VydmljZTtcclxuICBsZXQgcmVwbzogamVzdC5Nb2NrZWQ8UmVwb3NpdG9yeTxDcmVkZW50aWFsPj47XHJcbiAgbGV0IHN0ZWxsYXI6IHsgbW9uaXRvclRyYW5zYWN0aW9uOiBqZXN0Lk1vY2sgfTtcclxuXHJcbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XHJcbiAgICByZXBvID0ge1xyXG4gICAgICBmaW5kT25lOiBqZXN0LmZuKCksXHJcbiAgICAgIHNhdmU6IGplc3QuZm4oKSxcclxuICAgIH0gYXMgYW55O1xyXG5cclxuICAgIHN0ZWxsYXIgPSB7IG1vbml0b3JUcmFuc2FjdGlvbjogamVzdC5mbigpIH07XHJcblxyXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcclxuICAgICAgcHJvdmlkZXJzOiBbXHJcbiAgICAgICAgQ3JlZGVudGlhbFNlcnZpY2UsXHJcbiAgICAgICAgeyBwcm92aWRlOiBnZXRSZXBvc2l0b3J5VG9rZW4oQ3JlZGVudGlhbCksIHVzZVZhbHVlOiByZXBvIH0sXHJcbiAgICAgICAgeyBwcm92aWRlOiBTdGVsbGFyU2VydmljZSwgdXNlVmFsdWU6IHN0ZWxsYXIgfSxcclxuICAgICAgXSxcclxuICAgIH0pLmNvbXBpbGUoKTtcclxuXHJcbiAgICBzZXJ2aWNlID0gbW9kdWxlLmdldChDcmVkZW50aWFsU2VydmljZSk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCd2ZXJpZmllcyBjcmVkZW50aWFsIG9uIFN0ZWxsYXIgYW5kIHVwZGF0ZXMgdmVyaWZpY2F0aW9uU3RhdHVzIHRydWUgd2hlbiBsZWRnZXIgbWF0Y2hlcyBibG9ja0hlaWdodCcsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IGNyZWRlbnRpYWw6IFBhcnRpYWw8Q3JlZGVudGlhbD4gPSB7XHJcbiAgICAgIGlkOiAnY3JlZC0xJyxcclxuICAgICAgdXNlcklkOiAndXNlci0xJyxcclxuICAgICAgdHhIYXNoOiAndHgtYWJjJyxcclxuICAgICAgbmV0d29yazogJ3N0ZWxsYXInLFxyXG4gICAgICBibG9ja0hlaWdodDogMTIzLFxyXG4gICAgICB2ZXJpZmljYXRpb25TdGF0dXM6IGZhbHNlLFxyXG4gICAgfTtcclxuICAgIHJlcG8uZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShjcmVkZW50aWFsIGFzIENyZWRlbnRpYWwpO1xyXG4gICAgc3RlbGxhci5tb25pdG9yVHJhbnNhY3Rpb24ubW9ja1Jlc29sdmVkVmFsdWUoeyBsZWRnZXI6IDEyMyB9KTtcclxuICAgIHJlcG8uc2F2ZS5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGM6IENyZWRlbnRpYWwpID0+IGMpO1xyXG5cclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudmVyaWZ5Q3JlZGVudGlhbCgndXNlci0xJywgJ2NyZWQtMScpO1xyXG5cclxuICAgIGV4cGVjdChzdGVsbGFyLm1vbml0b3JUcmFuc2FjdGlvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3R4LWFiYycpO1xyXG4gICAgZXhwZWN0KHJlcG8uc2F2ZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgZXhwZWN0KHJlc3VsdC52ZXJpZmllZCkudG9CZSh0cnVlKTtcclxuICAgIGV4cGVjdChyZXN1bHQuY3JlZGVudGlhbC52ZXJpZmljYXRpb25TdGF0dXMpLnRvQmUodHJ1ZSk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdyZXR1cm5zIHZlcmlmaWVkIGZhbHNlIGlmIHRyYW5zYWN0aW9uIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IGNyZWRlbnRpYWw6IFBhcnRpYWw8Q3JlZGVudGlhbD4gPSB7XHJcbiAgICAgIGlkOiAnY3JlZC0yJyxcclxuICAgICAgdXNlcklkOiAndXNlci0xJyxcclxuICAgICAgdHhIYXNoOiAndHgtbWlzc2luZycsXHJcbiAgICAgIG5ldHdvcms6ICdzdGVsbGFyJyxcclxuICAgICAgYmxvY2tIZWlnaHQ6IDk5OSxcclxuICAgICAgdmVyaWZpY2F0aW9uU3RhdHVzOiBmYWxzZSxcclxuICAgIH07XHJcbiAgICByZXBvLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUoY3JlZGVudGlhbCBhcyBDcmVkZW50aWFsKTtcclxuICAgIHN0ZWxsYXIubW9uaXRvclRyYW5zYWN0aW9uLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xyXG4gICAgcmVwby5zYXZlLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoYzogQ3JlZGVudGlhbCkgPT4gYyk7XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS52ZXJpZnlDcmVkZW50aWFsKCd1c2VyLTEnLCAnY3JlZC0yJyk7XHJcblxyXG4gICAgZXhwZWN0KHJlc3VsdC52ZXJpZmllZCkudG9CZShmYWxzZSk7XHJcbiAgICBleHBlY3QocmVzdWx0LmNyZWRlbnRpYWwudmVyaWZpY2F0aW9uU3RhdHVzKS50b0JlKGZhbHNlKTtcclxuICB9KTtcclxufSk7XHJcblxyXG5pbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcclxuaW1wb3J0IHsgZ2V0UmVwb3NpdG9yeVRva2VuIH0gZnJvbSAnQG5lc3Rqcy90eXBlb3JtJztcclxuaW1wb3J0IHsgUmVwb3NpdG9yeSB9IGZyb20gJ3R5cGVvcm0nO1xyXG5pbXBvcnQgeyBDcmVkZW50aWFsU2VydmljZSB9IGZyb20gJy4uL2NyZWRlbnRpYWwuc2VydmljZSc7XHJcbmltcG9ydCB7IENyZWRlbnRpYWwgfSBmcm9tICcuLi9lbnRpdGllcy9jcmVkZW50aWFsLmVudGl0eSc7XHJcbmltcG9ydCB7IEJsb2NrY2hhaW5TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vYmxvY2tjaGFpbi9ibG9ja2NoYWluLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBDcmVkZW50aWFsU3RhdHVzIH0gZnJvbSAnLi4vZHRvL2NyZWRlbnRpYWwtaGlzdG9yeS1xdWVyeS5kdG8nO1xyXG5cclxuZGVzY3JpYmUoJ0NyZWRlbnRpYWxTZXJ2aWNlJywgKCkgPT4ge1xyXG4gIGxldCBzZXJ2aWNlOiBDcmVkZW50aWFsU2VydmljZTtcclxuICBsZXQgcmVwb3NpdG9yeTogUmVwb3NpdG9yeTxDcmVkZW50aWFsPjtcclxuICBsZXQgYmxvY2tjaGFpblNlcnZpY2U6IEJsb2NrY2hhaW5TZXJ2aWNlO1xyXG5cclxuICBjb25zdCBtb2NrQ3JlZGVudGlhbCA9IHtcclxuICAgIGlkOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAwJyxcclxuICAgIHVzZXJJZDogJ3VzZXItMTIzJyxcclxuICAgIHR5cGU6ICdhY2FkZW1pYycsXHJcbiAgICBuYW1lOiAnQ29tcHV0ZXIgU2NpZW5jZSBEZWdyZWUnLFxyXG4gICAgbWV0YWRhdGE6IHsgdW5pdmVyc2l0eTogJ01JVCcsIHllYXI6IDIwMjMgfSxcclxuICAgIGlzc3VlcklkOiAnaXNzdWVyLTEyMycsXHJcbiAgICBpc3N1ZXJOYW1lOiAnTUlUIFVuaXZlcnNpdHknLFxyXG4gICAgaXNzdWVkQXQ6IG5ldyBEYXRlKCcyMDIzLTAxLTAxJyksXHJcbiAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKCcyMDI4LTAxLTAxJyksXHJcbiAgICBzdGF0dXM6ICdWRVJJRklFRCcsXHJcbiAgICB0eEhhc2g6ICdhYmMxMjN0eGhhc2gnLFxyXG4gICAgbmV0d29yazogJ3N0ZWxsYXItdGVzdG5ldCcsXHJcbiAgICBibG9ja0hlaWdodDogMTIzNDUsXHJcbiAgICB2ZXJpZmljYXRpb25TdGF0dXM6IHRydWUsXHJcbiAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgfTtcclxuXHJcbiAgY29uc3QgbW9ja0NyZWRlbnRpYWxSZXBvc2l0b3J5ID0ge1xyXG4gICAgZmluZEFuZENvdW50OiBqZXN0LmZuKCksXHJcbiAgICBmaW5kT25lOiBqZXN0LmZuKCksXHJcbiAgICBzYXZlOiBqZXN0LmZuKCksXHJcbiAgfTtcclxuXHJcbiAgY29uc3QgbW9ja0Jsb2NrY2hhaW5TZXJ2aWNlID0ge1xyXG4gICAgdmVyaWZ5VHJhbnNhY3Rpb246IGplc3QuZm4oKSxcclxuICB9O1xyXG5cclxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XHJcbiAgICAgIHByb3ZpZGVyczogW1xyXG4gICAgICAgIENyZWRlbnRpYWxTZXJ2aWNlLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHByb3ZpZGU6IGdldFJlcG9zaXRvcnlUb2tlbihDcmVkZW50aWFsKSxcclxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrQ3JlZGVudGlhbFJlcG9zaXRvcnksXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBwcm92aWRlOiBCbG9ja2NoYWluU2VydmljZSxcclxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrQmxvY2tjaGFpblNlcnZpY2UsXHJcbiAgICAgICAgfSxcclxuICAgICAgXSxcclxuICAgIH0pLmNvbXBpbGUoKTtcclxuXHJcbiAgICBzZXJ2aWNlID0gbW9kdWxlLmdldDxDcmVkZW50aWFsU2VydmljZT4oQ3JlZGVudGlhbFNlcnZpY2UpO1xyXG4gICAgcmVwb3NpdG9yeSA9IG1vZHVsZS5nZXQ8UmVwb3NpdG9yeTxDcmVkZW50aWFsPj4oZ2V0UmVwb3NpdG9yeVRva2VuKENyZWRlbnRpYWwpKTtcclxuICAgIGJsb2NrY2hhaW5TZXJ2aWNlID0gbW9kdWxlLmdldDxCbG9ja2NoYWluU2VydmljZT4oQmxvY2tjaGFpblNlcnZpY2UpO1xyXG4gIH0pO1xyXG5cclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzaG91bGQgYmUgZGVmaW5lZCcsICgpID0+IHtcclxuICAgIGV4cGVjdChzZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0VXNlckNyZWRlbnRpYWxIaXN0b3J5JywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcGFnaW5hdGVkIGNyZWRlbnRpYWwgaGlzdG9yeSBmb3IgYSB1c2VyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBxdWVyeVBhcmFtcyA9IHtcclxuICAgICAgICBwYWdlOiAxLFxyXG4gICAgICAgIGxpbWl0OiAxMCxcclxuICAgICAgICBzdGF0dXM6IENyZWRlbnRpYWxTdGF0dXMuQUxMLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9ja0NyZWRlbnRpYWxSZXBvc2l0b3J5LmZpbmRBbmRDb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZShbW21vY2tDcmVkZW50aWFsXSwgMV0pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXRVc2VyQ3JlZGVudGlhbEhpc3RvcnkoJ3VzZXItMTIzJywgcXVlcnlQYXJhbXMpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tDcmVkZW50aWFsUmVwb3NpdG9yeS5maW5kQW5kQ291bnQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2RhdGEnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ21ldGEnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5tZXRhKS50b0VxdWFsKHtcclxuICAgICAgICBwYWdlOiAxLFxyXG4gICAgICAgIGxpbWl0OiAxMCxcclxuICAgICAgICB0b3RhbEl0ZW1zOiAxLFxyXG4gICAgICAgIHRvdGFsUGFnZXM6IDEsXHJcbiAgICAgIH0pO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRhdGEpLnRvSGF2ZUxlbmd0aCgxKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhWzBdKS50b0hhdmVQcm9wZXJ0eSgnaWQnLCBtb2NrQ3JlZGVudGlhbC5pZCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGFwcGx5IGZpbHRlcnMgY29ycmVjdGx5IHdoZW4gcHJvdmlkZWQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHF1ZXJ5UGFyYW1zID0ge1xyXG4gICAgICAgIHBhZ2U6IDEsXHJcbiAgICAgICAgbGltaXQ6IDEwLFxyXG4gICAgICAgIGNyZWRlbnRpYWxUeXBlOiAnYWNhZGVtaWMnLFxyXG4gICAgICAgIHN0YXJ0RGF0ZTogbmV3IERhdGUoJzIwMjItMDEtMDEnKSxcclxuICAgICAgICBlbmREYXRlOiBuZXcgRGF0ZSgnMjAyMy0xMi0zMScpLFxyXG4gICAgICAgIHN0YXR1czogQ3JlZGVudGlhbFN0YXR1cy5WRVJJRklFRCxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1vY2tDcmVkZW50aWFsUmVwb3NpdG9yeS5maW5kQW5kQ291bnQubW9ja1Jlc29sdmVkVmFsdWUoW1ttb2NrQ3JlZGVudGlhbF0sIDFdKTtcclxuXHJcbiAgICAgIGF3YWl0IHNlcnZpY2UuZ2V0VXNlckNyZWRlbnRpYWxIaXN0b3J5KCd1c2VyLTEyMycsIHF1ZXJ5UGFyYW1zKTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrQ3JlZGVudGlhbFJlcG9zaXRvcnkuZmluZEFuZENvdW50KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICB3aGVyZTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgICB1c2VySWQ6ICd1c2VyLTEyMycsXHJcbiAgICAgICAgICAgIHR5cGU6ICdhY2FkZW1pYycsXHJcbiAgICAgICAgICAgIHN0YXR1czogJ1ZFUklGSUVEJyxcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgIH0pLFxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCd2ZXJpZnlDcmVkZW50aWFsJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCB2ZXJpZnkgYSBjcmVkZW50aWFsIGFuZCB1cGRhdGUgaXRzIHN0YXR1cycsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja0NyZWRlbnRpYWxSZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NyZWRlbnRpYWwpO1xyXG4gICAgICBtb2NrQmxvY2tjaGFpblNlcnZpY2UudmVyaWZ5VHJhbnNhY3Rpb24ubW9ja1Jlc29sdmVkVmFsdWUoeyB2ZXJpZmllZDogdHJ1ZSB9KTtcclxuICAgICAgbW9ja0NyZWRlbnRpYWxSZXBvc2l0b3J5LnNhdmUubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICAgIC4uLm1vY2tDcmVkZW50aWFsLFxyXG4gICAgICAgIHZlcmlmaWNhdGlvblN0YXR1czogdHJ1ZSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnZlcmlmeUNyZWRlbnRpYWwoJ3VzZXItMTIzJywgbW9ja0NyZWRlbnRpYWwuaWQpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tDcmVkZW50aWFsUmVwb3NpdG9yeS5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgd2hlcmU6IHsgaWQ6IG1vY2tDcmVkZW50aWFsLmlkLCB1c2VySWQ6ICd1c2VyLTEyMycgfSxcclxuICAgICAgfSk7XHJcbiAgICAgIGV4cGVjdChtb2NrQmxvY2tjaGFpblNlcnZpY2UudmVyaWZ5VHJhbnNhY3Rpb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tDcmVkZW50aWFsLnR4SGFzaCk7XHJcbiAgICAgIGV4cGVjdChtb2NrQ3JlZGVudGlhbFJlcG9zaXRvcnkuc2F2ZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgndmVyaWZpZWQnLCB0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2NyZWRlbnRpYWwnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdGhyb3cgYW4gZXJyb3Igd2hlbiBjcmVkZW50aWFsIGlzIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja0NyZWRlbnRpYWxSZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XHJcblxyXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS52ZXJpZnlDcmVkZW50aWFsKCd1c2VyLTEyMycsICdub24tZXhpc3RlbnQtaWQnKSkucmVqZWN0cy50b1Rocm93KCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7Il0sInZlcnNpb24iOjN9