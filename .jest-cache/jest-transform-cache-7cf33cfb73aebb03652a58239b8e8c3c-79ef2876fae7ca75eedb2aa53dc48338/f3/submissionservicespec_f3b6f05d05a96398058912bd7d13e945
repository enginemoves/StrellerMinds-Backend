1343fc725cb796e618e00b504d5aa648
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const submission_service_1 = require("./provider/submission.service");
const typeorm_1 = require("@nestjs/typeorm");
const submission_entity_1 = require("./submission.entity");
const common_1 = require("@nestjs/common");
describe('SubmissionService', () => {
    let service;
    let repo;
    const mockRepo = {
        create: jest.fn(),
        save: jest.fn(),
        findOne: jest.fn(),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                submission_service_1.SubmissionService,
                {
                    provide: (0, typeorm_1.getRepositoryToken)(submission_entity_1.Submission),
                    useValue: mockRepo,
                },
            ],
        }).compile();
        service = module.get(submission_service_1.SubmissionService);
        repo = module.get((0, typeorm_1.getRepositoryToken)(submission_entity_1.Submission));
    });
    afterEach(() => jest.clearAllMocks());
    describe('create', () => {
        it('should create and save a submission with a file', async () => {
            const dto = {
                studentId: 'uuid-student',
                assignmentId: 'uuid-assignment',
                textContent: 'My answer',
            };
            const file = { path: 'uploads/file.pdf' };
            const submission = { id: '1', ...dto, fileUrl: file.path, status: 'submitted' };
            mockRepo.create.mockReturnValue(submission);
            mockRepo.save.mockResolvedValue(submission);
            const result = await service.create(dto, file);
            expect(result).toEqual(submission);
        });
        it('should create a submission without a file', async () => {
            const dto = {
                studentId: 'uuid-student',
                assignmentId: 'uuid-assignment',
            };
            const submission = { id: '1', ...dto, fileUrl: null, status: 'submitted' };
            mockRepo.create.mockReturnValue(submission);
            mockRepo.save.mockResolvedValue(submission);
            const result = await service.create(dto);
            expect(result).toEqual(submission);
        });
    });
    describe('findOne', () => {
        it('should return a submission if found', async () => {
            const submission = { id: '1', studentId: 'uuid', assignmentId: 'uuid' };
            mockRepo.findOne.mockResolvedValue(submission);
            const result = await service.findOne('1');
            expect(result).toEqual(submission);
        });
        it('should throw NotFoundException if not found', async () => {
            mockRepo.findOne.mockResolvedValue(null);
            await expect(service.findOne('123')).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('update', () => {
        it('should update submission if within time limit', async () => {
            const submittedAt = new Date(Date.now() - 1000 * 60 * 60 * 2); // 2 hours ago
            const submission = {
                id: '1',
                studentId: 'uuid',
                assignmentId: 'uuid',
                submittedAt,
            };
            mockRepo.findOne.mockResolvedValue(submission);
            mockRepo.save.mockResolvedValue({ ...submission, textContent: 'Updated' });
            const result = await service.update('1', { textContent: 'Updated' });
            expect(result.textContent).toBe('Updated');
        });
        it('should throw BadRequestException if past 6 hours', async () => {
            const submittedAt = new Date(Date.now() - 1000 * 60 * 60 * 7); // 7 hours ago
            const submission = {
                id: '1',
                studentId: 'uuid',
                assignmentId: 'uuid',
                submittedAt,
            };
            mockRepo.findOne.mockResolvedValue(submission);
            await expect(service.update('1', { textContent: 'Late' })).rejects.toThrow(common_1.BadRequestException);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxzdWJtaXNzaW9uXFxzdWJtaXNzaW9uLnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCxzRUFBa0U7QUFDbEUsNkNBQXFEO0FBQ3JELDJEQUFpRDtBQUVqRCwyQ0FBd0U7QUFHeEUsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtJQUNqQyxJQUFJLE9BQTBCLENBQUM7SUFDL0IsSUFBSSxJQUE0QixDQUFDO0lBRWpDLE1BQU0sUUFBUSxHQUFHO1FBQ2YsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDakIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNuQixDQUFDO0lBRUYsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxTQUFTLEVBQUU7Z0JBQ1Qsc0NBQWlCO2dCQUNqQjtvQkFDRSxPQUFPLEVBQUUsSUFBQSw0QkFBa0IsRUFBQyw4QkFBVSxDQUFDO29CQUN2QyxRQUFRLEVBQUUsUUFBUTtpQkFDbkI7YUFDRjtTQUNGLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUViLE9BQU8sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFvQixzQ0FBaUIsQ0FBQyxDQUFDO1FBQzNELElBQUksR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUEsNEJBQWtCLEVBQUMsOEJBQVUsQ0FBQyxDQUFDLENBQUM7SUFDcEQsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUM7SUFFdEMsUUFBUSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUU7UUFDdEIsRUFBRSxDQUFDLGlEQUFpRCxFQUFF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QyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXG9qb3NlcGhcXERvY3VtZW50c1xcU3RyZWxsZXJNaW5kcy1CYWNrZW5kXFxzcmNcXHN1Ym1pc3Npb25cXHN1Ym1pc3Npb24uc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xyXG5pbXBvcnQgeyBTdWJtaXNzaW9uU2VydmljZSB9IGZyb20gJy4vcHJvdmlkZXIvc3VibWlzc2lvbi5zZXJ2aWNlJztcclxuaW1wb3J0IHsgZ2V0UmVwb3NpdG9yeVRva2VuIH0gZnJvbSAnQG5lc3Rqcy90eXBlb3JtJztcclxuaW1wb3J0IHsgU3VibWlzc2lvbiB9IGZyb20gJy4vc3VibWlzc2lvbi5lbnRpdHknO1xyXG5pbXBvcnQgeyBSZXBvc2l0b3J5IH0gZnJvbSAndHlwZW9ybSc7XHJcbmltcG9ydCB7IE5vdEZvdW5kRXhjZXB0aW9uLCBCYWRSZXF1ZXN0RXhjZXB0aW9uIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xyXG5pbXBvcnQgeyBDcmVhdGVTdWJtaXNzaW9uRHRvIH0gZnJvbSAnLi9kdG9zL2NyZWF0ZVN1Ym1pc3Npb24uZHRvJztcclxuXHJcbmRlc2NyaWJlKCdTdWJtaXNzaW9uU2VydmljZScsICgpID0+IHtcclxuICBsZXQgc2VydmljZTogU3VibWlzc2lvblNlcnZpY2U7XHJcbiAgbGV0IHJlcG86IFJlcG9zaXRvcnk8U3VibWlzc2lvbj47XHJcblxyXG4gIGNvbnN0IG1vY2tSZXBvID0ge1xyXG4gICAgY3JlYXRlOiBqZXN0LmZuKCksXHJcbiAgICBzYXZlOiBqZXN0LmZuKCksXHJcbiAgICBmaW5kT25lOiBqZXN0LmZuKCksXHJcbiAgfTtcclxuXHJcbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xyXG4gICAgICBwcm92aWRlcnM6IFtcclxuICAgICAgICBTdWJtaXNzaW9uU2VydmljZSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBwcm92aWRlOiBnZXRSZXBvc2l0b3J5VG9rZW4oU3VibWlzc2lvbiksXHJcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja1JlcG8sXHJcbiAgICAgICAgfSxcclxuICAgICAgXSxcclxuICAgIH0pLmNvbXBpbGUoKTtcclxuXHJcbiAgICBzZXJ2aWNlID0gbW9kdWxlLmdldDxTdWJtaXNzaW9uU2VydmljZT4oU3VibWlzc2lvblNlcnZpY2UpO1xyXG4gICAgcmVwbyA9IG1vZHVsZS5nZXQoZ2V0UmVwb3NpdG9yeVRva2VuKFN1Ym1pc3Npb24pKTtcclxuICB9KTtcclxuXHJcbiAgYWZ0ZXJFYWNoKCgpID0+IGplc3QuY2xlYXJBbGxNb2NrcygpKTtcclxuXHJcbiAgZGVzY3JpYmUoJ2NyZWF0ZScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGFuZCBzYXZlIGEgc3VibWlzc2lvbiB3aXRoIGEgZmlsZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZHRvOiBDcmVhdGVTdWJtaXNzaW9uRHRvID0ge1xyXG4gICAgICAgIHN0dWRlbnRJZDogJ3V1aWQtc3R1ZGVudCcsXHJcbiAgICAgICAgYXNzaWdubWVudElkOiAndXVpZC1hc3NpZ25tZW50JyxcclxuICAgICAgICB0ZXh0Q29udGVudDogJ015IGFuc3dlcicsXHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IGZpbGUgPSB7IHBhdGg6ICd1cGxvYWRzL2ZpbGUucGRmJyB9IGFzIEV4cHJlc3MuTXVsdGVyLkZpbGU7XHJcbiAgICAgIGNvbnN0IHN1Ym1pc3Npb24gPSB7IGlkOiAnMScsIC4uLmR0bywgZmlsZVVybDogZmlsZS5wYXRoLCBzdGF0dXM6ICdzdWJtaXR0ZWQnIH07XHJcblxyXG4gICAgICBtb2NrUmVwby5jcmVhdGUubW9ja1JldHVyblZhbHVlKHN1Ym1pc3Npb24pO1xyXG4gICAgICBtb2NrUmVwby5zYXZlLm1vY2tSZXNvbHZlZFZhbHVlKHN1Ym1pc3Npb24pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jcmVhdGUoZHRvLCBmaWxlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChzdWJtaXNzaW9uKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgc3VibWlzc2lvbiB3aXRob3V0IGEgZmlsZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZHRvOiBDcmVhdGVTdWJtaXNzaW9uRHRvID0ge1xyXG4gICAgICAgIHN0dWRlbnRJZDogJ3V1aWQtc3R1ZGVudCcsXHJcbiAgICAgICAgYXNzaWdubWVudElkOiAndXVpZC1hc3NpZ25tZW50JyxcclxuICAgICAgfTtcclxuICAgICAgY29uc3Qgc3VibWlzc2lvbiA9IHsgaWQ6ICcxJywgLi4uZHRvLCBmaWxlVXJsOiBudWxsLCBzdGF0dXM6ICdzdWJtaXR0ZWQnIH07XHJcblxyXG4gICAgICBtb2NrUmVwby5jcmVhdGUubW9ja1JldHVyblZhbHVlKHN1Ym1pc3Npb24pO1xyXG4gICAgICBtb2NrUmVwby5zYXZlLm1vY2tSZXNvbHZlZFZhbHVlKHN1Ym1pc3Npb24pO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jcmVhdGUoZHRvKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChzdWJtaXNzaW9uKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZmluZE9uZScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGEgc3VibWlzc2lvbiBpZiBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qgc3VibWlzc2lvbiA9IHsgaWQ6ICcxJywgc3R1ZGVudElkOiAndXVpZCcsIGFzc2lnbm1lbnRJZDogJ3V1aWQnIH07XHJcbiAgICAgIG1vY2tSZXBvLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUoc3VibWlzc2lvbik7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRPbmUoJzEnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChzdWJtaXNzaW9uKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gaWYgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBtb2NrUmVwby5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xyXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5maW5kT25lKCcxMjMnKSkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgndXBkYXRlJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgc3VibWlzc2lvbiBpZiB3aXRoaW4gdGltZSBsaW1pdCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qgc3VibWl0dGVkQXQgPSBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMTAwMCAqIDYwICogNjAgKiAyKTsgLy8gMiBob3VycyBhZ29cclxuICAgICAgY29uc3Qgc3VibWlzc2lvbiA9IHtcclxuICAgICAgICBpZDogJzEnLFxyXG4gICAgICAgIHN0dWRlbnRJZDogJ3V1aWQnLFxyXG4gICAgICAgIGFzc2lnbm1lbnRJZDogJ3V1aWQnLFxyXG4gICAgICAgIHN1Ym1pdHRlZEF0LFxyXG4gICAgICB9O1xyXG4gICAgICBtb2NrUmVwby5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKHN1Ym1pc3Npb24pO1xyXG4gICAgICBtb2NrUmVwby5zYXZlLm1vY2tSZXNvbHZlZFZhbHVlKHsgLi4uc3VibWlzc2lvbiwgdGV4dENvbnRlbnQ6ICdVcGRhdGVkJyB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudXBkYXRlKCcxJywgeyB0ZXh0Q29udGVudDogJ1VwZGF0ZWQnIH0pO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnRleHRDb250ZW50KS50b0JlKCdVcGRhdGVkJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHRocm93IEJhZFJlcXVlc3RFeGNlcHRpb24gaWYgcGFzdCA2IGhvdXJzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzdWJtaXR0ZWRBdCA9IG5ldyBEYXRlKERhdGUubm93KCkgLSAxMDAwICogNjAgKiA2MCAqIDcpOyAvLyA3IGhvdXJzIGFnb1xyXG4gICAgICBjb25zdCBzdWJtaXNzaW9uID0ge1xyXG4gICAgICAgIGlkOiAnMScsXHJcbiAgICAgICAgc3R1ZGVudElkOiAndXVpZCcsXHJcbiAgICAgICAgYXNzaWdubWVudElkOiAndXVpZCcsXHJcbiAgICAgICAgc3VibWl0dGVkQXQsXHJcbiAgICAgIH07XHJcbiAgICAgIG1vY2tSZXBvLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUoc3VibWlzc2lvbik7XHJcblxyXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS51cGRhdGUoJzEnLCB7IHRleHRDb250ZW50OiAnTGF0ZScgfSkpLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9