5ae086e055fccb02f58b78c6e7b244ab
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const testing_1 = require("@nestjs/testing");
const analytics_controller_1 = require("../controllers/analytics.controller");
const data_collection_service_1 = require("../services/data-collection.service");
const business_intelligence_service_1 = require("../services/business-intelligence.service");
const real_time_analytics_service_1 = require("../services/real-time-analytics.service");
const analytics_event_entity_1 = require("../entities/analytics-event.entity");
describe("AnalyticsController", () => {
    let controller;
    let dataCollectionService;
    let businessIntelligenceService;
    let realTimeAnalyticsService;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            controllers: [analytics_controller_1.AnalyticsController],
            providers: [
                {
                    provide: data_collection_service_1.DataCollectionService,
                    useValue: {
                        trackEvent: globals_1.jest.fn(),
                        batchTrackEvents: globals_1.jest.fn(),
                        getEvents: globals_1.jest.fn(),
                    },
                },
                {
                    provide: business_intelligence_service_1.BusinessIntelligenceService,
                    useValue: {
                        executeQuery: globals_1.jest.fn(),
                        getUserAnalytics: globals_1.jest.fn(),
                        getTopMetrics: globals_1.jest.fn(),
                        getFunnelAnalysis: globals_1.jest.fn(),
                    },
                },
                {
                    provide: real_time_analytics_service_1.RealTimeAnalyticsService,
                    useValue: {
                        getCurrentMetrics: globals_1.jest.fn(),
                        getActiveUsers: globals_1.jest.fn(),
                        getEventsPerSecond: globals_1.jest.fn(),
                    },
                },
            ],
        }).compile();
        controller = module.get(analytics_controller_1.AnalyticsController);
        dataCollectionService = module.get(data_collection_service_1.DataCollectionService);
        businessIntelligenceService = module.get(business_intelligence_service_1.BusinessIntelligenceService);
        realTimeAnalyticsService = module.get(real_time_analytics_service_1.RealTimeAnalyticsService);
    });
    it("should be defined", () => {
        expect(controller).toBeDefined();
    });
    describe("trackEvent", () => {
        it("should track an event successfully", async () => {
            const trackEventDto = {
                eventType: analytics_event_entity_1.EventType.USER_ACTION,
                eventName: "button_click",
                userId: "user123",
                properties: { button: "submit" },
            };
            dataCollectionService.trackEvent.mockResolvedValue();
            const result = await controller.trackEvent(trackEventDto);
            expect(result).toEqual({
                success: true,
                message: "Event tracked successfully",
            });
            expect(dataCollectionService.trackEvent).toHaveBeenCalledWith(trackEventDto);
        });
    });
    describe("executeQuery", () => {
        it("should execute analytics query", async () => {
            const queryDto = {
                metrics: ["event_count"],
                timeRange: {
                    start: "2023-01-01T00:00:00Z",
                    end: "2023-01-02T00:00:00Z",
                },
            };
            const mockResult = {
                data: [],
                summary: {
                    totalRecords: 0,
                    timeRange: {
                        start: new Date("2023-01-01"),
                        end: new Date("2023-01-02"),
                    },
                    aggregations: {},
                },
            };
            businessIntelligenceService.executeQuery.mockResolvedValue(mockResult);
            const result = await controller.executeQuery(queryDto);
            expect(result).toEqual(mockResult);
            expect(businessIntelligenceService.executeQuery).toHaveBeenCalledWith(queryDto);
        });
    });
    describe("getRealTimeMetrics", () => {
        it("should return real-time metrics", async () => {
            const mockMetrics = [
                {
                    name: "events_per_second",
                    value: 10,
                    timestamp: new Date(),
                },
            ];
            realTimeAnalyticsService.getCurrentMetrics.mockResolvedValue(mockMetrics);
            realTimeAnalyticsService.getActiveUsers.mockResolvedValue(5);
            realTimeAnalyticsService.getEventsPerSecond.mockResolvedValue(10);
            const result = await controller.getRealTimeMetrics();
            expect(result.metrics).toEqual(mockMetrics);
            expect(result.summary.activeUsers).toBe(5);
            expect(result.summary.eventsPerSecond).toBe(10);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxvam9zZXBoXFxEb2N1bWVudHNcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcc3JjXFxhbmFseXRpY1xcX190ZXN0c19fXFxhbmFseXRpY3MuY29udHJvbGxlci5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQ0EsMkNBQW9DO0FBRHBDLDZDQUEwRDtBQUcxRCw4RUFBeUU7QUFDekUsaUZBQTJFO0FBQzNFLDZGQUF1RjtBQUN2Rix5RkFBa0Y7QUFDbEYsK0VBQThEO0FBRTlELFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7SUFDbkMsSUFBSSxVQUErQixDQUFBO0lBQ25DLElBQUkscUJBQXlELENBQUE7SUFDN0QsSUFBSSwyQkFBcUUsQ0FBQTtJQUN6RSxJQUFJLHdCQUErRCxDQUFBO0lBRW5FLFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixNQUFNLE1BQU0sR0FBa0IsTUFBTSxjQUFJLENBQUMsbUJBQW1CLENBQUM7WUFDM0QsV0FBVyxFQUFFLENBQUMsMENBQW1CLENBQUM7WUFDbEMsU0FBUyxFQUFFO2dCQUNUO29CQUNFLE9BQU8sRUFBRSwrQ0FBcUI7b0JBQzlCLFFBQVEsRUFBRTt3QkFDUixVQUFVLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTt3QkFDckIsZ0JBQWdCLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTt3QkFDM0IsU0FBUyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7cUJBQ3JCO2lCQUNGO2dCQUNEO29CQUNFLE9BQU8sRUFBRSwyREFBMkI7b0JBQ3BDLFFBQVEsRUFBRTt3QkFDUixZQUFZLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTt3QkFDdkIsZ0JBQWdCLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTt3QkFDM0IsYUFBYSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7d0JBQ3hCLGlCQUFpQixFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7cUJBQzdCO2lCQUNGO2dCQUNEO29CQUNFLE9BQU8sRUFBRSxzREFBd0I7b0JBQ2pDLFFB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RSxHQUFHLEVBQUU7UUFDbEMsRUFBRSxDQUFDLGlDQUFpQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQy9DLE1BQU0sV0FBVyxHQUFHO2dCQUNsQjtvQkFDRSxJQUFJLEVBQUUsbUJBQW1CO29CQUN6QixLQUFLLEVBQUUsRUFBRTtvQkFDVCxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7aUJBQ3RCO2FBQ0YsQ0FBQTtZQUVELHdCQUF3QixDQUFDLGlCQUFpQixDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxDQUFBO1lBQ3pFLHdCQUF3QixDQUFDLGNBQWMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsQ0FBQTtZQUM1RCx3QkFBd0IsQ0FBQyxrQkFBa0IsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLENBQUMsQ0FBQTtZQUVqRSxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxrQkFBa0IsRUFBRSxDQUFBO1lBRXBELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFBO1lBQzNDLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTtZQUMxQyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUE7UUFDakQsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUMsQ0FBQyxDQUFBIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcb2pvc2VwaFxcRG9jdW1lbnRzXFxTdHJlbGxlck1pbmRzLUJhY2tlbmRcXHNyY1xcYW5hbHl0aWNcXF9fdGVzdHNfX1xcYW5hbHl0aWNzLmNvbnRyb2xsZXIuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCB0eXBlIFRlc3RpbmdNb2R1bGUgfSBmcm9tIFwiQG5lc3Rqcy90ZXN0aW5nXCJcclxuaW1wb3J0IHsgamVzdCB9IGZyb20gXCJAamVzdC9nbG9iYWxzXCJcclxuXHJcbmltcG9ydCB7IEFuYWx5dGljc0NvbnRyb2xsZXIgfSBmcm9tIFwiLi4vY29udHJvbGxlcnMvYW5hbHl0aWNzLmNvbnRyb2xsZXJcIlxyXG5pbXBvcnQgeyBEYXRhQ29sbGVjdGlvblNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvZGF0YS1jb2xsZWN0aW9uLnNlcnZpY2VcIlxyXG5pbXBvcnQgeyBCdXNpbmVzc0ludGVsbGlnZW5jZVNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvYnVzaW5lc3MtaW50ZWxsaWdlbmNlLnNlcnZpY2VcIlxyXG5pbXBvcnQgeyBSZWFsVGltZUFuYWx5dGljc1NlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvcmVhbC10aW1lLWFuYWx5dGljcy5zZXJ2aWNlXCJcclxuaW1wb3J0IHsgRXZlbnRUeXBlIH0gZnJvbSBcIi4uL2VudGl0aWVzL2FuYWx5dGljcy1ldmVudC5lbnRpdHlcIlxyXG5cclxuZGVzY3JpYmUoXCJBbmFseXRpY3NDb250cm9sbGVyXCIsICgpID0+IHtcclxuICBsZXQgY29udHJvbGxlcjogQW5hbHl0aWNzQ29udHJvbGxlclxyXG4gIGxldCBkYXRhQ29sbGVjdGlvblNlcnZpY2U6IGplc3QuTW9ja2VkPERhdGFDb2xsZWN0aW9uU2VydmljZT5cclxuICBsZXQgYnVzaW5lc3NJbnRlbGxpZ2VuY2VTZXJ2aWNlOiBqZXN0Lk1vY2tlZDxCdXNpbmVzc0ludGVsbGlnZW5jZVNlcnZpY2U+XHJcbiAgbGV0IHJlYWxUaW1lQW5hbHl0aWNzU2VydmljZTogamVzdC5Nb2NrZWQ8UmVhbFRpbWVBbmFseXRpY3NTZXJ2aWNlPlxyXG5cclxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XHJcbiAgICAgIGNvbnRyb2xsZXJzOiBbQW5hbHl0aWNzQ29udHJvbGxlcl0sXHJcbiAgICAgIHByb3ZpZGVyczogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIHByb3ZpZGU6IERhdGFDb2xsZWN0aW9uU2VydmljZSxcclxuICAgICAgICAgIHVzZVZhbHVlOiB7XHJcbiAgICAgICAgICAgIHRyYWNrRXZlbnQ6IGplc3QuZm4oKSxcclxuICAgICAgICAgICAgYmF0Y2hUcmFja0V2ZW50czogamVzdC5mbigpLFxyXG4gICAgICAgICAgICBnZXRFdmVudHM6IGplc3QuZm4oKSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBwcm92aWRlOiBCdXNpbmVzc0ludGVsbGlnZW5jZVNlcnZpY2UsXHJcbiAgICAgICAgICB1c2VWYWx1ZToge1xyXG4gICAgICAgICAgICBleGVjdXRlUXVlcnk6IGplc3QuZm4oKSxcclxuICAgICAgICAgICAgZ2V0VXNlckFuYWx5dGljczogamVzdC5mbigpLFxyXG4gICAgICAgICAgICBnZXRUb3BNZXRyaWNzOiBqZXN0LmZuKCksXHJcbiAgICAgICAgICAgIGdldEZ1bm5lbEFuYWx5c2lzOiBqZXN0LmZuKCksXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgcHJvdmlkZTogUmVhbFRpbWVBbmFseXRpY3NTZXJ2aWNlLFxyXG4gICAgICAgICAgdXNlVmFsdWU6IHtcclxuICAgICAgICAgICAgZ2V0Q3VycmVudE1ldHJpY3M6IGplc3QuZm4oKSxcclxuICAgICAgICAgICAgZ2V0QWN0aXZlVXNlcnM6IGplc3QuZm4oKSxcclxuICAgICAgICAgICAgZ2V0RXZlbnRzUGVyU2Vjb25kOiBqZXN0LmZuKCksXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF0sXHJcbiAgICB9KS5jb21waWxlKClcclxuXHJcbiAgICBjb250cm9sbGVyID0gbW9kdWxlLmdldDxBbmFseXRpY3NDb250cm9sbGVyPihBbmFseXRpY3NDb250cm9sbGVyKVxyXG4gICAgZGF0YUNvbGxlY3Rpb25TZXJ2aWNlID0gbW9kdWxlLmdldChEYXRhQ29sbGVjdGlvblNlcnZpY2UpXHJcbiAgICBidXNpbmVzc0ludGVsbGlnZW5jZVNlcnZpY2UgPSBtb2R1bGUuZ2V0KEJ1c2luZXNzSW50ZWxsaWdlbmNlU2VydmljZSlcclxuICAgIHJlYWxUaW1lQW5hbHl0aWNzU2VydmljZSA9IG1vZHVsZS5nZXQoUmVhbFRpbWVBbmFseXRpY3NTZXJ2aWNlKVxyXG4gIH0pXHJcblxyXG4gIGl0KFwic2hvdWxkIGJlIGRlZmluZWRcIiwgKCkgPT4ge1xyXG4gICAgZXhwZWN0KGNvbnRyb2xsZXIpLnRvQmVEZWZpbmVkKClcclxuICB9KVxyXG5cclxuICBkZXNjcmliZShcInRyYWNrRXZlbnRcIiwgKCkgPT4ge1xyXG4gICAgaXQoXCJzaG91bGQgdHJhY2sgYW4gZXZlbnQgc3VjY2Vzc2Z1bGx5XCIsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgdHJhY2tFdmVudER0byA9IHtcclxuICAgICAgICBldmVudFR5cGU6IEV2ZW50VHlwZS5VU0VSX0FDVElPTixcclxuICAgICAgICBldmVudE5hbWU6IFwiYnV0dG9uX2NsaWNrXCIsXHJcbiAgICAgICAgdXNlcklkOiBcInVzZXIxMjNcIixcclxuICAgICAgICBwcm9wZXJ0aWVzOiB7IGJ1dHRvbjogXCJzdWJtaXRcIiB9LFxyXG4gICAgICB9XHJcblxyXG4gICAgICBkYXRhQ29sbGVjdGlvblNlcnZpY2UudHJhY2tFdmVudC5tb2NrUmVzb2x2ZWRWYWx1ZSgpXHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnRyYWNrRXZlbnQodHJhY2tFdmVudER0bylcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgbWVzc2FnZTogXCJFdmVudCB0cmFja2VkIHN1Y2Nlc3NmdWxseVwiLFxyXG4gICAgICB9KVxyXG4gICAgICBleHBlY3QoZGF0YUNvbGxlY3Rpb25TZXJ2aWNlLnRyYWNrRXZlbnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHRyYWNrRXZlbnREdG8pXHJcbiAgICB9KVxyXG4gIH0pXHJcblxyXG4gIGRlc2NyaWJlKFwiZXhlY3V0ZVF1ZXJ5XCIsICgpID0+IHtcclxuICAgIGl0KFwic2hvdWxkIGV4ZWN1dGUgYW5hbHl0aWNzIHF1ZXJ5XCIsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcXVlcnlEdG8gPSB7XHJcbiAgICAgICAgbWV0cmljczogW1wiZXZlbnRfY291bnRcIl0sXHJcbiAgICAgICAgdGltZVJhbmdlOiB7XHJcbiAgICAgICAgICBzdGFydDogXCIyMDIzLTAxLTAxVDAwOjAwOjAwWlwiLFxyXG4gICAgICAgICAgZW5kOiBcIjIwMjMtMDEtMDJUMDA6MDA6MDBaXCIsXHJcbiAgICAgICAgfSxcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgbW9ja1Jlc3VsdCA9IHtcclxuICAgICAgICBkYXRhOiBbXSxcclxuICAgICAgICBzdW1tYXJ5OiB7XHJcbiAgICAgICAgICB0b3RhbFJlY29yZHM6IDAsXHJcbiAgICAgICAgICB0aW1lUmFuZ2U6IHtcclxuICAgICAgICAgICAgc3RhcnQ6IG5ldyBEYXRlKFwiMjAyMy0wMS0wMVwiKSxcclxuICAgICAgICAgICAgZW5kOiBuZXcgRGF0ZShcIjIwMjMtMDEtMDJcIiksXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgYWdncmVnYXRpb25zOiB7fSxcclxuICAgICAgICB9LFxyXG4gICAgICB9XHJcblxyXG4gICAgICBidXNpbmVzc0ludGVsbGlnZW5jZVNlcnZpY2UuZXhlY3V0ZVF1ZXJ5Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXN1bHQpXHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmV4ZWN1dGVRdWVyeShxdWVyeUR0bylcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1Jlc3VsdClcclxuICAgICAgZXhwZWN0KGJ1c2luZXNzSW50ZWxsaWdlbmNlU2VydmljZS5leGVjdXRlUXVlcnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHF1ZXJ5RHRvKVxyXG4gICAgfSlcclxuICB9KVxyXG5cclxuICBkZXNjcmliZShcImdldFJlYWxUaW1lTWV0cmljc1wiLCAoKSA9PiB7XHJcbiAgICBpdChcInNob3VsZCByZXR1cm4gcmVhbC10aW1lIG1ldHJpY3NcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrTWV0cmljcyA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBuYW1lOiBcImV2ZW50c19wZXJfc2Vjb25kXCIsXHJcbiAgICAgICAgICB2YWx1ZTogMTAsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgfSxcclxuICAgICAgXVxyXG5cclxuICAgICAgcmVhbFRpbWVBbmFseXRpY3NTZXJ2aWNlLmdldEN1cnJlbnRNZXRyaWNzLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tNZXRyaWNzKVxyXG4gICAgICByZWFsVGltZUFuYWx5dGljc1NlcnZpY2UuZ2V0QWN0aXZlVXNlcnMubW9ja1Jlc29sdmVkVmFsdWUoNSlcclxuICAgICAgcmVhbFRpbWVBbmFseXRpY3NTZXJ2aWNlLmdldEV2ZW50c1BlclNlY29uZC5tb2NrUmVzb2x2ZWRWYWx1ZSgxMClcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0UmVhbFRpbWVNZXRyaWNzKClcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQubWV0cmljcykudG9FcXVhbChtb2NrTWV0cmljcylcclxuICAgICAgZXhwZWN0KHJlc3VsdC5zdW1tYXJ5LmFjdGl2ZVVzZXJzKS50b0JlKDUpXHJcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VtbWFyeS5ldmVudHNQZXJTZWNvbmQpLnRvQmUoMTApXHJcbiAgICB9KVxyXG4gIH0pXHJcbn0pXHJcbiJdLCJ2ZXJzaW9uIjozfQ==