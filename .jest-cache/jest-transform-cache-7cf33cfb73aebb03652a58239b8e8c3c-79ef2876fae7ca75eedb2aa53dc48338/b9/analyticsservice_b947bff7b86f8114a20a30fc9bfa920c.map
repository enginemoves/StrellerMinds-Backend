{"file":"C:\\Users\\ojoseph\\Documents\\StrellerMinds-Backend\\src\\analytics\\analytics.service.ts","mappings":";;;;;;;;;;;;;;;;AAAA,2CAA4C;AAC5C,6CAAmD;AACnD,qCAAqC;AACrC,uCAAiC;AACjC,kEAAwD;AAExD;;GAEG;AAEI,IAAM,gBAAgB,GAAtB,MAAM,gBAAgB;IAC3B,YAEmB,mBAA0C;QAA1C,wBAAmB,GAAnB,mBAAmB,CAAuB;IAC1D,CAAC;IAEJ;;OAEG;IACH,KAAK,CAAC,eAAe;QACnB,OAAO,MAAM,IAAI,CAAC,mBAAmB,CAAC,IAAI,EAAE,CAAC;IAC/C,CAAC;IAED;;OAEG;IACH,YAAY,CAAC,IAAiB;QAC5B,MAAM,MAAM,GAAG,CAAC,IAAI,EAAE,WAAW,EAAE,QAAQ,EAAE,UAAU,EAAE,gBAAgB,EAAE,WAAW,CAAC,CAAC;QACxF,OAAO,IAAA,gBAAK,EAAC,IAAI,EAAE,EAAE,MAAM,EAAE,CAAC,CAAC;IACjC,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,uBAAuB;QAC3B,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,mBAAmB,CAAC,IAAI,EAAE,CAAC;QAEtD,uBAAuB;QACvB,MAAM,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE;YAC3C,MAAM,OAAO,GAAG,KAAK,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,qBAAqB;YAClF,GAAG,CAAC,OAAO,CAAC,GAAG,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,IAAI,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC;YAC3D,GAAG,CAAC,OAAO,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC;YACxB,OAAO,GAAG,CAAC;QACb,CAAC,EAAE,EAAE,CAAC,CAAC;QAEP,OAAO,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;IAC/B,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,qBAAqB;QACzB,mCAAmC;QACnC,OAAO,EAAE,WAAW,EAAE,GAAG,EAAE,MAAM,EAAE,EAAE,YAAY,EAAE,EAAE,EAAE,EAAE,CAAC;IAC5D,CAAC;IAED,KAAK,CAAC,qBAAqB;QACzB,OAAO;YACL,KAAK,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,CAAC;YAC1B,OAAO,EAAE,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC;SAC5B,CAAC;IACJ,CAAC;IAED,KAAK,CAAC,eAAe;QACnB,OAAO;YACL,cAAc,EAAE,KAAK;YACrB,UAAU,EAAE,IAAI;SACjB,CAAC;IACJ,CAAC;IAED,KAAK,CAAC,eAAe;QACnB,OAAO;YACL,UAAU,EAAE,IAAI;YAChB,WAAW,EAAE,GAAG;YAChB,UAAU,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;SACrC,CAAC;IACJ,CAAC;CACF,CAAA;AAnEY,4CAAgB;2BAAhB,gBAAgB;IAD5B,IAAA,mBAAU,GAAE;IAGR,WAAA,IAAA,0BAAgB,EAAC,4BAAS,CAAC,CAAA;yDACU,oBAAU,oBAAV,oBAAU;GAHvC,gBAAgB,CAmE5B","names":[],"sources":["C:\\Users\\ojoseph\\Documents\\StrellerMinds-Backend\\src\\analytics\\analytics.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\r\nimport { InjectRepository } from '@nestjs/typeorm';\r\nimport { Repository } from 'typeorm';\r\nimport { parse } from 'json2csv'; \r\nimport { Analytics } from './entities/analytics.entity';\r\n\r\n/**\r\n * AnalyticsService provides analytics data and reporting logic.\r\n */\r\n@Injectable()\r\nexport class AnalyticsService {\r\n  constructor(\r\n    @InjectRepository(Analytics)\r\n    private readonly analyticsRepository: Repository<Analytics>,\r\n  ) {}\r\n\r\n  /**\r\n   * Get all analytics records.\r\n   */\r\n  async getAllAnalytics(): Promise<Analytics[]> {\r\n    return await this.analyticsRepository.find();\r\n  }\r\n\r\n  /**\r\n   * Convert analytics data to CSV format.\r\n   */\r\n  convertToCSV(data: Analytics[]): string {\r\n    const fields = ['id', 'eventType', 'userId', 'courseId', 'additionalData', 'createdAt'];\r\n    return parse(data, { fields });\r\n  }\r\n\r\n  /**\r\n   * Get user engagement trends.\r\n   */\r\n  async getUserEngagementTrends() {\r\n    const rawData = await this.analyticsRepository.find();\r\n\r\n    // Group events by date\r\n    const trends = rawData.reduce((acc, entry) => {\r\n      const dateKey = entry.createdAt.toISOString().split('T')[0]; // Extract YYYY-MM-DD\r\n      acc[dateKey] = acc[dateKey] || { date: dateKey, count: 0 };\r\n      acc[dateKey].count += 1;\r\n      return acc;\r\n    }, {});\r\n\r\n    return Object.values(trends);\r\n  }\r\n\r\n  /**\r\n   * Get credential issuance analytics.\r\n   */\r\n  async getCredentialIssuance() {\r\n    // Simulate query or on-chain fetch\r\n    return { totalIssued: 512, byDate: { '2025-05-01': 32 } };\r\n  }\r\n\r\n  async getTransactionVolumes() {\r\n    return {\r\n      daily: [120, 100, 89, 132],\r\n      monthly: [3000, 2800, 3400],\r\n    };\r\n  }\r\n\r\n  async getCostAnalysis() {\r\n    return {\r\n      averageGasCost: 0.012,\r\n      totalSpent: 35.6,\r\n    };\r\n  }\r\n\r\n  async getUsageReports() {\r\n    return {\r\n      totalUsers: 1240,\r\n      activeUsers: 410,\r\n      reportDate: new Date().toISOString(),\r\n    };\r\n  }\r\n}\r\n"],"version":3}